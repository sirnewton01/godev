define("orion/util",[],function(){function v(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function g(e,t){return e.createElementNS?e.createElementNS(m,t):e.createElement(t)}var e=navigator.userAgent,t=parseFloat(e.split("MSIE")[1])||undefined,n=parseFloat(e.split("Firefox/")[1]||e.split("Minefield/")[1])||undefined,r=e.indexOf("Opera")!==-1,i=parseFloat(e.split("Chrome/")[1])||undefined,s=e.indexOf("Safari")!==-1&&!i,o=parseFloat(e.split("WebKit/")[1])||undefined,u=e.indexOf("Android")!==-1,a=e.indexOf("iPad")!==-1,f=e.indexOf("iPhone")!==-1,l=a||f,c=navigator.platform.indexOf("Mac")!==-1,h=navigator.platform.indexOf("Win")!==-1,p=navigator.platform.indexOf("Linux")!==-1,d=h?"\r\n":"\n",m="http://www.w3.org/1999/xhtml";return{formatMessage:v,createElement:g,isIE:t,isFirefox:n,isOpera:r,isChrome:i,isSafari:s,isWebkit:o,isAndroid:u,isIPad:a,isIPhone:f,isIOS:l,isMac:c,isWindows:h,isLinux:p,platformDelimiter:d}}),define("orion/webui/littlelib",["require"],function(e){function t(e,t){return t||(t=document),t.querySelector(e)}function n(e,t){return t||(t=document),t.querySelectorAll(e)}function r(e,t){return Array.prototype.slice.call(n(e,t))}function i(e){var t=e;return typeof e=="string"&&(t=document.getElementById(e)),t}function s(e,t){var n=e.compareDocumentPosition(t);return e===t||Boolean(n&16)}function o(e){var t=e.getBoundingClientRect();return{left:t.left+document.body.scrollLeft,top:t.top+document.body.scrollTop,width:t.width,height:t.height}}function u(e){while(e.hasChildNodes()){var t=e.firstChild;e.removeChild(t)}}function a(e){if(e.tabIndex>=0)return e;if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++){var n=a(e.childNodes[t]);if(n)return n}return null}function f(e){if(e.tabIndex>=0)return e;if(e.hasChildNodes())for(var t=e.childNodes.length-1;t>=0;t--){var n=f(e.childNodes[t]);if(n)return n}return null}function c(e,t){if(e.nodeType===3){var n=l.exec(e.nodeValue);if(n&&n.length>1){var r=t[n[1]]||n[1];e.parentNode.replaceChild(document.createTextNode(r),e)}}if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)c(e.childNodes[i],t)}function p(e,t){h.length===0&&document.addEventListener("click",function(e){var t=[];for(var n=0;n<h.length;n++){var r=h[n].excludeNodes,i=h[n].dismiss,o=!1,u=!0;for(var a=0;a<r.length;a++){o=document.compareDocumentPosition(document,r[a])!==1;if(o&&s(r[a],e.target)){u=!1;break}}u&&(i(),o=document.compareDocumentPosition(document,r[a])!==1),o&&t.push(h[n])}h=t},!0),h.push({excludeNodes:e,dismiss:t})}function d(e){window.document.all?e.keyCode=0:(e.preventDefault(),e.stopPropagation())}var l=/\$\{([^\}]+)\}/,h=[],v={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46};return{$:t,$$:n,$$array:r,node:i,contains:s,bounds:o,empty:u,firstTabbable:a,lastTabbable:f,stop:d,processTextNodes:c,addAutoDismiss:p,KEY:v}}),define("orion/webui/dropdown",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._dropdownNode=t.node(e.dropdown);if(!this._dropdownNode)throw"no dom node for dropdown found";this._triggerNode=t.$(".dropdownTrigger",this._dropdownNode.parentNode);if(!this._triggerNode)throw"no dom node for dropdown trigger found";this._populate=e.populate;var n=this;this._triggerNode.addEventListener("click",function(e){n.toggle()&&t.stop(e)},!1),this._triggerNode.tagName.toLowerCase()==="span"&&this._triggerNode.addEventListener("keydown",function(e){if(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)n.toggle(),t.stop(e)},!1),this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},toggle:function(e){return this._triggerNode.classList.contains("dropdownTriggerOpen")?this.close():this.open()},open:function(){this._populate&&(this.empty(),this._populate(this._dropdownNode));var e=this.getItems();return e.length>0?(this._hookedAutoDismiss||(t.addAutoDismiss([this._triggerNode,this._dropdownNode],this.close.bind(this)),this._hookedAutoDismiss=!0),this._positionDropdown(),this._triggerNode.classList.add("dropdownTriggerOpen"),this._dropdownNode.classList.add("dropdownMenuOpen"),e[0].focus(),!0):!1},_positionDropdown:function(){this._dropdownNode.style.left="";var e=t.bounds(this._dropdownNode),n=t.bounds(this._boundingNode(this._triggerNode));e.left+e.width>n.left+n.width&&(this._dropdownNode.style.right=0)},_boundingNode:function(e){return e.style.right!==""||e.style.position==="absolute"||!e.parentNode||!e.parentNode.style?e:this._boundingNode(e.parentNode)},close:function(e){return this._triggerNode.classList.remove("dropdownTriggerOpen"),this._dropdownNode.classList.remove("dropdownMenuOpen"),e&&this._triggerNode.focus(),!0},getItems:function(){var e=t.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,!0),n=[],r=this;return e.forEach(function(e){e.parentNode.parentNode===r._dropdownNode&&n.push(e)}),n},empty:function(){var e=t.$$array("li",this._dropdownNode),n=this;e.forEach(function(e){e.parentNode===n._dropdownNode&&e.parentNode.removeChild(e)})},_dropdownKeyDown:function(e){if(e.keyCode===t.KEY.UP||e.keyCode===t.KEY.DOWN||e.keyCode===t.KEY.RIGHT||e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.LEFT){var n=this.getItems(),r=document.activeElement;if(n.length&&n.length>0&&r){var i=n.indexOf(r);i<0&&(i=n.indexOf(r.parentNode)),i>=0&&(e.keyCode===t.KEY.UP&&i>0?(i--,n[i].focus()):e.keyCode===t.KEY.DOWN&&i<n.length-1?(i++,n[i].focus()):e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.RIGHT?r.classList.contains("dropdownTrigger")&&r.dropdown&&r.dropdown.open():e.keyCode===t.KEY.LEFT&&r.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&this.close(!0),t.stop(e))}}else e.keyCode===t.KEY.ESCAPE&&(this.close(!0),t.stop(e))}},n.prototype.constructor=n,{Dropdown:n}}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("\ufeff")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'<button class="dropdownTrigger">${ButtonText}<span class="dropdownArrowDown"></span></button><ul class="dropdownMenu"></ul>'}),define("text!orion/webui/submenutriggerbutton.html",[],function(){return'<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0">${ButtonText}<span class="dropdownArrowRight"></span></span><ul class="dropdownMenu"></ul></li>'}),define("text!orion/webui/checkedmenuitem.html",[],function(){return'<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>'}),define("orion/webui/tooltip",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._node=t.node(e.node);if(!this._node)throw"no dom node for tooltip found";this._position=e.position||["right","above","below","left"],this._text=e.text,this._hideDelay=e.hideDelay===undefined?200:e.hideDelay,this._tailSize=e.tailSize||10,this._trigger=e.trigger||"mouseover",this._afterShowing=e.afterShowing,this._afterHiding=e.afterHiding;var n=this;if(this._trigger==="click")this._showDelay=0,this._node.addEventListener("click",function(e){e.target===n._node&&(n.show(),t.stop(e))},!1);else if(this._trigger==="mouseover"){this._showDelay=e.showDelay===undefined?1e3:e.showDelay;var r=["mouseout","click"];this._node.addEventListener("mouseover",function(e){t.contains(n._node,e.target)&&(n.show(),t.stop(e))},!1);for(var i=0;i<r.length;i++)this._node.addEventListener(r[i],function(e){t.contains(n._node,e.target)&&n.hide()},!1)}},_makeTipNode:function(){if(!this._tip){this._tip=document.createElement("span"),this._tip.classList.add("tooltipContainer"),this._tipInner=document.createElement("span"),this._tipInner.classList.add("tooltip");if(this._text){var e=document.createTextNode(this._text);this._tipInner.appendChild(e)}this._tip.appendChild(this._tipInner),document.body.appendChild(this._tip);var n=this;t.addAutoDismiss([this._tip,this._node],function(){n.hide()}),this._trigger==="mouseover"&&(this._tipInner.role="tooltip",this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(e){n._timeout&&(window.clearTimeout(n._timeout),n._timeout=null),n._tip.addEventListener("mouseout",function(e){t.contains(n._tip,e.target)&&(n.hide(),t.stop(e))},!1)},!1))}return this._tip},_positionTip:function(e,n){this._makeTipNode(),this._tailBorder&&(this._tip.removeChild(this._tailBorder),this._tailBorder=null,this._tip.removeChild(this._tail),this._tail=null),e==="left"?this._tipInner.classList.add("left"):this._tipInner.classList.remove("left");var r=t.bounds(this._node),i=t.bounds(this._tipInner),s,o;switch(e){case"above":s=r.top-i.height-this._tailSize-1,o=r.left-this._tailSize;break;case"below":s=r.top+r.height+this._tailSize+1,o=r.left-this._tailSize;break;case"left":s=r.top-this._tailSize/2,o=r.left-i.width-this._tailSize-1;break;default:s=r.top-this._tailSize/2,o=r.left+r.width+this._tailSize+1}var u=t.bounds(document.documentElement);if(s+i.height>u.height){if(!n)return!1;s=u.height-i.height-1}if(o+i.width>u.width){if(!n)return!1;o=u.width-i.width-1}if(o<0){if(!n)return!1;o=4}if(s<0){if(!n)return!1;s=4}return this._tailBorder=document.createElement("span"),this._tailBorder.classList.add("tooltipTailBorderFrom"+e),this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+e),e==="above"||e==="left"?(this._tip.appendChild(this._tailBorder),this._tip.appendChild(this._tail)):(this._tip.insertBefore(this._tailBorder,this._tipInner),this._tip.insertBefore(this._tail,this._tipInner)),this._tip.style.top=s+"px",this._tip.style.left=o+"px",this._tip.style.width=i.width+"px",this._tip.style.height=i.height+"px",!0},contentContainer:function(){return this._makeTipNode(),this._tipInner},show:function(){if(this._tip&&this._tip.classList.contains("tooltipShowing"))return;var e=this;this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._timeout=window.setTimeout(function(){var t=!1,n=0;while(!t&&n<e._position.length)t=e._positionTip(e._position[n]),n++;t||e._positionTip(e._position[0],!0),e._tip.classList.add("tooltipShowing"),e._afterShowing&&e._afterShowing()},this._showDelay)},hide:function(e){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);if(!this._tip||!this._tip.classList.contains("tooltipShowing"))return;e===undefined&&(e=this._hideDelay);var t=this;this._timeout=window.setTimeout(function(){t._tip.classList.remove("tooltipShowing"),t._afterHiding&&t._afterHiding()},e)},destroy:function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._tip&&(document.body.removeChild(this._tip),this._tip=null,this._tipInner=null,this._tail=null,this._tailBorder=null)}},n.prototype.constructor=n,{Tooltip:n}}),define("orion/commands",["require","orion/util","orion/webui/littlelib","orion/webui/dropdown","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/submenutriggerbutton.html","text!orion/webui/checkedmenuitem.html","orion/webui/tooltip"],function(e,t,n,r,i,s,o,u){function l(e){a=e}function c(e,t){for(var r in t)if(t[r]&&t[r].keyBinding&&t[r].command&&t[r].keyBinding.match(e)){var i=t[r],s=i.keyBinding;if(!s.domScope||n.contains(n.node(s.domScope),e.target)){var o=i.invocation;if(o){var u=i.command;if(u.hrefCallback){n.stop(e);var a=u.hrefCallback.call(o.handler||window,o);a.then?a.then(function(e){window.open(e)}):window.open(a);return}if(u.onClick||u.callback){n.stop(e),window.setTimeout(function(){(u.onClick||u.callback).call(o.handler||window,o)},0);return}}}}}function h(e,t,s,o){e=n.node(e);if(!e)throw"no parent node was specified";var u=document.createRange();u.selectNode(e);var a=u.createContextualFragment(i);n.processTextNodes(a,{ButtonText:t}),e.appendChild(a);var f=e.lastChild,l=f.previousSibling;return o?l.classList.add(o):(l.classList.add("orionButton"),l.classList.add("commandButton")),l.dropdown=new r.Dropdown({dropdown:f,populate:s}),f.dropdown=l.dropdown,{menuButton:l,menu:f,dropdown:l.dropdown}}function p(e,t,r,i){e=n.node(e);if(!e)throw"no parent node was specified";var s=document.createRange();s.selectNode(e);var u=s.createContextualFragment(o);n.processTextNodes(u,{ItemText:t}),e.appendChild(u);var a=e.lastChild,f=n.$(".checkedMenuItem",a);f.checked=r,f.addEventListener("change",i,!1)}function d(e,t,n){t.classList.add("commandImage");var r;return e.imageClass?(r=document.createElement("span"),t.appendChild(r),r.classList.add(e.spriteClass),r.classList.add(e.imageClass)):(r=new Image,r.alt=e.name,r.name=n,r.id=n,r.src=e.image,t.appendChild(r)),r}function v(e,t,n,r,i,s,o){var a;s=s||!t.name&&t.hasImage();if(t.hrefCallback){a=document.createElement("a"),a.id=r,a.className="commandLink",a.appendChild(document.createTextNode(t.name));var l=t.hrefCallback.call(n.handler,n);l.then?l.then(function(e){a.href=e}):l?a.href=l:a.href="#"}else{a=document.createElement("button"),a.className="orionButton";if(s)t.hasImage()?(d(t,a,r),t.name&&a.setAttribute("aria-label",t.name)):(a.classList.add("commandButton"),a.classList.add("commandMissingImageButton"),a.appendChild(document.createTextNode(t.name)));else{a.classList.add("commandButton");var c=document.createTextNode(t.name);a.appendChild(c)}var h=o||t.callback;h&&(t.onClick=h,a.addEventListener("click",function(e){h.call(n.handler,n)},!1))}if(e.nodeName.toLowerCase()==="ul"){var p=document.createElement("li");e.appendChild(p),e=p}else a.classList.add("commandMargins");return e.appendChild(a),t.tooltip&&(a.commandTooltip=new u.Tooltip({node:a,text:t.tooltip,position:["above","below","right","left"]})),i&&(f[t.id]={keyBinding:i,command:t,invocation:n}),a}function m(e,t,n,r,i){var s,o=e.dropdown;if(t.hrefCallback){s=document.createElement("a"),s.appendChild(document.createTextNode(t.name));var a=t.hrefCallback.call(n.handler,n);a.then?a.then(function(e){s.href=e}):a?s.href=a:s.href="#"}else{s=document.createElement("span"),s.tabIndex=0,s.appendChild(document.createTextNode(t.name));var l=i||t.callback;l&&(t.onClick=l,s.addEventListener("click",function(e){o.close(!0),l.call(n.handler,n)},!1))}t.tooltip&&(s.commandTooltip=new u.Tooltip({node:s,text:t.tooltip,position:["right","left","above","below"]})),s.className="dropdownMenuItem",s.role="menuitem";var c=document.createElement("li");return e.appendChild(c),c.appendChild(s),r&&(f[t.id]={keyBinding:r,command:t,invocation:n}),s}function g(e,t,n,r,i){this.commandRegistry=i,this.handler=e,this.items=t,this.userData=n,this.command=r,r.parameters&&(this.parameters=r.parameters.makeCopy()),this.id=r.id}function y(e){this._init(e)}var a=null,f={};return window.document.addEventListener("keydown",function(e){function n(e){if(t.isMac){if(e.metaKey&&!e.altKey)return!e.shiftKey&&!e.ctrlKey&&(e.keyCode===65||e.keyCode===67||e.keyCode===86||e.keyCode===88||e.keyCode===90)?!0:!1}else{if(e.ctrlKey&&!e.altKey)return!!e.shiftKey||e.keyCode!==65&&e.keyCode!==67&&e.keyCode!==86&&e.keyCode!==88&&e.keyCode!==90?!1:!0;if(e.altKey&&!e.ctrlKey)return!1}if(e["char"])return e["char"].length>0;if(e.charCode||e.keyCode){var n=e.charCode||e.keyCode;switch(n){case 8:case 9:case 13:case 46:return!0;default:return n>=32&&n<112||n>123}}return!1}e=e||window.event;if(n(e)){if(e.target.contentEditable==="true")return;var r=e.target.nodeName.toLowerCase();if(r==="input"){var i=e.target.type.toLowerCase();switch(i){case"text":case"password":case"search":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"range":case"tel":case"time":case"url":case"week":return}}else if(r==="textarea")return}var s={};if(a){var o,u,l;u=Object.keys(f);for(o=0;o<u.length;o++)l=u[o],s[l]=f[l];var h=a();u=Object.keys(h);for(o=0;o<u.length;o++)l=u[o],s[l]=h[l]}else s=f;c(e,s)},!1),g.prototype={collectsParameters:function(){return this.commandRegistry&&this.commandRegistry.collectsParameters()},makeCopy:function(e){var t=new g(this.handler,this.items,this.userData,this.command,this.commandRegistry);return t.domNode=this.domNode,t.domParent=this.domParent,e?t.parameters=e.makeCopy():this.parameters&&(t.parameters=this.parameters.makeCopy()),t}},g.prototype.constructor=g,y.prototype={_init:function(t){this.id=t.id,this.name=t.name,this.tooltip=t.tooltip||t.name,this.callback=t.callback,this.hrefCallback=t.hrefCallback,this.choiceCallback=t.choiceCallback,this.image=t.image||e.toUrl("images/none.png"),this.imageClass=t.imageClass,this.spriteClass=t.spriteClass||"commandSprite",this.visibleWhen=t.visibleWhen,this.parameters=t.parameters},populateChoicesMenu:function(e,t,r,i,s){var o=this.getChoices(t,r,i);o.forEach(function(r){if(r.name){var i=document.createElement("li");e.appendChild(i);var o=document.createElement("span");o.tabIndex=0,o.role="menuitem",o.classList.add("dropdownMenuItem");var u=document.createTextNode(r.name);o.appendChild(u),i.appendChild(o),o.choice=r,o.addEventListener("click",function(e){e.target.choice&&e.target.choice.callback.call(e.target.choice,t)},!1),o.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&e.target.choice&&e.target.choice.callback.call(e.target.choice,t)},!1)}else s._generateMenuSeparator(e)})},getChoices:function(e,t,n){return this.choiceCallback?this.choiceCallback.call(t,e,n):null},makeChoiceCallback:function(e,t){return function(n){e.callback&&e.callback.call(e,t,n)}},hasImage:function(){return this.imageClass||this.image!==e.toUrl("images/none.png")}},y.prototype.constructor=y,{Command:y,CommandInvocation:g,createDropdownMenu:h,createCheckedMenuItem:p,createCommandItem:v,createCommandMenuItem:m,setKeyBindingProvider:l,localKeyBindings:f,_testMethodProcessKey:c}}),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s+".js"))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&r(e[i],t[i],n)}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.1+",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}u(m)})})}}})}(),define("orion/i18n",{load:function(e,t,n,r){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+e],function(e){n(e)}):n({})}}),define("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Repositories:"Repositories",Shell:"Shell","Get Plugins":"Get Plugins",Global:"Global",Editor:"Editor","Orion Editor":"Orion Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion","Show a list of all the keybindings on this page":"Show a list of all the keybindings on this page","Show Keys":"Show Keys","Hide or show the page banner and footer":"Hide or show the page banner and footer","Toggle banner and footer":"Toggle banner and footer","Choose a file by name and open an editor on it":"Choose a file by name and open an editor on it","Find File Named...":"Find File Named...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown"," is already a favorite.":" is already a favorite.","Add to the favorites list":"Add to the favorites list","Make Favorite":"Make Favorite","Unknown item":"Unknown item","Can't search: no search service is available":"Can't search: no search service is available","could not find banner parent, id was ":"could not find banner parent, id was "," has been added to the favorites list.":" has been added to the favorites list.",Related:"Related",Options:"Options",FAQ:"FAQ","Report a Bug":"Report a Bug","Privacy Policy":"Privacy Policy","Terms of Use":"Terms of Use","Copyright Agent":"Copyright Agent","Orion Logo":"Orion Logo","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Orion is in Beta. Please try it out but BEWARE your data may be lost.":"Orion build @buildLabel@. See the FAQ for terms of service","Add this page to the favorites list":"Add this page to the favorites list","LOG: ":"LOG: ",Switch:"Switch","Switch the type of outliner used":"Switch the type of outliner used",Outliner:"Outliner","no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ","Resource is out of sync with the server. Do you want to save it anyway?":"Resource is out of sync with the server. Do you want to save it anyway?","Orion Home":"Orion Home","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations",Operations:"Operations","Operations running":"Operations running","Some operations finished with warning":"Some operations finished with warning","Some operations finished with error":"Some operations finished with error","no service registry":"no service registry","Are you sure you want to delete '${0}' from the favorites?":"Are you sure you want to delete '${0}' from the favorites?","Are you sure you want to delete these ${0} favorites?":"Are you sure you want to delete these ${0} favorites?","You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the More menu.":"You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the More menu.",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",More:"More","Saved searches":"Saved searches","Recent searches":"Recent searches","Open in new tab":"Open in new tab","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Outliner":"Toggle Outliner","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.","Sample Orion Plugin":"Sample Orion Plugin","Generate a sample plugin for integrating with Orion.":"Generate a sample plugin for integrating with Orion."}),define("orion/nls/messages",["orion/i18n!orion/nls/messages","orion/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/uiUtils",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function n(e){var n="",r=navigator.platform.indexOf("Mac")!==-1;e.mod1&&(r?n+="Cmd+":n+="Ctrl+"),e.mod2&&(n+="Shift+"),e.mod3&&(n+="Alt+"),e.mod4&&r&&(n+="Ctrl+");if(e.alphaKey)return n+e.alphaKey;for(var i in t.KEY)if(typeof (t.KEY[i]==="number")&&t.KEY[i]===e.keyCode)return n+i;var s;switch(e.keyCode){case 59:s=e.mod2?":":";";break;case 61:s=e.mod2?"+":"=";break;case 188:s=e.mod2?"<":",";break;case 190:s=e.mod2?">":".";break;case 191:s=e.mod2?"?":"/";break;case 192:s=e.mod2?"~":"`";break;case 219:s=e.mod2?"{":"[";break;case 220:s=e.mod2?"|":"\\";break;case 221:s=e.mod2?"}":"]";break;case 222:s=e.mod2?'"':"'"}return s?n+s:e.keyCode>=112&&e.keyCode<=123?n+"F"+(e.keyCode-111):n+String.fromCharCode(e.keyCode)}function r(e,n,r,i,s,o,u,a,f){var l=!1,c=function(u){return function(a){if(l)return;var c=t.node(e),h=c.value;if(!c)return;if(u&&a.keyCode===t.KEY.ESCAPE){r&&(n.style.display="inline"),c.parentNode.removeChild(c),l=!0,o&&o();return}if(u&&a.keyCode!==t.KEY.ENTER)return;h.length===0||!f&&h===i?(r&&(n.style.display="inline"),l=!0):(s(h),l=!0),c.parentNode&&c.parentNode.removeChild(c),o&&o()}},h=document.createElement("input");h.id=e,h.value=i||"",n.parentNode.insertBefore(h,n.nextSibling),h.classList.add("userEditBoxPrompt"),r&&(n.style.display="none"),h.addEventListener("keydown",c(!0),!1),h.addEventListener("blur",c(!1),!1),window.setTimeout(function(){h.focus();if(i){var n=t.node(e),r=a?i.indexOf(a):-1;if(r>0)if(n.createTextRange){var s=n.createTextRange();s.collapse(!0),s.moveStart("character",0),s.moveEnd("character",r),s.select()}else n.setSelectionRange?n.setSelectionRange(0,r):n.selectionStart!==undefined&&(n.selectionStart=0,n.selectionEnd=r);else n.select()}},0)}function i(e){var t=window.navigator.platform.indexOf("Mac")!==-1;return t&&e.metaKey||!t&&e.ctrlKey}function s(e,t){t&&i(t)?window.open(e):window.location=e}function o(e,n){var r=document.createElement("button");return r.className="orionButton commandButton commandMargins",r.addEventListener("click",function(e){n(),t.stop(e)},!1),e&&r.appendChild(document.createTextNode(e)),r}function u(e,t,n){}return{getUserKeyString:n,getUserText:r,openInNewWindow:i,followLink:s,createButton:o,createDropdownButton:u}}),define("orion/PageUtil",[],function(){function t(t){t=t||window.location.toString();var n={resource:""},r=t.indexOf("#");if(r!==-1){var i=t.substring(r+1);if(i.length!==0){var s=i.split(",");Object.defineProperty(n,"resourceRaw",{value:s[0]}),n.resource=decodeURIComponent(s[0]),n.resource.match(e)||(n.resource=encodeURI(n.resource).replace(/%5B/g,"[").replace(/%5D/g,"]"));for(var o=1;o<s.length;o++){var u=s[o],a=/([^=]*)(=?)(.*)/.exec(u),f=decodeURIComponent(a[1]||""),l=decodeURIComponent(a[3]||"");f!==""&&f!=="resource"&&(n[f]=l)}}}return n}function r(e,t){var r=e;if(e.indexOf("://")===-1){var i=document.createElement("a");i.href=e,r=i.href}var s=!1;return t?s=t.some(function(e){return(new RegExp("^"+e+":","i")).test(r)}):s=n.test(r),s?e:(console.log("Illegal URL Scheme: '"+e+"'"),"")}var e=/^(?:[a-zA-Z0-9-_.!~*'()#;,\/?:@&=+$\[\]]|%[0-9A-F][0-9A-F])*$/,n=new RegExp("^http[s]?","i");return{matchResourceParameters:t,validateURLScheme:r}}),define("orion/explorers/navigationUtils",[],function(){function n(e,n,r,i){if(t)return;if(!e)return;e.push({domNode:n}),n.tabIndex=-1,n.style.outline="none"}function r(e,t,r){if(!e)return;var i=e.getGridNavHolder(t,!0);i&&n(i,r)}function i(e,t){if(!e)return;for(var n=0;n<e.length;n++)if(e[n].domNode===t){e.splice(n,1);return}}var e=navigator.userAgent,t=e.indexOf("iPad")!==-1;return{addNavGrid:r,generateNavGrid:n,removeNavGrid:i}}),define("orion/commandRegistry",["require","orion/commands","orion/uiUtils","orion/PageUtil","orion/webui/littlelib","orion/webui/dropdown","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/submenutriggerbutton.html","text!orion/webui/checkedmenuitem.html","orion/webui/tooltip","orion/explorers/navigationUtils"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e){this._commandList={},this._contributionsByScopeId={},this._activeBindings={},this._urlBindings={},this._init(e),this._parameterCollector=null}function h(e,t){this.token=e,this.parameterName=t}function p(e,t,n,r,i){this.name=e,this.type=t,this.label=n,this.value=r,this.lines=i||1}function d(e,t,n){this._storeParameters(e),this._hasOptionalParameters=t&&t.hasOptionalParameters,this._options=t,this.optionsRequested=!1,this.getParameters=n,this.clientCollect=t&&t.clientCollect}return c.prototype={_init:function(e){this._selectionService=e.selection;var n=this;t.setKeyBindingProvider(function(){return n._activeBindings})},processURL:function(e){for(var t in this._urlBindings)if(this._urlBindings[t]&&this._urlBindings[t].urlBinding&&this._urlBindings[t].command){var n=this._urlBindings[t].urlBinding.match(e);if(n){var r=this._urlBindings[t],i=r.command,s=r.invocation;if(s&&s.parameters&&i.callback){s.parameters.setValue(n.parameterName,n.parameterValue);var o=this;window.setTimeout(function(){o._invoke(s)},0);return}}}},findCommand:function(e){return this._commandList[e]},runCommand:function(e,n,r,i){var s=this;if(n){var o=this._commandList[e],u=o&&(o.visibleWhen?o.visibleWhen(n):!0);u&&o.callback&&s._invoke(new t.CommandInvocation(r,n,null,o,s),i)}else{var a=this._urlBindings[e];a&&a.command&&a.command.callback&&s._invoke(a.invocation,i)}},getSelectionService:function(){return this._selectionService},setParameterCollector:function(e){this._parameterCollector=e},openParameterCollector:function(e,t,n){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(e,t,n))},confirm:function(e,t,n,r,i,s){var o=!1;if(this._parameterCollector&&!i){var u=this;this._parameterCollector.close();var a=this._parameterCollector.open(e,function(e,i){var s=document.createElement("span");s.classList.add("parameterPrompt"),s.textContent=t,e.appendChild(s);var a=document.createElement("button");a.addEventListener("click",function(e){o=!0,u._parameterCollector.close()},!1),i.appendChild(a),a.appendChild(document.createTextNode(n)),a.className="dismissButton";var f=document.createElement("button");return f.addEventListener("click",function(e){o=!1,u._parameterCollector.close()},!1),i.appendChild(f),f.appendChild(document.createTextNode(r)),f.className="dismissButton",a},function(){s(o)});if(a)return}o=window.confirm(t),s(o)},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},_invoke:function(e,t){return this._collectAndInvoke(e.makeCopy(t),!1)},_collectAndInvoke:function(e,t){if(e)if(this._parameterCollector&&e.parameters&&e.parameters.hasParameters()&&(t||e.parameters.shouldCollectParameters())){var n=!1;e.parameters.updateParameters(e),n=this._parameterCollector.collectParameters(e);if(!n){var r=new f.Tooltip({node:e.domNode,trigger:"click",position:["below","right","above","left"]}),i=r.contentContainer();i.classList.add("parameterPopup");var s=window.document.activeElement,o=this._parameterCollector.getFillFunction(e,function(){s&&s.focus(),r.destroy()})(i);r.show(),window.setTimeout(function(){o.focus(),o.select()},0),n=!0}n||e.command.callback.call(e.handler||window,e)}else e.command.callback.call(e.handler||window,e);else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},collectParameters:function(e){this._collectAndInvoke(e,!0)},showKeyBindings:function(e){var t={},r,i,s;for(var o in this._activeBindings)i=this._activeBindings[o],i&&i.keyBinding&&i.command&&(i.keyBinding.scopeName?(t[i.keyBinding.scopeName]||(t[i.keyBinding.scopeName]=[]),t[i.keyBinding.scopeName].push(i)):(r=n.getUserKeyString(i.keyBinding),s=document.createElement("span"),s.role="listitem",s.appendChild(document.createTextNode(r+" = "+i.command.name)),s.appendChild(document.createElement("br")),e.appendChild(s)));for(var u in t)if(t[u].length&&t[u].length>0){var a=document.createElement("h2");e.appendChild(a),a.appendChild(document.createTextNode(u)),t[u].forEach(function(t){r=n.getUserKeyString(t.keyBinding),s=document.createElement("span"),s.role="listitem",s.appendChild(document.createTextNode(r+" = "+t.command.name)),s.appendChild(document.createElement("br")),e.appendChild(s)})}},addCommand:function(e){this._commandList[e.id]=e},addCommandGroup:function(e,t,n,r,i,s){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var o=this._contributionsByScopeId[e];i&&(o=this._createEntryForPath(o,i)),o[t]?(r&&(o[t].title=r),n&&(o[t].position=n),o[t].emptyGroupMessage=s):(o[t]={title:r,position:n,emptyGroupMessage:s,children:{}},o.sortedContributions=null)},_createEntryForPath:function(e,t){if(t){var n=t.split("/");n.forEach(function(t){t.length>1&&(e[t]||(e[t]={position:0,children:{}}),e=e[t].children)})}return e},registerSelectionService:function(e,t){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={}),this._contributionsByScopeId[e].localSelectionService=t},registerCommandContribution:function(e,t,n,r,i,s,o){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var u=this._contributionsByScopeId[e];r&&(u=this._createEntryForPath(u,r)),u[t]={position:n};var a;s&&(a=this._commandList[t],a&&(this._activeBindings[t]={command:a,keyBinding:s,bindingOnly:i})),o&&(a=this._commandList[t],a&&(this._urlBindings[t]={command:a,urlBinding:o,bindingOnly:i})),u.sortedContributions=null},_checkForTrailingSeparator:function(e,t,n){var r;if(t==="tool"||t==="button"){r=e.childNodes.length>0?e.childNodes[e.childNodes.length-1]:null;if(r&&r.classList.contains("commandSeparator"))return n?(e.removeChild(r),!1):!0}if(t==="menu"){var s=i.$$array("li > *",e);if(s.length>0&&s[s.length-1].classList.contains("dropdownSeparator"))return r=s[s.length-1],n?(r.parentNode.parentNode.removeChild(r.parentNode),!1):!0}return!1},renderCommands:function(e,t,n,r,s,o,u){if(typeof e!="string")throw"a scope id for rendering must be specified";t=i.node(t);if(!t)throw"no parent";var a=this._contributionsByScopeId[e];if(!n&&a){var f=a.localSelectionService||this._selectionService,l=this;f&&f.getSelections(function(n){l.renderCommands(e,t,n,r,s,o)});return}a&&(this._render(this._contributionsByScopeId[e],t,n,r,s||"button",o,u),this._checkForTrailingSeparator(t,s,!0))},destroy:function(e){e=i.node(e);if(!e)throw"no parent";while(e.hasChildNodes()){var t=e.firstChild;t.commandTooltip&&t.commandTooltip.destroy(),t.emptyGroupTooltip&&t.emptyGroupTooltip.destroy(),this.destroy(t),e.removeChild(t)}},_render:function(e,n,r,i,s,o,u){var a=e.sortedContributions;if(!a){a=[];var c=!1;for(var h in e)if(!e.hasOwnProperty||e.hasOwnProperty(h)){var p=e[h];p&&typeof p.position=="number"&&(p.id=h,a.push(p),c=!0)}c&&(a.sort(function(e,t){return e.position-t.position}),e.sortedContributions=a)}var d=0,v=this;a.forEach(function(e){var a,c;if(e.children&&Object.getOwnPropertyNames(e.children).length>0){var h=e.children,p;if(s==="tool"||s==="button")if(e.title)p=v._createDropdownMenu(n,e.title),u&&l.generateNavGrid(u,p.menuButton),window.setTimeout(function(){v._render(e.children,p.menu,r,i,"menu",o,u),v._checkForTrailingSeparator(p.menu,"menu",!0),p.menu.childNodes.length===0?e.emptyGroupMessage?p.menuButton.emptyGroupTooltip||(p.menuButton.emptyGroupTooltip=new f.Tooltip({node:p.menuButton,text:e.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})):(u&&l.removeNavGrid(u,p.menuButton),p.menu.parentNode&&p.menu.parentNode.removeChild(p.menu),p.destroyButton&&p.destroyButton.parentNode&&p.destroyButton.parentNode.removeChild(p.destroyButton)):p.menuButton.style.visibility="visible"},0);else{var m;n.childNodes.length>0&&!v._checkForTrailingSeparator(n,s)&&(m=v.generateSeparatorImage(n)),v._render(h,n,r,i,s,o,u);if(n.childNodes.length>0){var g=n.childNodes[n.childNodes.length-1];g!==m&&(m=v.generateSeparatorImage(n))}}else if(e.title){var y=v._createDropdownMenu(n,e.title,!0);y&&(v._render(h,y.menu,r,i,"menu",o,u),y.menu.childNodes.length===0&&y.destroyButton&&n.removeChild(y.destroyButton))}else n.childNodes.length>0&&v._generateMenuSeparator(n),v._render(h,n,r,i,s,o,u),v._generateMenuSeparator(n)}else{var b=v._commandList[e.id],w=b?!0:!1,E=null,S=null;if(b){c=new t.CommandInvocation(i,r,o,b,v),c.domParent=n;var x=w&&(b.visibleWhen?b.visibleWhen(r):!0);v._activeBindings[b.id]&&v._activeBindings[b.id].keyBinding&&(E=v._activeBindings[b.id],x?E.invocation=c:E.invocation=null,E.bindingOnly&&(w=!1)),v._urlBindings[b.id]&&v._urlBindings[b.id].urlBinding&&(S=v._urlBindings[b.id],x?S.invocation=c:S.invocation=null,S.bindingOnly&&(w=!1)),w=w&&x}if(w)if(b.choiceCallback){var T,N,C;s==="tool"||s==="button"?(T=n,C=!1,n.nodeName.toLowerCase()==="ul"?(T=document.createElement("li"),n.appendChild(T)):N="commandMargins"):(T=n,C=!0);var k=function(e){b.populateChoicesMenu(e,r,i,o,v)};v._createDropdownMenu(T,b.name,C,k.bind(b))}else{c.handler=c.handler||this,c.domParent=n;var L,A=function(e){v._invoke(c)};s==="menu"?L=t.createCommandMenuItem(n,b,c,null,A):(a=s+b.id+d,L=t.createCommandItem(n,b,c,a,null,s==="tool",A)),l.generateNavGrid(u,L),c.domNode=L,d++}}})},_createDropdownMenu:function(e,n,r,o){e=i.node(e);if(!e||!i.contains(document.body,e))return null;var a,f,l,c=e;if(r){var h=document.createRange();h.selectNode(e);var p=h.createContextualFragment(u);i.processTextNodes(p,{ButtonText:n}),e.appendChild(p),l=e.lastChild,f=l.lastChild,a=f.previousSibling,a.dropdown=new s.Dropdown({dropdown:f,populate:o}),f.dropdown=a.dropdown}else{e.nodeName.toLowerCase()==="ul"&&(c=document.createElement("li"),e.appendChild(c),l=c);var d=t.createDropdownMenu(c,n,o);a=d.menuButton,f=d.menu}return{menuButton:a,menu:f,dropdown:a.dropdown,destroyButton:l}},_generateMenuSeparator:function(e){if(!this._checkForTrailingSeparator(e,"menu")){var t=document.createElement("li");t.classList.add("dropdownSeparator");var n=document.createElement("span");n.classList.add("dropdownSeparator"),t.appendChild(n),e.appendChild(t)}},generateSeparatorImage:function(e){var t;return e.nodeName.toLowerCase()==="ul"?(t=document.createElement("li"),e.appendChild(t)):(t=document.createElement("span"),e.appendChild(t)),t.classList.add("core-sprite-sep"),t.classList.add("imageSprite"),t.classList.add("commandSeparator"),t}},c.prototype.constructor=c,h.prototype={match:function(e){var t=r.matchResourceParameters(e);return typeof t[this.token]!="undefined"?(this.parameterValue=t[this.token],this):null}},h.prototype.constructor=h,p.prototype={optionsRequested:function(){return this.optionsRequested}},p.prototype.constructor=p,d.prototype={_storeParameters:function(e){this.parameterTable=null;if(e){var t=this.parameterTable={};e.forEach(function(e){t[e.name]=e})}},updateParameters:function(e){typeof this.getParameters=="function"&&this._storeParameters(this.getParameters(e))},hasParameters:function(){return this.parameterTable!==null},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(e){return this.parameterTable[e]},valueFor:function(e){var t=this.parameterTable[e];return t?t.value:null},setValue:function(e,t){var n=this.parameterTable[e];n&&(n.value=t)},forEach:function(e){for(var t in this.parameterTable)this.parameterTable[t].type&&this.parameterTable[t].name&&e(this.parameterTable[t])},makeCopy:function(){var e=[];this.forEach(function(t){var n=new p(t.name,t.type,t.label,t.value,t.lines);e.push(n)});var t=new d(e,this._options,this.getParameters);return t.clientCollect=this.clientCollect,t},hasOptionalParameters:function(){return this._hasOptionalParameters}},d.prototype.constructor=d,{CommandRegistry:c,URLBinding:h,ParametersDescription:d,CommandParameter:p}}),function(e,t){typeof define=="function"&&define.amd?define("orion/Deferred",t):typeof exports=="object"?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function r(){var r;while(r=e.shift()||t.shift())r();n=!1}function i(i,s){var o=s?t:e;o.push(i),n||(n=!0,s?setTimeout(r,0):r())}function s(e){return function(){e.apply(null,arguments)}}function o(){}function u(){var e=new Error("Cancel");return e.name="Cancel",e}function a(){function f(){var r;while(r=n.shift()){var i=r.deferred,u=t==="resolved"?"resolve":"reject";if(typeof r[u]=="function")try{var a=r[u](e);a&&typeof a.then=="function"?(i.cancel=a.cancel||o,a.then(s(i.resolve),s(i.reject),i.progress)):i.resolve(a)}catch(f){i.reject(f)}else i[u](e)}}var e,t,n=[],r=this;this.reject=function(s,o){return t||(t="rejected",e=s,n.length&&i(f)),r.promise},this.resolve=function(s,o){return t||(t="resolved",e=s,n.length&&i(f)),r.promise},this.progress=function(e,i){return t||n.forEach(function(t){t.progress&&t.progress(e)}),r.promise},this.cancel=function(){t||r.reject(u())},this.then=function(e,s,o){var u={resolve:e,reject:s,progress:o,deferred:new a},l=u.deferred,c=!1,h=function(){if(c)return;c=!0,i(function(){var e=l.cancel===h?r.cancel:l.cancel;typeof e=="function"&&e()},!0)};return l.cancel=h,n.push(u),t&&i(f,!0),l.promise},this.promise=Object.create(Object.prototype,{then:{value:r.then},cancel:{get:function(){return r.cancel},set:function(e){r.cancel=e}}})}var e=[],t=[],n=!1;return a.all=function(e,t){function o(e,t){i||(r[e]=t,--n===0&&s.resolve(r))}function u(e,n){if(!i){if(t)try{o(e,t(n));return}catch(r){n=r}s.reject(n)}}var n=e.length,r=[],i=!1,s=new a;return s.then(null,function(){i=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),n===0?s.resolve(r):e.forEach(function(e,t){e.then(o.bind(null,t),u.bind(null,t))}),s.promise},a.when=function(e,t,n,r){var i,s;return e&&typeof e.then=="function"?i=e:(s=new a,s.resolve(e),i=s.promise),i.then(t,n,r)},a}),define("orion/compare/nls/root/messages",{"Copy current change from right to left":"Copy current change from right to left","Switch to unified diff":"Switch to unified diff",Unified:"Unified","Switch to side by side diff":"Switch to side by side diff","Side by side":"Side by side","Generate link of the current diff":"Generate link of the current diff","Generate Link":"Generate Link","Next diff block":"Next diff block","Previous diff block":"Previous diff block","Next diff change":"Next diff change","Previous diff change":"Previous diff change","Copy the link URL:":"Copy the link URL:",Compare:"Compare","Open the compare page":"Open the compare page","fetching...":"fetching...","There are unsaved changes.":"There are unsaved changes.","ERROR: ":"ERROR: ","Compare...":"Compare...","files changed":" files changed",Location:"Location",Options:"Options","Sort by folders":"Sort by folders","Line 0 : Col 0":"Line 0 : Col 0","No Matching DiffService for location:":"No Matching DiffService for location:"}),define("orion/compare/nls/messages",["orion/i18n!orion/compare/nls/messages","orion/compare/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/compare/diffParser",[],function(){var e=e||{};return e.DiffParser=function(){function n(t,n){this._lineDelimiter=t?t:e?"\r\n":"\n",this._diffLineDelimiter=n?n:this._lineDelimiter,this._DEBUG=!1}var e=window.navigator.platform.indexOf("Win")!==-1,t="\\ No newline at end of file";return n.prototype={_init:function(){this._oFileContents=[],this._diffContents=[],this._oBlocks=[],this._nBlocks=[],this._hunkRanges=[],this._lastToken=" ",this._deltaMap=[],this._nFileContents=[],this._oNewLineAtEnd=!0,this._nNewLineAtEnd=!0,this._diffContentIndex=1},setLineDelim:function(e){this._lineDelimiter=e,this._diffLineDelimiter=e},getDiffArray:function(){return{array:this._diffContents,index:this._diffContentIndex}},parse:function(e,t,n,r){this._init();if(t==="")return{outPutFile:e,mapper:[]};this._oFileContents=e===""?[]:e.split(this._lineDelimiter),this._diffContents=t.split(this._diffLineDelimiter);var i=this._diffContents.length;this._hunkRanges=[];for(var s=0;s<i;s++){var o=this._parseHunkRange(s);o&&this._hunkRanges.push(o)}if(0===this._hunkRanges.length)return{outPutFile:e,mapper:[]};this._DEBUG&&(console.log("***Diff contents: \n"),this._diffContents.forEach(function(e){console.log(e)}),console.log("***Hunk ranges: \n"),console.log(JSON.stringify(this._hunkRanges)));for(var u=0;u<this._hunkRanges.length;u++)this._parseHunkBlock(u);return this._DEBUG&&(console.log("***Original Hunk range blocks: \n"),console.log(JSON.stringify(this._oBlocks)),console.log("***New Hunk range blocks: \n"),console.log(JSON.stringify(this._nBlocks))),this._buildMap(n),this._DEBUG&&(console.log("***New Line at end of file(original): \n"),console.log(JSON.stringify(this._oNewLineAtEnd)),console.log("***New Line at end of file(new): \n"),console.log(JSON.stringify(this._nNewLineAtEnd)),console.log("***Mapper: \n"),this._logMap(),console.log("***Total line number in original file: "+this._oFileContents.length)),r||this._buildNewFile(),this._DEBUG,{outPutFile:this._nFileContents.join(this._diffLineDelimiter),mapper:this._deltaMap}},_logMap:function(){for(var e=0;e<this._deltaMap.length;e++){console.log(JSON.stringify(this._deltaMap[e]));if(this._deltaMap[e][2]>0){console.log("    **Diff content on change/add: \n");for(var t=0;t<this._deltaMap[e][0];t++)console.log("    "+this._diffContents[this._deltaMap[e][2]+t-1])}}},_logNewFile:function(){for(var e=0;e<this._nFileContents.length;e++)console.log(this._nFileContents[e])},_createBlock:function(e,t,n,r){if(r===n&&e===" ")return;var i=[n,r-n,"s"];e==="-"?i[2]="r":e==="+"?i[2]="a":e==="c"&&(i[2]="c"),t.push(i)},_createMinusBlock:function(e,t,n){var r=this._oBlocks.length;r===0||e!==this._oBlocks[r-1][0]?(this._oBlocks.push([e===0?1:e,n]),this._nBlocks.push([t,0,-2])):this._oBlocks[r-1][1]=this._oBlocks[r-1][1]+n},_createPlusBlock:function(e,t,n,r){var i=this._nBlocks.length;i===0||t!==this._nBlocks[i-1][0]?(this._oBlocks.push([e===0?1:e,0]),this._nBlocks.push([t,n,r])):(this._nBlocks[i-1][1]=this._nBlocks[i-1][1]+n,this._nBlocks[i-1][2]=r)},_parseHunkBlock:function(e){var n=" ",r=this._hunkRanges[e][0]+1,i=e===this._hunkRanges.length-1?this._diffContents.length:this._hunkRanges[e+1][0],s=0,o=0,u=this._hunkRanges[e][1],a=this._hunkRanges[e][3],f=r;for(var l=r;l<i;l++){if(0===this._diffContents[l].length)continue;var c=this._diffContents[l][0];if(c==="\\")if(t===this._diffContents[l].substring(0,this._diffContents[l].length-1)||t===this._diffContents[l]){n==="-"?this._oNewLineAtEnd=!1:n===" "?(this._nNewLineAtEnd=!1,this._oNewLineAtEnd=!1):this._nNewLineAtEnd=!1,l>r&&this._diffContents[l-1][this._diffContents[l-1].length-1]==="\r"&&(this._diffContents[l-1]=this._diffContents[l-1].substring(0,this._diffContents[l-1].length-1));continue}switch(c){case"-":case"+":case" ":break;default:continue}if(n!==c){c==="+"&&(f=l);switch(n){case" ":u=this._hunkRanges[e][1]+s,a=this._hunkRanges[e][3]+o;break;case"-":this._createMinusBlock(u,a,this._hunkRanges[e][1]+s-u);break;case"+":this._createPlusBlock(u,a,this._hunkRanges[e][3]+o-a,f);break;default:}n=c}switch(c){case"-":s++;break;case"+":o++;break;case" ":s++,o++}}switch(n){case"-":this._createMinusBlock(u,a,this._hunkRanges[e][1]+s-u);break;case"+":this._createPlusBlock(u,a,this._hunkRanges[e][3]+o-a,f)}},_detectConflictes:function(e,t){if(e<0)return!1;var n=e+t;for(var r=e;r<n;r++){var i=this._diffContents[r];if(i.indexOf("<<<<<")>-1||i.indexOf(">>>>>")>-1)return!0}return!1},_buildMap:function(e){var t=this._oBlocks.length,n=this._oFileContents.length,r=0,i,s=1;for(var o=0;o<t;o++)i=this._oBlocks[o][0]-s,i>0&&(this._deltaMap.push([i,i,0]),r+=i),e&&this._detectConflictes(this._nBlocks[o][2],this._nBlocks[o][1])?this._deltaMap.push([this._nBlocks[o][1],this._oBlocks[o][1],this._nBlocks[o][2]+1,1]):this._deltaMap.push([this._nBlocks[o][1],this._oBlocks[o][1],this._nBlocks[o][2]+1]),r+=this._oBlocks[o][1],s=this._oBlocks[o][0]+this._oBlocks[o][1];0<n-s&&(this._deltaMap.push([n-s+1,n-s+1,0]),r+=n-s+1);if(r<n){i=n-r;var u=this._deltaMap[this._deltaMap.length-1];u[2]===0?(u[0]+=i,u[1]+=i):u[2]===-1?this._deltaMap.push([i,i,0]):this._nNewLineAtEnd===this._oNewLineAtEnd?this._deltaMap.push([i,i,0]):(this._nNewLineAtEnd&&(u[0]+=i),this._oNewLineAtEnd&&(u[1]+=i))}},_buildNewFile:function(){var e=1,t=!1,n=this._deltaMap.length,r,i;for(r=0;r<n;r++){t=!1;if(this._deltaMap[r][2]===0){for(i=0;i<this._deltaMap[r][0];i++)this._nFileContents.push(this._oFileContents[e+i-1]);t=!0}else if(this._deltaMap[r][2]>0)for(i=0;i<this._deltaMap[r][0];i++)this._nFileContents.push(this._diffContents[this._deltaMap[r][2]+i-1].substring(1));e+=this._deltaMap[r][1]}this._nNewLineAtEnd&&!t&&this._nFileContents.push("")},_parseHRangeBody:function(e,t){if(0<e.indexOf(",")){var n=e.split(","),r=parseInt(n[0],10),i=parseInt(n[1],10);t.push(r>=0?r:1),t.push(i>=0?i:1)}else{var s=parseInt(e,10);t.push(s>=0?s:1),t.push(1)}},_parseHunkRange:function(e){var t=this._diffContents[e];if(8>t.length)return null;var n=t.substring(0,2);if("@@"!==n)return null;var r=t.substring(2),i=r.indexOf("@@");if(i<0)return null;var s=r.substring(0,i),o=s.indexOf("-"),u=s.indexOf("+");if(o<0||u<0)return null;var a,f=[e];return o<u?(a=s.substring(o+1).split("+"),this._parseHRangeBody(a[0],f),this._parseHRangeBody(a[1],f)):(a=s.substring(u+1).split("-"),this._parseHRangeBody(a[1],f),this._parseHRangeBody(a[0],f)),f}},n}(),e}),define("orion/URITemplate",[],function(){function n(e){this._text=e}function r(e,t){if(t==="U")return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});if(t==="U+R")return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]");if(t==="U+R-,")return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw new Error("Unknown allowed character set: "+t)}function i(e,t,n){var i=[];for(var s=0;s<e.length;s++)typeof e[s]!="undefined"&&i.push(r(e[s],t));return i.join(n)}function s(e,t,n,i){var s=Object.keys(e),o=[];for(var u=0;u<s.length;u++)typeof e[s[u]]!="undefined"&&o.push(r(s[u],t)+n+r(e[s[u]],t));return o.join(i)}function o(e){var n=[],r=e.split(",");for(var i=0;i<r.length;i++){var s=r[i].match(t);if(s===null)throw new Error("Bad VarSpec: "+e);n.push({name:s[1],explode:!!s[2],prefix:s[3]?parseInt(s[3],10):-1})}return n}function u(t){if(t.length===0)throw new Error("Invalid Expression: 0 length expression");this._operator=e[t[0]],this._operator?t=t.substring(1):this._operator=e.NUL,this._varSpecList=o(t)}function a(e){var t=[],r=0,i=e.indexOf("{",r);while(i!==-1){t.push(new n(e.substring(r,i)));var s=e.indexOf("}",i+1);if(s===-1)throw new Error("Invalid template: "+e);t.push(new u(e.substring(i+1,s))),r=s+1,i=e.indexOf("{",r)}return t.push(new n(e.substring(r))),t}function f(e){this._templateComponents=a(e)}var e={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},t=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/;return n.prototype={expand:function(e){return encodeURI(this._text)}},u.prototype={expand:function(e){var t=[];for(var n=0;n<this._varSpecList.length;n++){var o=this._varSpecList[n],u=o.name,a=e[u],f=typeof a;if(f!=="undefined"&&a!==null){var l=t.length===0?this._operator.first:this._operator.sep;if(f==="string")this._operator.named&&(l+=r(u,"U+R"),l+=a.length===0?this._operator.ifemp:"="),o.prefix!==-1&&o.prefix<a.length&&(a=a.substring(0,o.prefix)),l+=r(a,this._operator.allow);else if(Array.isArray(a))o.explode?l+=i(a,this._operator.allow,this._operator.sep):(this._operator.named&&(l+=r(u,"U+R"),l+=a.length===0?this._operator.ifemp:"="),l+=i(a,this._operator.allow,","));else{if(f!=="object")throw new Error("bad param type: "+u+" : "+f);o.explode?l+=s(a,this._operator.allow,"=",this._operator.sep):(this._operator.named&&(l+=r(u,"U+R"),l+=Object.keys(a).length===0?this._operator.ifemp:"="),l+=s(a,this._operator.allow,",",","))}t.push(l)}}return t.join("")}},f.prototype={expand:function(e){var t=[];for(var n=0;n<this._templateComponents.length;n++)t.push(this._templateComponents[n].expand(e));return t.join("")}},f}),define("orion/compare/compareUtils",["orion/URITemplate"],function(e){var t=t||{};return t.compareUtils=t.compareUtils||{},t.compareUtils.lookUpMapper=function(e,t,n){var r=0;for(var i=0;i<e.length;i++){var s=e[i][t];s===0&&(s=1);if(n>=r&&n<r+s)return{mapperIndex:i,startFrom:r};if(i===e.length-1)break;r+=e[i][t]}return{mapperIndex:e.length-1,startFrom:r}},t.compareUtils.lookUpLineIndex=function(e,t,n){if(n===0)return 0;var r=0;for(var i=0;i<n;i++)r+=e[i][t];return r},t.compareUtils.updateMapper=function(e,n,r,i,s){if(i===s)return;if(i>0||s>0){var o=t.compareUtils.lookUpMapper(e,n,r);if(o.mapperIndex<0)return;if(i>0){var u=i,a=r-o.startFrom;for(var f=o.mapperIndex;f<e.length;f++){var l=e[f][n]-a;if(u<=l){e[f][n]-=u;break}e[f][n]-=l,u-=l,a=0}}s>0&&(e[o.mapperIndex][n]+=s)}},t.compareUtils.overlapMapper=function(e,t,n,r,i){var s=n+e[t]-1;return s<n&&(s=n),i<r&&(i=r),s<r||i<n?!1:!0},t.compareUtils.findFirstDiff=function(e,n,r,i){var s=0,o=null;for(var u=0;u<e.length;u++){if(s>i)break;if(t.compareUtils.overlapMapper(e[u],n,s,r,i)){o={mapperIndex:u,startFrom:s};if(e[u][2]!==0)break}s+=e[u][n]}return o},t.compareUtils.matchMapper=function(e,n,r,i){if(e.length===0)return r;var s=r+Math.round((i-r)/3),o=t.compareUtils.findFirstDiff(e,n,r,i),u=e[o.mapperIndex][n]===0?o.startFrom:o.startFrom+e[o.mapperIndex][n]-1,a=t.compareUtils.lookUpLineIndex(e,1-n,o.mapperIndex),f=o.startFrom-r;if(e[o.mapperIndex][2]===0)return a-f;if(s>=o.startFrom&&s<=u)return a-Math.round((i-r)/3);if(s<o.startFrom)return a-f;var l=e[o.mapperIndex][1-n]===0?a:a+e[o.mapperIndex][1-n]-1;return l-(u-r)},t.compareUtils.getMapperLineCount=function(e){var t=0;for(var n=0;n<e.length;n++)t+=Math.max(e[n][0],e[n][1]);return t},t.compareUtils.getAnnotationIndex=function(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t)return n;return-1},t.compareUtils.getAnnotationMapperIndex=function(e,t){return e[t][1]},t.compareUtils.getAnnotationIndexByMapper=function(e,t){for(var n=0;n<e.length;n++)if(e[n][1]===t)return{current:n,prev:n-1,next:n+1};return{current:-1,prev:-1,next:-1}},t.compareUtils.isMapperConflict=function(e,t){return t<0?!1:e[t][3]?e[t][3]===1:!1},t.compareUtils.mergeDiffBlocks=function(e,t,n,r,i,s){for(var o=0;o<t.length;o++){var u=t[o][0],a=t[o][1],f=n[a];if(f[0]>0){var l="";for(var c=0;c<f[0];c++){var h=r[f[2]-1+c];l=l+h.substring(i)+s}var p=e.getLineCount();u>=p&&(u=p-1);var d=e.getLineStart(u);e.setText(l,d,d)}}},t.compareUtils.generateCompareHref=function(t,n){var r=require.toUrl("compare/compare.html");n.conflict||(n.conflict=undefined),n.readonly||(n.readonly=undefined);var i=(new e(r+"#{,resource,params*}")).expand({resource:t,params:n});return i},t.compareUtils.generateCompareTreeHref=function(t,n){var r=require.toUrl("compare-tree/compare-tree.html"),i=(new e(r+"#{,resource,params*}")).expand({resource:t,params:n});return i},t.compareUtils}),define("orion/compare/compareRulers",["orion/compare/compareUtils"],function(e){var t=t||{};return t.CompareRuler=function(){function e(e,t,n){this._location=e||"left",this._overview=t||"page",this._rulerStyle=n,this._editor=null;var r=this;this._listener={onModelChanged:function(e){r._onModelChanged(e)}}}return e.prototype={setView:function(e){this._onModelChanged&&this._editor&&this._editor.removeEventListener("ModelChanged",this._listener.onModelChanged),this._editor=e,this._onModelChanged&&this._editor&&this._editor.addEventListener("ModelChanged",this._listener.onModelChanged)},getLocation:function(){return this._location},getOverview:function(e){return this._overview},getAnnotationModel:function(){return null},addAnnotationType:function(e){},isAnnotationTypeVisible:function(e){return!1},removeAnnotationType:function(e){},setAnnotationModel:function(e){},getAnnotations:function(e,t){var n=[];for(var r=e;r<t;r++){var i=this.getStyle(r);i&&(n[r]={html:this.getHTML(r),style:i})}return n},getWidestAnnotation:function(){return{html:this.getHTML(-1),style:this.getStyle(-1)}},getRulerStyle:function(){return this.getStyle(undefined)}},e}(),t.LineNumberCompareRuler=function(){function e(e,n,r,i,s,o){t.CompareRuler.call(this,r,"page",i),this._diffNavigator=e,this._oddStyle=s||{style:{backgroundColor:"white"}},this._evenStyle=o||{style:{backgroundColor:"white"}},this._numOfDigits=0,this._mapperColumnIndex=n}return e.prototype=new t.CompareRuler,e.prototype.getStyle=function(e){return e===undefined?this._rulerStyle:this._evenStyle},e.prototype.getHTML=function(e){var t=this._editor.getModel(),n=this._diffNavigator.getFeeder(this._mapperColumnIndex===0);if(!n)return"";if(e===-1)return t.getLineCount();if(n.getLineNumber){var r=n.getLineNumber(e);return r===-1?"":r+1}return e+1},e.prototype._onModelChanged=function(e){var t=e.start,n=this._editor.getModel(),r=n.getLineCount(),i=(r+"").length;if(this._numOfDigits!==i){this._numOfDigits=i;var s=n.getLineAtOffset(t);this._editor.redrawLines(s,r,this)}},e}(),t.CompareOverviewRuler=function(){function n(e,n,r,i){this._diffNavigator=r,this._onClick=i,t.CompareRuler.call(this,e,"document",n)}return n.prototype=new t.CompareRuler,n.prototype.getStyle=function(t){var n,r;if(t===undefined)n=this._rulerStyle||{},r=n.style||(n.style={}),r.lineHeight="1px",r.fontSize="1px",r.width="14px";else{t!==-1?n={styleClass:"annotationOverview breakpoint"}||{}:n={},r=n.style||(n.style={}),r.cursor="pointer",r.width="8px",r.left="2px";if(!(t>=0))return null;var i;if(!this._diffNavigator||!this._diffNavigator.getFeeder())return null;i=this._diffNavigator.getFeeder().getDiffBlocks();var s=e.getAnnotationIndex(i,t);if(s===-1)return null;var o=e.getAnnotationMapperIndex(i,s),u;u=this._diffNavigator.getMapper();var a=e.isMapperConflict(u,o);a&&(r.border="1px #FF0000 solid"),s===this._diffNavigator.getCurrentBlockIndex()&&(r.backgroundColor=a?"red":"blue");var f=this._diffNavigator.getFeeder().getDiffBlockH(s),l=this._diffNavigator.getFeeder().getOverviewLineCount();if(f<0)return null;var c=this._editor.getClientArea(),h=Math.floor(c.height*f/l);h<2&&(h=2),r.height=h+"px"}return n},n.prototype.setDiffNavigator=function(e){this._diffNavigator=e},n.prototype.getHTML=function(e){return"&nbsp;"},n.prototype.onClick=function(e,t){if(e===undefined)return;this._onClick(e,this)},n.prototype._onModelChanged=function(e){var t=this._editor.getModel(),n=t.getLineCount();n>0&&this._editor.redrawLines(0,1,this)},n}(),t.CompareCurveRuler=function(){function t(e){this._canvasDiv=e,this._mapper=undefined}return t.prototype={init:function(e,t,n,r){this._leftIniting=!0,this._rightIniting=!0,this._rightIniting=!0,this._mapper=e,this._leftEditor=t,this._rightEditor=n,this._leftTextView=t.getTextView(),this._rightTextView=n.getTextView(),this._diffNavigator=r,this.render()},matchPositionFrom:function(t){var n=t?this._leftTextView:this._rightTextView,r=t?this._rightTextView:this._leftTextView,i=n.getTopIndex(),s=n.getBottomIndex(),o=e.matchMapper(this._mapper,t?0:1,i,s);r.setTopIndex(o)},copyTo:function(e){if(!this._diffNavigator.iterator)return;var t=this._diffNavigator.iterator.cursor();if(t){var n=e?this._rightTextView.getText(t.oldA.start,t.oldA.end):this._leftTextView.getText(t.newA.start,t.newA.end),r=e?t.newA:t.oldA,i=e?this._leftTextView:this._rightTextView;i.setText(n,r.start,r.end)}},render:function(){if(!this._mapper)return;var t=this._canvasDiv.getContext("2d");t.clearRect(0,0,this._canvasDiv.width,this._canvasDiv.height),t.strokeStyle="#AAAAAA",t.lineWidth=1,t.beginPath();var n=this._leftTextView.getTopIndex(),r=this._leftTextView.getBottomIndex(),i=this._rightTextView.getTopIndex(),s=this._rightTextView.getBottomIndex();this._leftLineH=this._leftTextView.getLineHeight(),this._rightLineH=this._rightTextView.getLineHeight();var o=0,u=0,a=!1;for(var f=0;f<this._mapper.length;f++){if(this._mapper[f][2]!==0)if(e.overlapMapper(this._mapper[f],0,o,n,r)||e.overlapMapper(this._mapper[f],1,u,i,s))this._renderCurve(f,o,u,this._canvasDiv,t,n,r,i,s),a=!0;else if(a)break;o+=this._mapper[f][0],u+=this._mapper[f][1]}t.stroke()},_renderCurve:function(e,t,n,r,i,s,o,u,a){var f=this._mapper[e],l=this._leftTextView.getLinePixel(t+f[0]/2)+f[0]%2*this._leftLineH/3-this._leftTextView.getTopPixel(),c=this._rightTextView.getLinePixel(n+f[1]/2)+f[1]%2*this._rightLineH/3-this._rightTextView.getTopPixel(),h=r.parentNode.clientWidth;if(e===this._diffNavigator.getCurrentMapperIndex()){i.stroke(),i.strokeStyle="#000",i.lineWidth=1,i.beginPath(),i.moveTo(0,l),i.bezierCurveTo(h/3,l,h*.666,c,h,c),i.stroke(),i.strokeStyle="#AAAAAA",i.lineWidth=1,i.beginPath();return}i.moveTo(0,l),i.bezierCurveTo(h/3,l,h*.666,c,h,c),i.stroke()},onChanged:function(t,n){var r=n?this._rightIniting:this._leftIniting;if(t.removedLineCount!==t.addedLineCount){var i=n?this._rightTextView:this._leftTextView;r||e.updateMapper(this._mapper,n?1:0,i.getModel().getLineAtOffset(t.start),t.removedLineCount,t.addedLineCount),(t.removedLineCount>0||t.addedLineCount>0)&&this.render()}return n?this._rightIniting=!1:this._leftIniting=!1,r}},t}(),t}),define("orion/editor/i18n",{load:function(e,t,n,r){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+e],function(e){n(e)}):n({})}}),define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"}),define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(e,t){var n={root:t};for(var r in e)e.hasOwnProperty(r)&&typeof n[r]=="undefined"&&(n[r]=e[r]);return n}),define("orion/keyBinding",["orion/util"],function(e){function t(e,t,n,r,i){typeof e=="string"?this.keyCode=e.toUpperCase().charCodeAt(0):this.keyCode=e,this.mod1=t!==undefined&&t!==null?t:!1,this.mod2=n!==undefined&&n!==null?n:!1,this.mod3=r!==undefined&&r!==null?r:!1,this.mod4=i!==undefined&&i!==null?i:!1}return t.prototype={match:function(t){if(this.keyCode===t.keyCode){var n=e.isMac?t.metaKey:t.ctrlKey;return this.mod1!==n?!1:this.mod2!==t.shiftKey?!1:this.mod3!==t.altKey?!1:e.isMac&&this.mod4!==t.ctrlKey?!1:!0}return!1},equals:function(e){return e?this.keyCode!==e.keyCode?!1:this.mod1!==e.mod1?!1:this.mod2!==e.mod2?!1:this.mod3!==e.mod3?!1:this.mod4!==e.mod4?!1:!0:!1}},{KeyBinding:t}}),define("orion/editor/eventTarget",[],function(){function e(){}return e.addMixin=function(t){var n=e.prototype;for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])},e.prototype={addEventListener:function(e,t,n){this._eventTypes||(this._eventTypes={});var r=this._eventTypes[e];r||(r=this._eventTypes[e]={level:0,listeners:[]});var i=r.listeners;i.push({listener:t,useCapture:n})},dispatchEvent:function(e){var t=e.type;this._dispatchEvent("pre"+t,e),this._dispatchEvent(t,e),this._dispatchEvent("post"+t,e)},_dispatchEvent:function(e,t){var n=this._eventTypes?this._eventTypes[e]:null;if(n){var r=n.listeners;try{n.level++;if(r)for(var i=0,s=r.length;i<s;i++)if(r[i]){var o=r[i].listener;typeof o=="function"?o.call(this,t):o.handleEvent&&typeof o.handleEvent=="function"&&o.handleEvent(t)}}finally{n.level--;if(n.compact&&n.level===0){for(var u=r.length-1;u>=0;u--)r[u]||r.splice(u,1);r.length===0&&delete this._eventTypes[e],n.compact=!1}}}},isListening:function(e){return this._eventTypes?this._eventTypes[e]!==undefined:!1},removeEventListener:function(e,t,n){if(!this._eventTypes)return;var r=this._eventTypes[e];if(r){var i=r.listeners;for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u&&u.listener===t&&u.useCapture===n){r.level!==0?(i[s]=null,r.compact=!0):i.splice(s,1);break}}i.length===0&&delete this._eventTypes[e]}}},{EventTarget:e}}),define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(e,t){function n(e,t){this._lastLineIndex=-1,this._text=[""],this._lineOffsets=[0],this.setText(e),this.setLineDelimiter(t)}return n.prototype={find:function(e){this._text.length>1&&(this._text=[this._text.join("")]);var t=e.string,n=e.regex,r=t;!n&&t&&(r=t.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var i=null,s;if(r){var o=e.reverse,u=e.wrap,a=e.wholeWord,f=e.caseInsensitive,l=e.start||0,c=e.end,h=e.end!==undefined,p="";p.indexOf("g")===-1&&(p+="g"),f&&p.indexOf("i")===-1&&(p+="i"),a&&(r="\\b"+r+"\\b");var d=this._text[0],v,m,g=0;h&&(d=d.substring(l,c),g=l);var y=new RegExp(r,p);o?s=function(){var e=null;y.lastIndex=0;for(;;){m=y.lastIndex,v=y.exec(d);if(m===y.lastIndex)return null;if(!v)break;if(v.index<l)e={start:v.index+g,end:y.lastIndex+g};else{if(!u||e)break;l=d.length,e={start:v.index+g,end:y.lastIndex+g}}}return e&&(l=e.start),e}:(h||(y.lastIndex=l),s=function(){for(;;){m=y.lastIndex,v=y.exec(d);if(m===y.lastIndex)return null;if(v)return{start:v.index+g,end:y.lastIndex+g};if(m!==0&&u)continue;break}return null}),i=s()}return{next:function(){var e=i;return e&&(i=s()),e},hasNext:function(){return i!==null}}},getCharCount:function(){var e=0;for(var t=0;t<this._text.length;t++)e+=this._text[t].length;return e},getLine:function(e,t){var n=this.getLineCount();if(0<=e&&e<n){var r=this._lineOffsets[e];if(e+1<n){var i=this.getText(r,this._lineOffsets[e+1]);if(t)return i;var s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13)s--;return i.substring(0,s)}return this.getText(r)}return null},getLineAtOffset:function(e){var t=this.getCharCount();if(0<=e&&e<=t){var n=this.getLineCount();if(e===t)return n-1;var r,i,s=this._lastLineIndex;if(0<=s&&s<n){r=this._lineOffsets[s],i=s+1<n?this._lineOffsets[s+1]:t;if(r<=e&&e<i)return s}var o=n,u=-1;while(o-u>1){s=Math.floor((o+u)/2),r=this._lineOffsets[s],i=s+1<n?this._lineOffsets[s+1]:t;if(e<=r)o=s;else{if(e<i){o=s;break}u=s}}return this._lastLineIndex=o,o}return-1},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(e,t){var n=this.getLineCount();if(0<=e&&e<n){if(e+1<n){var r=this._lineOffsets[e+1];if(t)return r;var i=this.getText(Math.max(this._lineOffsets[e],r-2),r),s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13)s--;return r-(i.length-s)}return this.getCharCount()}return-1},getLineStart:function(e){return 0<=e&&e<this.getLineCount()?this._lineOffsets[e]:-1},getText:function(e,t){e===undefined&&(e=0),t===undefined&&(t=this.getCharCount());if(e===t)return"";var n=0,r=0,i;while(r<this._text.length){i=this._text[r].length;if(e<=n+i)break;n+=i,r++}var s=n,o=r;while(r<this._text.length){i=this._text[r].length;if(t<=n+i)break;n+=i,r++}var u=n,a=r;if(o===a)return this._text[o].substring(e-s,t-u);var f=this._text[o].substring(e-s),l=this._text[a].substring(0,t-u);return f+this._text.slice(o+1,a).join("")+l},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,n){e==="auto"&&(e=undefined,this.getLineCount()>1&&(e=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0)))),this._lineDelimiter=e?e:t.platformDelimiter;if(n){var r=this.getLineCount();if(r>1){var i=new Array(r);for(var s=0;s<r;s++)i[s]=this.getLine(s);this.setText(i.join(this._lineDelimiter))}}},setText:function(e,t,n){e===undefined&&(e=""),t===undefined&&(t=0),n===undefined&&(n=this.getCharCount());if(t===n&&e==="")return;var r=this.getLineAtOffset(t),i=this.getLineAtOffset(n),s=t,o=n-t,u=i-r,a=e.length,f=0,l=this.getLineCount(),c=0,h=0,p=0,d=[];for(;;){c!==-1&&c<=p&&(c=e.indexOf("\r",p)),h!==-1&&h<=p&&(h=e.indexOf("\n",p));if(h===-1&&c===-1)break;c!==-1&&h!==-1?c+1===h?p=h+1:p=(c<h?c:h)+1:c!==-1?p=c+1:p=h+1,d.push(t+p),f++}var v={type:"Changing",text:e,start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(v);if(d.length===0){var m=this.getLineStart(r),g;i+1<l?g=this.getLineStart(i+1):g=this.getCharCount(),t!==m&&(e=this.getText(m,t)+e,t=m),n!==g&&(e+=this.getText(n,g),n=g)}var y=a-o;for(var b=r+u+1;b<l;b++)this._lineOffsets[b]+=y;var w=[r+1,u].concat(d);Array.prototype.splice.apply(this._lineOffsets,w);var E=0,S=0,x;while(S<this._text.length){x=this._text[S].length;if(t<=E+x)break;E+=x,S++}var T=E,N=S;while(S<this._text.length){x=this._text[S].length;if(n<=E+x)break;E+=x,S++}var C=E,k=S,L=this._text[N],A=this._text[k],O=L.substring(0,t-T),M=A.substring(n-C),_=[N,k-N+1];O&&_.push(O),e&&_.push(e),M&&_.push(M),Array.prototype.splice.apply(this._text,_),this._text.length===0&&(this._text=[""]);var D={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(D)}},e.EventTarget.addMixin(n.prototype),{TextModel:n}}),define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(e,t,n){function s(e){e=e||{},this._document=e.document||document}var r="orion-theme-",i={};return s.getTheme=function(e){e=e||"default";var t=i[e];return t||(t=i[e]=new s),t},s.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(e,t){var n=this,r=n._themeClass;n._themeClass=e,this._load(e,t,function(){n.onThemeChanged({type:"ThemeChanged",oldValue:r,newValue:n.getThemeClass()})})},onThemeChanged:function(e){return this.dispatchEvent(e)},buildStyleSheet:function(e,t){function i(t,r,i){n.push("."+e+" ."+t+" {"),n.push("	"+(i?"background-color":"color")+": "+r+";"),n.push("}")}var n=[];n.push("");var r=t.fontFamily;return r==="sans serif"?r='"Menlo", "Consolas", "Vera Mono", "monospace"':r="monospace",n.push("."+e+" {"),n.push("	font-family: "+r+";"),n.push("	font-size: "+t.fontSize+";"),n.push("	color: "+t.text+";"),n.push("}"),n.push("."+e+".textview {"),n.push("	background-color: "+t.background+";"),n.push("}"),i("ruler.annotations",t.annotationRuler,!0),i("ruler.lines",t.annotationRuler,!0),i("ruler.folding",t.annotationRuler,!0),i("ruler.overview",t.overviewRuler,!0),i("rulerLines",t.lineNumber,!1),i("rulerLines.even",t.lineNumberEven,!1),i("rulerLines.odd",t.lineNumberOdd,!1),i("annotationLine.currentLine",t.currentLine,!0),i("entity-name-tag",t.keyword,!1),i("entity-other-attribute-name",t.attribute,!1),i("string-quoted",t.string,!1),i("line_caret",t.currentLine,!0),i("token_keyword",t.keyword,!1),i("token_string",t.string,!1),i("token_singleline_comment",t.comment,!1),i("token_multiline_comment",t.comment,!1),i("token_doc_comment",t.comment,!1),i("token_doc_html_markup",t.comment,!1),n.join("\n")},_createStyle:function(e,t,i,s){var o=this._document,u=r+e,a=o.getElementById(u);if(a){if(s||a.firstChild.data===t)return;a.removeChild(a.firstChild),a.appendChild(o.createTextNode(t))}else{s?(a=n.createElement(o,"link"),a.rel="stylesheet",a.type="text/css",a.href=t,a.addEventListener("load",function(){i()})):(a=n.createElement(o,"style"),a.appendChild(o.createTextNode(t))),a.id=u;var f=o.getElementsByTagName("head")[0]||o.documentElement;f.appendChild(a)}s||i()},_load:function(t,n,r){if(!t){r();return}if(typeof n=="string"){this._createStyle(t,n,r);return}var i=n.href,s=".css";i.substring(i.length-s.length)!==s&&(i+=s);if(/^\//.test(i)||/[a-zA-Z0-9]+:\/\//i.test(i)||!e.toUrl)this._createStyle(t,i,r,!0);else{var o=this;e(["text!"+i],function(e){o._createStyle(t,e,r,!1)})}}},t.EventTarget.addMixin(s.prototype),{TextTheme:s}}),define("orion/editor/textView",["orion/editor/textModel","orion/keyBinding","orion/editor/eventTarget","orion/editor/textTheme","orion/util"],function(e,t,n,r,i){function s(e){return e.defaultView||e.parentWindow}function o(e,t,n,r){typeof e.addEventListener=="function"?e.addEventListener(t,n,r===!0):e.attachEvent("on"+t,n)}function u(e,t,n,r){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,r===!0):e.detachEvent("on"+t,n)}function a(e,t,n){if(n){t.className="";var r=t.attributes;for(var s=r.length;s-->0;)(!i.isIE||i.isIE>=9||i.isIE<9&&r[s].specified)&&t.removeAttribute(r[s].name)}if(!e)return;e.styleClass&&(t.className=e.styleClass);var o=e.style;if(o)for(var u in o)o.hasOwnProperty(u)&&(t.style[u]=o[u]);var a=e.attributes;if(a)for(var f in a)a.hasOwnProperty(f)&&t.setAttribute(f,a[f])}function f(e){return e instanceof Array?e.slice(0):e}function l(e,t){if(e===t)return!0;if(e&&!t||!e&&t)return!1;if(e&&e.constructor===String||t&&t.constructor===String)return!1;if(e instanceof Array||t instanceof Array){if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!l(e[n],t[n]))return!1;return!0}return!1}if(e instanceof Object&&t instanceof Object){var r;for(r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r))return!1;if(!l(e[r],t[r]))return!1}for(r in t)if(!e.hasOwnProperty(r))return!1;return!0}return!1}function c(e,t,n){var r=0,i=0,s=0,o=e.length;while(s<o){r!==-1&&r<=s&&(r=e.indexOf("\r",s)),i!==-1&&i<=s&&(i=e.indexOf("\n",s));var u=s,a;if(i===-1&&r===-1){t(e.substring(s));break}r!==-1&&i!==-1?r+1===i?(a=r,s=i+1):(a=r<i?r:i,s=(r<i?r:i)+1):r!==-1?(a=r,s=r+1):(a=i,s=i+1),t(e.substring(u,a)),n()}}function h(e){var t,n,r,i,o=s(e.ownerDocument);if(o.getComputedStyle){var u=o.getComputedStyle(e,null);t=u.getPropertyValue("border-left-width"),n=u.getPropertyValue("border-top-width"),r=u.getPropertyValue("border-right-width"),i=u.getPropertyValue("border-bottom-width")}else e.currentStyle&&(t=e.currentStyle.borderLeftWidth,n=e.currentStyle.borderTopWidth,r=e.currentStyle.borderRightWidth,i=e.currentStyle.borderBottomWidth);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(i,10)||0}}function p(e){var t,n,r,i,o=s(e.ownerDocument);if(o.getComputedStyle){var u=o.getComputedStyle(e,null);t=u.getPropertyValue("padding-left"),n=u.getPropertyValue("padding-top"),r=u.getPropertyValue("padding-right"),i=u.getPropertyValue("padding-bottom")}else e.currentStyle&&(t=e.currentStyle.paddingLeft,n=e.currentStyle.paddingTop,r=e.currentStyle.paddingRight,i=e.currentStyle.paddingBottom);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(i,10)||0}}function d(e){var t=e._trim;if(!t){t=p(e);var n=h(e);t.left+=n.left,t.top+=n.top,t.right+=n.right,t.bottom+=n.bottom,e._trim=t}return t}function m(e,t,n){this.start=e,this.end=t,this.caret=n}function g(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom}function y(e,t,n){this.view=e,this.lineIndex=t,this._lineDiv=n}function b(e){this._init(e||{})}var v=function(){function e(e){this.options=e}return e.prototype.play=function(){function l(){u=u===-1?(new Date).getTime():u;var t=(new Date).getTime(),l=(t-u)/e;if(l<1){var c=n(l);a=i+c*o,r(a)}else r(s),f.stop()}var e=typeof this.options.duration=="number"?this.options.duration:350,t=typeof this.options.rate=="number"?this.options.rate:20,n=this.options.easing||this.defaultEasing,r=this.options.onAnimate||function(){},i=this.options.curve[0],s=this.options.curve[1],o=s-i,u=-1,a,f=this;this.interval=this.options.window.setInterval(l,t)},e.prototype.stop=function(){this.options.window.clearInterval(this.interval);var e=this.options.onEnd||function(){};e()},e.prototype.defaultEasing=function(e){return Math.sin(e*(Math.PI/2))},e}();return m.prototype={clone:function(){return new m(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(e){this.caret?this.start=e:this.end=e;if(this.start>this.end){var t=this.start;this.start=this.end,this.end=t,this.caret=!this.caret}},setCaret:function(e){this.start=e,this.end=e,this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&this.start===e.start&&this.end===e.end}},g.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}},y.prototype={create:function(e,t){if(this._lineDiv)return;var n=this._lineDiv=this._createLine(e,t,this.lineIndex);return n._line=this,n},_createLine:function(e,t,n){var r=this.view,s=r._model,o=s.getLine(n),u=s.getLineStart(n),f={type:"LineStyle",textView:r,lineIndex:n,lineText:o,lineStart:u};o.length<2e3&&r.onLineStyle(f);var c=t||i.createElement(e.ownerDocument,"div");if(!t||!l(t.viewStyle,f.style))a(f.style,c,t),t&&(t._trim=null),c.viewStyle=f.style,c.setAttribute("role","presentation");c.lineIndex=n;var h=[],p={tabOffset:0,ranges:h};this._createRanges(f.ranges,o,0,o.length,u,p);var d=" ";!r._fullSelection&&i.isIE<9&&(d="\ufeff"),i.isWebkit&&(d="\u200c"),h.push({text:d,style:r._metrics.largestFontStyle,ignoreChars:1});var v,m,g,y,b,w,E,S=0,x=0,T,N,C;if(t){var k=t.modelChangedEvent;k&&(k.removedLineCount===0&&k.addedLineCount===0?(C=k.start-u,N=k.addedCharCount-k.removedCharCount):C=-1,t.modelChangedEvent=undefined),y=t.firstChild}for(var L=0;L<h.length;L++){v=h[L],w=v.text,S+=w.length,g=v.style;if(y){E=y.firstChild.data,b=y.viewStyle;if(E===w&&l(g,b)){x+=E.length,y._rectsCache=undefined,m=y=y.nextSibling;continue}while(y){if(C!==-1){var A=S;A>=C&&(A-=N);var O=y.firstChild.data,M=O?O.length:0;if(x+M>A)break;x+=M}T=y.nextSibling,c.removeChild(y),y=T}}m=this._createSpan(c,w,g,v.ignoreChars),y?c.insertBefore(m,y):c.appendChild(m),t&&(t.lineWidth=undefined)}if(t){var _=m?m.nextSibling:null;while(_)T=_.nextSibling,t.removeChild(_),_=T}else e.appendChild(c);return c},_createRanges:function(e,t,n,r,i,s){if(n>=r)return;if(e)for(var o=0;o<e.length;o++){var u=e[o];if(u.end<=i+n)continue;var a=Math.max(i+n,u.start)-i;if(a>=r)break;var f=Math.min(i+r,u.end)-i;if(a<f){a=Math.max(n,a),f=Math.min(r,f),n<a&&this._createRange(t,n,a,null,s);while(o+1<e.length&&e[o+1].start-i===f&&l(u.style,e[o+1].style))u=e[o+1],f=Math.min(i+r,u.end)-i,o++;this._createRange(t,a,f,u.style,s),n=f}}n<r&&this._createRange(t,n,r,null,s)},_createRange:function(e,t,n,r,i){if(t>=n)return;var s=this.view._customTabSize,o;if(s&&s!==8){var u=e.indexOf("	",t);while(u!==-1&&u<n){t<u&&(o={text:e.substring(t,u),style:r},i.ranges.push(o),i.tabOffset+=o.text.length);var a=s-i.tabOffset%s;if(a>0){var f="\u00a0";for(var l=1;l<a;l++)f+=" ";o={text:f,style:r,ignoreChars:a-1},i.ranges.push(o),i.tabOffset+=o.text.length}t=u+1,u=e.indexOf("	",t)}}t<n&&(o={text:e.substring(t,n),style:r},i.ranges.push(o),i.tabOffset+=o.text.length)},_createSpan:function(e,t,n,r){var s=n&&n.tagName==="A";s&&(e.hasLink=!0);var u=s&&this.view._linksVisible?"a":"span",f=e.ownerDocument,l=i.createElement(e.ownerDocument,u);l.appendChild(f.createTextNode(t)),a(n,l);if(u==="A"){var c=this.view,h=this._getWindow();o(l,"click",function(e){return c._handleLinkClick(e?e:h.event)},!1)}return l.viewStyle=n,r&&(l.ignoreChars=r),l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,t){var n=this._ensureCreated(),r=this.view;if(e===undefined)return this._getLineBoundingClientRect(n,!0);var o=r._model,u=n.ownerDocument,a=this.lineIndex,f=null;if(e<o.getLineEnd(a)){var l=o.getLineStart(a),c=n.firstChild;while(c){var h=c.firstChild,p=h.length;c.ignoreChars&&(p-=c.ignoreChars);if(l+p>e){var d=e-l,v;if(r._isRangeRects)v=u.createRange(),v.setStart(h,d),v.setEnd(h,d+1),f=new g(v.getBoundingClientRect());else if(i.isIE)v=u.body.createTextRange(),v.moveToElementText(c),v.collapse(),v.moveEnd("character",d+1),v.moveStart("character",d),f=new g(v.getBoundingClientRect());else{var m=h.data;c.removeChild(h),c.appendChild(u.createTextNode(m.substring(0,d)));var y=i.createElement(u,"span");y.appendChild(u.createTextNode(m.substring(d,d+1))),c.appendChild(y),c.appendChild(u.createTextNode(m.substring(d+1))),f=new g(y.getBoundingClientRect()),c.innerHTML="",c.appendChild(h);if(!this._createdDiv){var b=r._getSelection();(l<=b.start&&b.start<l+p||l<=b.end&&b.end<l+p)&&r._updateDOMSelection()}}if(i.isIE){var w=s(n.ownerDocument),E=w.screen.logicalXDPI/w.screen.deviceXDPI,S=w.screen.logicalYDPI/w.screen.deviceYDPI;f.left=f.left*E,f.right=f.right*E,f.top=f.top*S,f.bottom=f.bottom*S}break}l+=p,c=c.nextSibling}}var x=this.getBoundingClientRect();if(!f)if(r._wrapMode){var T=this.getClientRects();f=T[T.length-1],f.left=f.right,f.left+=x.left,f.top+=x.top,f.right+=x.left,f.bottom+=x.top}else f=new g(x),f.left=f.right;if(t||t===undefined)f.left-=x.left,f.top-=x.top,f.right-=x.left,f.bottom-=x.top;return f},_getClientRects:function(e,t){var n,r,i,s;if(!e._rectsCache){n=e.getClientRects(),r=new Array(n.length);for(s=0;s<n.length;s++)i=r[s]=new g(n[s]),i.left-=t.left,i.top-=t.top,i.right-=t.left,i.bottom-=t.top;e._rectsCache=r}n=e._rectsCache,r=[n.length];for(s=0;s<n.length;s++)r[s]=new g(n[s]);return r},getClientRects:function(e){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var t=this._ensureCreated(),n=[],r=t.firstChild,i,s,o=t.getBoundingClientRect();while(r){var u=this._getClientRects(r,o);for(i=0;i<u.length;i++){var a=u[i],f;if(a.top===a.bottom)continue;var l=a.top+(a.bottom-a.top)/2;for(f=0;f<n.length;f++){s=n[f];if(s.top<=l&&l<s.bottom)break}f===n.length?n.push(a):(a.left<s.left&&(s.left=a.left),a.top<s.top&&(s.top=a.top),a.right>s.right&&(s.right=a.right),a.bottom>s.bottom&&(s.bottom=a.bottom))}r=r.nextSibling}return e!==undefined?n[e]:n},_getLineBoundingClientRect:function(e,t){var n=new g(e.getBoundingClientRect());if(!this.view._wrapMode){n.right=n.left;var r=e.lastChild;while(r&&r.ignoreChars===r.firstChild.length)r=r.previousSibling;if(r){var i=r.getBoundingClientRect();n.right=i.right+d(e).right}}if(t){var s=d(e);n.left=n.left+s.left,n.right=n.right-s.right}return n},getLineCount:function(){return this.view._wrapMode?this.getClientRects().length:1},getLineIndex:function(e){if(!this.view._wrapMode)return 0;var t=this.getClientRects(),n=this.getBoundingClientRect(e),r=n.top+(n.bottom-n.top)/2;for(var i=0;i<t.length;i++)if(t[i].top<=r&&r<t[i].bottom)return i;return t.length-1},getLineStart:function(e){if(!this.view._wrapMode||e===0)return this.view._model.getLineStart(e);var t=this.getClientRects();return this.getOffset(t[e].left+1,t[e].top+1)},getOffset:function(e,t){var n=this.view,r=n._model,o=this.lineIndex,u=r.getLineStart(o),a=r.getLineEnd(o);if(u===a)return u;var f=this._ensureCreated(),l=this.getBoundingClientRect(),c,h;if(n._wrapMode){c=this.getClientRects(),t<c[0].top&&(t=c[0].top);for(var p=0;p<c.length;p++){h=c[p];if(h.top<=t&&t<h.bottom)break}e<h.left&&(e=h.left),e>h.right&&(e=h.right-1)}else e<0&&(e=0),e>l.right-l.left&&(e=l.right-l.left);var d=f.ownerDocument,v=s(d),m=i.isIE?v.screen.logicalXDPI/v.screen.deviceXDPI:1,g=i.isIE?v.screen.logicalYDPI/v.screen.deviceYDPI:1,y=u,b=f.firstChild;e:while(b){var w=b.firstChild,E=w.length;b.ignoreChars&&(E-=b.ignoreChars);var S,x,T,N;c=this._getClientRects(b,l);for(var C=0;C<c.length;C++){h=c[C];if(h.left<=e&&e<h.right&&(!n._wrapMode||h.top<=t&&t<h.bottom)){var k,L,A;if(i.isIE||n._isRangeRects){k=n._isRangeRects?d.createRange():d.body.createTextRange();var O=E,M=-1;while(O-M>1){var _=Math.floor((O+M)/2);L=M+1,A=_===E-1&&b.ignoreChars?w.length:_+1,n._isRangeRects?(k.setStart(w,L),k.setEnd(w,A)):(k.moveToElementText(b),k.move("character",L),k.moveEnd("character",A-L)),c=k.getClientRects();var D=!1;for(var P=0;P<c.length;P++){h=c[P],S=h.left*m-l.left,T=h.right*m-l.left,x=h.top*g-l.top,N=h.bottom*g-l.top;if(S<=e&&e<T&&(!n._wrapMode||x<=t&&t<N)){D=!0;break}}D?O=_:M=_}y+=O,L=O,A=O===E-1&&b.ignoreChars?w.length:Math.min(O+1,w.length),n._isRangeRects?(k.setStart(w,L),k.setEnd(w,A)):(k.moveToElementText(b),k.move("character",L),k.moveEnd("character",A-L)),h=k.getClientRects()[0],S=h.left*m-l.left,T=h.right*m-l.left,e>S+(T-S)/2&&y++}else{var H=[];for(var B=0;B<E;B++)H.push("<span>"),B===E-1?H.push(w.data.substring(B)):H.push(w.data.substring(B,B+1)),H.push("</span>");b.innerHTML=H.join("");var j=b.firstChild;while(j){h=j.getBoundingClientRect(),S=h.left-l.left,T=h.right-l.left;if(S<=e&&e<T){e>S+(T-S)/2&&y++;break}y++,j=j.nextSibling}if(!this._createdDiv){b.innerHTML="",b.appendChild(w);var F=n._getSelection();(y<=F.start&&F.start<y+E||y<=F.end&&F.end<y+E)&&n._updateDOMSelection()}}break e}}y+=E,b=b.nextSibling}return Math.min(a,Math.max(u,y))},getNextOffset:function(e,t,n){if(t==="line"){var r=this.view,s=r._model,o=s.getLineAtOffset(e);return n>0?s.getLineEnd(o):s.getLineStart(o)}return t==="wordend"?this._getNextOffset_W3C(e,t,n):i.isIE?this._getNextOffset_IE(e,t,n):this._getNextOffset_W3C(e,t,n)},_getNextOffset_W3C:function(e,t,n){function r(e){return 33<=e&&e<=47||58<=e&&e<=64||91<=e&&e<=94||e===96||123<=e&&e<=126}function i(e){return e===32||e===9}if(t==="word"||t==="wordend"){var s=this.view,o=s._model,u=o.getLineAtOffset(e),a=o.getLine(u),f=o.getLineStart(u),l=o.getLineEnd(u),c=a.length,h=e-f,p,d,v,m,g;if(n>0){if(h===c)return l;p=a.charCodeAt(h),d=r(p),v=!d&&!i(p),h++;while(h<c){p=a.charCodeAt(h),m=r(p);if(t==="wordend"){if(!m&&d)break}else if(m&&!d)break;g=!m&&!i(p);if(t==="wordend"){if(!g&&v)break}else if(g&&!v)break;v=g,d=m,h++}}else{if(h===0)return f;h--,p=a.charCodeAt(h),d=r(p),v=!d&&!i(p);while(0<h){p=a.charCodeAt(h-1),m=r(p);if(t==="wordend"){if(m&&!d)break}else if(!m&&d)break;g=!m&&!i(p);if(t==="wordend"){if(g&&!v)break}else if(!g&&v)break;v=g,d=m,h--}}return f+h}return e+n},_getNextOffset_IE:function(e,t,n){var r=this._ensureCreated(),i=this.view,s=i._model,o=this.lineIndex,u=0,a,f,l=s.getLineStart(o),c=r.ownerDocument,h;if(e===s.getLineEnd(o)){h=r.lastChild;while(h&&h.ignoreChars)h=h.previousSibling;if(!h)return l;a=c.body.createTextRange(),a.moveToElementText(h),f=a.text.length,a.moveEnd(t,n),u=e+a.text.length-f}else if(e===l&&n<0)u=l;else{h=r.firstChild;while(h){var p=h.firstChild,d=p.length;h.ignoreChars&&(d-=h.ignoreChars);if(l+d>e){a=c.body.createTextRange(),e===l&&n<0?a.moveToElementText(h.previousSibling):(a.moveToElementText(h),a.collapse(),a.moveEnd("character",e-l)),f=a.text.length,a.moveEnd(t,n),u=e+a.text.length-f;break}l=d+l,h=h.nextSibling}}return u},destroy:function(){var e=this._createdDiv;e&&(e.parentNode.removeChild(e),this._createdDiv=null)}},b.prototype={addRuler:function(e,t){e.setView(this);var n=this._rulers;if(t!==undefined){var r,i;for(r=0,i=0;r<n.length&&i<t;r++)e.getLocation()===n[r].getLocation()&&i++;n.splice(i,0,e),t=i}else n.push(e);this._createRuler(e,t),this._update()},computeSize:function(){var e=0,t=0,n=this._model,r=this._clientDiv;if(!r)return{width:e,height:t};var s=r.style.width;i.isWebkit&&(r.style.width="0x7fffffffpx");var o=n.getLineCount();for(var u=0;u<o;u++){var a=this._getLine(u),f=a.getBoundingClientRect();e=Math.max(e,f.right-f.left),t+=f.bottom-f.top,a.destroy()}i.isWebkit&&(r.style.width=s);var l=this._getViewPadding();return e+=l.right+l.left+this._metrics.scrollWidth,t+=l.bottom+l.top+this._metrics.scrollWidth,{width:e,height:t}},convert:function(e,t,n){if(!this._clientDiv)return;var r=this._getScroll(),i=this._getViewPadding(),s=this._viewDiv.getBoundingClientRect();return t==="document"&&(e.x!==undefined&&(e.x+=-r.x+s.left+i.left),e.y!==undefined&&(e.y+=-r.y+s.top+i.top)),n==="document"&&(e.x!==undefined&&(e.x+=r.x-s.left-i.left),e.y!==undefined&&(e.y+=r.y-s.top-i.top)),e},destroy:function(){for(var e=0;e<this._rulers.length;e++)this._rulers[e].setView(null);this.rulers=null,this._destroyView();var t={type:"Destroy"};this.onDestroy(t),this._parent=null,this._model=null,this._theme=null,this._selection=null,this._doubleClickSelection=null,this._keyBindings=null,this._actions=null},focus:function(){if(!this._clientDiv)return;this._updateDOMSelection(),i.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection()},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){var t=this._actions[e];return t?t.actionDescription:undefined},getActions:function(e){var t=[],n=this._actions;for(var r in n)if(n.hasOwnProperty(r)){if(!e&&n[r].defaultHandler)continue;t.push(r)}return t},getBottomIndex:function(e){return this._clientDiv?this._getBottomIndex(e):0},getBottomPixel:function(){return this._clientDiv?this._getScroll().y+this._getClientHeight():0},getCaretOffset:function(){var e=this._getSelection();return e.getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return this._clientDiv?this._getScroll().x:0},getKeyBindings:function(e){var t=[],n=this._keyBindings;for(var r=0;r<n.length;r++)n[r].actionID===e&&t.push(n[r].keyBinding);return t},getLineHeight:function(e){return this._clientDiv?this._getLineHeight(e):0},getLineIndex:function(e){return this._clientDiv?this._getLineIndex(e):0},getLinePixel:function(e){return this._clientDiv?this._getLinePixel(e):0},getLocationAtOffset:function(e){if(!this._clientDiv)return{x:0,y:0};var t=this._model;e=Math.min(Math.max(0,e),t.getCharCount());var n=t.getLineAtOffset(e),r=this._getLine(n),i=r.getBoundingClientRect(e);r.destroy();var s=i.left,o=this._getLinePixel(n)+i.top;return{x:s,y:o}},getOptions:function(){var e;if(arguments.length===0)e=this._defaultOptions();else if(arguments.length===1){var t=arguments[0];if(typeof t=="string")return f(this["_"+t]);e=t}else{e={};for(var n in arguments)arguments.hasOwnProperty(n)&&(e[arguments[n]]=undefined)}for(var r in e)e.hasOwnProperty(r)&&(e[r]=f(this["_"+r]));return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,t){if(!this._clientDiv)return 0;var n=this._getLineIndex(t),r=this._getLine(n),i=r.getOffset(e,t-this._getLinePixel(n));return r.destroy(),i},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var e=this._getSelection();return{start:e.start,end:e.end}},getText:function(e,t){var n=this._model;return n.getText(e,t)},getTopIndex:function(e){return this._clientDiv?this._getTopIndex(e):0},getTopPixel:function(){return this._clientDiv?this._getScroll().y:0},invokeAction:function(e,t){if(!this._clientDiv)return;var n=this._actions[e];if(n){if(!t&&n.handler&&n.handler())return;if(n.defaultHandler)return n.defaultHandler()}return!1},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onKeyDown:function(e){return this.dispatchEvent(e)},onKeyPress:function(e){return this.dispatchEvent(e)},onKeyUp:function(e){return this.dispatchEvent(e)},onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},redraw:function(){if(this._redrawCount>0)return;var e=this._model.getLineCount();this.redrawRulers(0,e),this.redrawLines(0,e)},redrawRulers:function(e,t){if(this._redrawCount>0)return;var n=this.getRulers();for(var r=0;r<n.length;r++)this.redrawLines(e,t,n[r])},redrawLines:function(e,t,n){if(this._redrawCount>0)return;e===undefined&&(e=0),t===undefined&&(t=this._model.getLineCount());if(e===t)return;var r=this._clientDiv;if(!r)return;if(n){var i=n.getLocation(),s=i==="left"?this._leftDiv:this._rightDiv;r=s.firstChild;while(r){if(r._ruler===n)break;r=r.nextSibling}}n?r.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(e,t);if(!n||n.getOverview()==="page"){var o=r.firstChild;while(o){var u=o.lineIndex;e<=u&&u<t&&(o.lineChanged=!0),o=o.nextSibling}}n||this._wrapMode||e<=this._maxLineIndex&&this._maxLineIndex<t&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._queueUpdate()},redrawRange:function(e,t){if(this._redrawCount>0)return;var n=this._model;e===undefined&&(e=0),t===undefined&&(t=n.getCharCount());var r=n.getLineAtOffset(e),i=n.getLineAtOffset(Math.max(e,t-1))+1;this.redrawLines(r,i)},removeRuler:function(e){var t=this._rulers;for(var n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1),e.setView(null),this._destroyRuler(e),this._update();break}},resize:function(){if(!this._clientDiv)return;this._handleResize(null)},setAction:function(e,t,n){if(!e)return;var r=this._actions,i=r[e];i||(i=r[e]={}),i.handler=t,i.actionDescription=n},setKeyBinding:function(e,t){var n=this._keyBindings;for(var r=0;r<n.length;r++){var i=n[r];if(i.keyBinding.equals(e)){t?i.actionID=t:i.predefined?i.actionID=null:n.splice(r,1);return}}t&&n.push({keyBinding:e,actionID:t})},setCaretOffset:function(e,t,n){var r=this._model.getCharCount();e=Math.max(0,Math.min(e,r));var i=new m(e,e,!1);this._setSelection(i,t===undefined||t,!0,n)},setHorizontalPixel:function(e){if(!this._clientDiv)return;e=Math.max(0,e),this._scrollView(e-this._getScroll().x,0)},setRedraw:function(e){e?--this._redrawCount===0&&this.redraw():this._redrawCount++},setModel:function(e){if(!e)return;if(e===this._model)return;this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged);var t=this._model.getLineCount(),n=this._model.getCharCount(),r=e.getLineCount(),i=e.getCharCount(),s=e.getText(),o={type:"ModelChanging",text:s,start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r};this.onModelChanging(o),this._model=e,o={type:"ModelChanged",start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r},this.onModelChanged(o),this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._reset(),this._update()},setOptions:function(e){var t=this._defaultOptions();for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=this["_"+n];if(l(i,r))continue;var s=t[n]?t[n].update:null;if(s){s.call(this,r);continue}this["_"+n]=f(r)}},setSelection:function(e,t,n,r){var i=e>t;if(i){var s=e;e=t,t=s}var o=this._model.getCharCount();e=Math.max(0,Math.min(e,o)),t=Math.max(0,Math.min(t,o));var u=new m(e,t,i);this._setSelection(u,n===undefined||n,!0,r)},setText:function(e,t,n){var r=t===undefined&&n===undefined;t===undefined&&(t=0),n===undefined&&(n=this._model.getCharCount()),this._modifyContent({text:e,start:t,end:n,_code:!0},!r),r&&(this._columnX=-1,this._setSelection(new m(0,0,!1),!0),i.isFirefox&&this._fixCaret())},setTopIndex:function(e){if(!this._clientDiv)return;this._scrollView(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y)},setTopPixel:function(e){if(!this._clientDiv)return;this._scrollView(0,Math.max(0,e)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(e,t){if(!this._clientDiv)return;e&&this._updateStyle(),t===undefined||t?this._update():this._queueUpdate()},_handleRootMouseDown:function(e){i.isFirefox&&e.which===1&&(this._clientDiv.contentEditable=!1,(this._overlayDiv||this._clientDiv).draggable=!0,this._ignoreBlur=!0);var t=this._overlayDiv||this._clientDiv;i.isIE<9&&(t=this._viewDiv);var n=e.target?e.target:e.srcElement;while(n){if(t===n)return;n=n.parentNode}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();if(!this._isW3CEvents){var r=this,s=this._getWindow();s.setTimeout(function(){r._clientDiv.focus()},0)}},_handleRootMouseUp:function(e){i.isFirefox&&e.which===1&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(e){if(this._ignoreBlur)return;this._hasFocus=!1;if(i.isIE<9&&!this._getSelection().isEmpty()){var t=this._rootDiv,n=i.createElement(t.ownerDocument,"div");t.appendChild(n),t.removeChild(n)}if(this._selDiv1){var r="lightgray";this._selDiv1.style.background=r,this._selDiv2.style.background=r,this._selDiv3.style.background=r;var s,o=this._getWindow(),u=this._selDiv1.ownerDocument;if(o.getSelection){var a=o.getSelection();s=a.anchorNode;while(s){if(s===this._clientDiv){a.rangeCount>0&&a.removeAllRanges();break}s=s.parentNode}}else if(u.selection){this._ignoreSelect=!1,s=u.selection.createRange().parentElement();while(s){if(s===this._clientDiv){u.selection.empty();break}s=s.parentNode}this._ignoreSelect=!0}}this._ignoreFocus||this.onBlur({type:"Blur"})},_handleContextMenu:function(e){i.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var t=!1;if(this.isListening("ContextMenu")){var n=this._createMouseEvent("ContextMenu",e);n.screenX=e.screenX,n.screenY=e.screenY,this.onContextMenu(n),t=n.defaultPrevented}else i.isMac&&i.isFirefox&&e.button===0&&(t=!0);if(t)return e.preventDefault&&e.preventDefault(),!1},_handleCopy:function(e){if(this._ignoreCopy)return;if(this._doCopy(e))return e.preventDefault&&e.preventDefault(),!1},_handleCut:function(e){if(this._doCut(e))return e.preventDefault&&e.preventDefault(),!1},_handleDataModified:function(e){this._startIME()},_handleDblclick:function(e){var t=e.timeStamp?e.timeStamp:(new Date).getTime();this._lastMouseTime=t,this._clickCount!==2&&(this._clickCount=2,this._handleMouse(e))},_handleDragStart:function(e){if(i.isFirefox){var t=this,n=this._getWindow();n.setTimeout(function(){t._clientDiv.contentEditable=!0,t._clientDiv.draggable=!1,t._ignoreBlur=!1},0)}if(!this.isListening("DragStart")||this._dragOffset===-1)return e.preventDefault&&e.preventDefault(),!1;this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",e)),this._dragOffset=-1},_handleDrag:function(e){this.isListening("Drag")&&this.onDrag(this._createMouseEvent("Drag",e))},_handleDragEnd:function(e){this._dropTarget=!1,this._dragOffset=-1,this.isListening("DragEnd")&&this.onDragEnd(this._createMouseEvent("DragEnd",e)),i.isFirefox&&(this._fixCaret(),e.dataTransfer.dropEffect==="none"&&!e.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(e){var t=!0;this._dropTarget=!0,this.isListening("DragEnter")&&(t=!1,this.onDragEnter(this._createMouseEvent("DragEnter",e)));if(i.isWebkit||t)return e.preventDefault&&e.preventDefault(),!1},_handleDragOver:function(e){var t=!0;this.isListening("DragOver")&&(t=!1,this.onDragOver(this._createMouseEvent("DragOver",e)));if(i.isWebkit||t)return t&&(e.dataTransfer.dropEffect="none"),e.preventDefault&&e.preventDefault(),!1},_handleDragLeave:function(e){this._dropTarget=!1,this.isListening("DragLeave")&&this.onDragLeave(this._createMouseEvent("DragLeave",e))},_handleDrop:function(e){return this._dropTarget=!1,this.isListening("Drop")&&this.onDrop(this._createMouseEvent("Drop",e)),e.preventDefault&&e.preventDefault(),!1},_handleFocus:function(e){this._hasFocus=!0,i.isIOS&&this._lastTouchOffset!==undefined?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=undefined):this._updateDOMSelection();if(this._selDiv1){var t=this._highlightRGB;this._selDiv1.style.background=t,this._selDiv2.style.background=t,this._selDiv3.style.background=t}this._ignoreFocus||this.onFocus({type:"Focus"})},_handleKeyDown:function(e){if(this.isListening("KeyDown")){var t=this._createKeyEvent("KeyDown",e);this.onKeyDown(t);if(t.defaultPrevented){i.isFirefox&&(this._keyDownPrevented=!0),e.preventDefault();return}}var n=!1;switch(e.keyCode){case 16:case 17:case 18:case 91:n=!0;break;default:this._setLinksVisible(!1)}if(e.keyCode===229){if(this._readonly)return e.preventDefault&&e.preventDefault(),!1;var r=!0;i.isSafari&&i.isMac&&e.ctrlKey&&(r=!1),r&&this._startIME()}else n||this._commitIME();if((i.isMac||i.isLinux)&&i.isFirefox<4||i.isOpera)return this._keyDownEvent=e,!0;if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1},_handleKeyPress:function(e){if(this._keyDownPrevented){e.preventDefault&&(e.preventDefault(),e.stopPropagation()),this._keyDownPrevented=undefined;return}if(i.isMac&&i.isWebkit)if(63232<=e.keyCode&&e.keyCode<=63487||e.keyCode===13||e.keyCode===8)return e.preventDefault&&e.preventDefault(),!1;if((i.isMac||i.isLinux)&&i.isFirefox<4||i.isOpera)if(this._doAction(this._keyDownEvent))return e.preventDefault&&e.preventDefault(),!1;var t=i.isMac?e.metaKey:e.ctrlKey;if(e.charCode!==undefined&&t)switch(e.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")){var n=this._createKeyEvent("KeyPress",e);this.onKeyPress(n);if(n.defaultPrevented){e.preventDefault();return}}var r=!1;if(i.isMac){if(e.ctrlKey||e.metaKey)r=!0}else if(i.isFirefox){if(e.ctrlKey||e.altKey)r=!0}else e.ctrlKey^e.altKey&&(r=!0);if(!r){var s=i.isOpera?e.which:e.charCode!==undefined?e.charCode:e.keyCode;if(s>31)return this._doContent(String.fromCharCode(s)),e.preventDefault&&e.preventDefault(),!1}},_handleKeyUp:function(e){if(this.isListening("KeyUp")){var t=this._createKeyEvent("KeyUp",e);this.onKeyUp(t);if(t.defaultPrevented){e.preventDefault();return}}var n=i.isMac?e.metaKey:e.ctrlKey;n||this._setLinksVisible(!1),e.keyCode===13&&this._commitIME()},_handleLinkClick:function(e){var t=i.isMac?e.metaKey:e.ctrlKey;if(!t)return e.preventDefault&&e.preventDefault(),!1},_handleMouse:function(e){var t=this._getWindow(),n=!0,r=t;if(i.isIE||i.isFirefox&&!this._overlayDiv)r=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var s=this;t.setTimeout(function(){s.focus(),s._ignoreFocus=!1},0)}return this._clickCount===1?(n=this._setSelectionTo(e.clientX,e.clientY,e.shiftKey,!i.isOpera&&this._hasFocus&&this.isListening("DragStart")),n&&this._setGrab(r)):(this._isW3CEvents&&this._setGrab(r),this._doubleClickSelection=null,this._setSelectionTo(e.clientX,e.clientY,e.shiftKey),this._doubleClickSelection=this._getSelection()),n},_handleMouseDown:function(e){if(this._linksVisible){var t=e.target||e.srcElement;if(t.tagName==="A")return;this._setLinksVisible(!1)}this._commitIME();var n=e.which;n||(e.button===4&&(n=2),e.button===2&&(n=3),e.button===1&&(n=1));var r=n!==2&&e.timeStamp?e.timeStamp:(new Date).getTime(),s=r-this._lastMouseTime,o=Math.abs(this._lastMouseX-e.clientX),u=Math.abs(this._lastMouseY-e.clientY),a=this._lastMouseButton===n;this._lastMouseX=e.clientX,this._lastMouseY=e.clientY,this._lastMouseTime=r,this._lastMouseButton=n,n===1&&(this._isMouseDown=!0,a&&s<=this._clickTime&&o<=this._clickDist&&u<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")){var f=this._createMouseEvent("MouseDown",e);this.onMouseDown(f);if(f.defaultPrevented){e.preventDefault();return}}n===1&&this._handleMouse(e)&&(i.isIE>=9||i.isOpera||i.isChrome||i.isSafari||i.isFirefox&&!this._overlayDiv)&&(this._hasFocus||this.focus(),e.preventDefault()),i.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(e){if(this._animation)return;this.isListening("MouseOver")&&this.onMouseOver(this._createMouseEvent("MouseOver",e))},_handleMouseOut:function(e){if(this._animation)return;this.isListening("MouseOut")&&this.onMouseOut(this._createMouseEvent("MouseOut",e))},_handleMouseMove:function(e){if(this._animation)return;var t=this._isClientDiv(e);this.isListening("MouseMove")&&t&&this.onMouseMove(this._createMouseEvent("MouseMove",e));if(this._dropTarget)return;var n=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;this._lastMouseMoveX=e.clientX,this._lastMouseMoveY=e.clientY,this._setLinksVisible(n&&!this._isMouseDown&&(i.isMac?e.metaKey:e.ctrlKey));if(!this._isW3CEvents){if(e.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&e.button===1&&(this._clickCount&1)!==0&&t)return this._clickCount=2,this._handleMouse(e,this._clickCount)}if(!this._isMouseDown||this._dragOffset!==-1)return;var r=e.clientX,s=e.clientY,o=this._getViewPadding(),u=this._viewDiv.getBoundingClientRect(),a=this._getClientWidth(),f=this._getClientHeight(),l=u.left+o.left,c=u.top+o.top,h=u.left+o.left+a,p=u.top+o.top+f,d=this._model,v=d.getLineAtOffset(this._getSelection().getCaret());s<c&&v!==0?this._doAutoScroll("up",r,s-c):s>p&&v!==d.getLineCount()-1?this._doAutoScroll("down",r,s-p):r<l&&!this._wrapMode?this._doAutoScroll("left",r-l,s):r>h&&!this._wrapMode?this._doAutoScroll("right",r-h,s):(this._endAutoScroll(),this._setSelectionTo(r,s,!0))},_isClientDiv:function(e){var t=this._overlayDiv||this._clientDiv,n=e.target?e.target:e.srcElement;while(n){if(t===n)return!0;n=n.parentNode}return!1},_createKeyEvent:function(e,t){return{type:e,event:t,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(e,t){var n=this.convert({x:t.clientX,y:t.clientY},"page","document");return{type:e,event:t,clickCount:this._clickCount,x:n.x,y:n.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(e){var t=e.which?e.button===0:e.button===1;this.isListening("MouseUp")&&(this._isClientDiv(e)||t&&this._isMouseDown)&&this.onMouseUp(this._createMouseEvent("MouseUp",e));if(this._linksVisible)return;if(t&&this._isMouseDown){if(this._dragOffset!==-1){var n=this._getSelection();n.extend(this._dragOffset),n.collapse(),this._setSelection(n,!0,!0),this._dragOffset=-1}this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null),i.isFirefox&&e.preventDefault()}},_handleMouseWheel:function(e){var t=this._getLineHeight(),n=0,r=0;if(i.isIE||i.isOpera)r=-e.wheelDelta/40*t;else if(i.isFirefox){var s;if(i.isMac)s=e.detail*3;else{var o=256;s=Math.max(-o,Math.min(o,e.detail))*t}e.axis===e.HORIZONTAL_AXIS?n=s:r=s}else if(i.isMac){var u=40,a=40;e.wheelDeltaX%120!==0&&(u=1),e.wheelDeltaY%120!==0&&(a=1),n=-e.wheelDeltaX/u,-1<n&&n<0&&(n=-1),0<n&&n<1&&(n=1),r=-e.wheelDeltaY/a,-1<r&&r<0&&(r=-1),0<r&&r<1&&(r=1)}else{n=-e.wheelDeltaX;var f=8;r=-e.wheelDeltaY/120*f*t}if(i.isSafari){var l=e.target;while(l&&l.lineIndex===undefined)l=l.parentNode;this._mouseWheelLine=l}var c=this._getScroll();this._scrollView(n,r);var h=this._getScroll();if(c.x!==h.x||c.y!==h.y)return e.preventDefault&&e.preventDefault(),!1},_handlePaste:function(e){if(this._ignorePaste)return;if(this._doPaste(e)){if(i.isIE){var t=this;this._ignoreFocus=!0;var n=this._getWindow();n.setTimeout(function(){t._updateDOMSelection(),t._ignoreFocus=!1},0)}return e.preventDefault&&e.preventDefault(),!1}},_handleResize:function(e){var t=this._parent.clientWidth,n=this._parent.clientHeight;if(this._parentWidth!==t||this._parentHeight!==n)this._parentWidth!==t&&this._resetLineHeight(),this._parentWidth=t,this._parentHeight=n,i.isIE<9?this._queueUpdate():this._update()},_handleRulerEvent:function(e){var t=e.target?e.target:e.srcElement,n=t.lineIndex,r=t;while(r&&!r._ruler)n===undefined&&r.lineIndex!==undefined&&(n=r.lineIndex),r=r.parentNode;var i=r?r._ruler:null;if(n===undefined&&i&&i.getOverview()==="document"){var s=this._getClientHeight(),o=this._model.getLineCount(),u=this._getViewPadding(),a=this._viewDiv.getBoundingClientRect(),f=s+u.top+u.bottom-2*this._metrics.scrollWidth;n=Math.floor((e.clientY-a.top-this._metrics.scrollWidth)*o/f),0<=n&&n<o||(n=undefined)}if(i)switch(e.type){case"click":i.onClick&&i.onClick(n,e);break;case"dblclick":i.onDblClick&&i.onDblClick(n,e);break;case"mousemove":i.onMouseMove&&i.onMouseMove(n,e);break;case"mouseover":i.onMouseOver&&i.onMouseOver(n,e);break;case"mouseout":i.onMouseOut&&i.onMouseOut(n,e)}},_handleScroll:function(){var e=this._getScroll(!1),t=this._hScroll,n=this._vScroll;if(t!==e.x||n!==e.y){this._hScroll=e.x,this._vScroll=e.y,this._commitIME(),this._update(n===e.y);var r={type:"Scroll",oldValue:{x:t,y:n},newValue:e};this.onScroll(r)}},_handleSelectStart:function(e){if(this._ignoreSelect)return e&&e.preventDefault&&e.preventDefault(),!1},_getModelOffset:function(e,t){if(!e)return;var n;e.tagName==="DIV"?n=e:n=e.parentNode.parentNode;var r=0,i=n.lineIndex;if(e.tagName!=="DIV"){var s=n.firstChild;while(s){var o=s.firstChild;if(o===e){s.ignoreChars&&(r-=s.ignoreChars),r+=t;break}s.ignoreChars&&(r-=s.ignoreChars),r+=o.data.length,s=s.nextSibling}}return Math.max(0,r)+this._model.getLineStart(i)},_updateSelectionFromDOM:function(){var e=this._getWindow(),t=e.getSelection(),n=this._getModelOffset(t.anchorNode,t.anchorOffset),r=this._getModelOffset(t.focusNode,t.focusOffset);if(n===undefined||r===undefined)return;this._setSelection(new m(n,r),!1,!1)},_handleSelectionChange:function(e){if(this._imeOffset!==-1)return;if(i.isAndroid){var t=this._getWindow();this._selTimer&&t.clearTimeout(this._selTimer);var n=this;this._selTimer=t.setTimeout(function(){if(!n._clientDiv)return;n._selTimer=null,n._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(e){this._imeOffset=-1;if(i.isAndroid){var t=this._getWindow().getSelection(),n=t.anchorNode;while(n){if(n.lineIndex!==undefined)break;n=n.parentNode}if(n){var r=this._model,s=n.lineIndex,o=r.getLine(s),u=o,a=0,f=r.getLineStart(s);if(t.rangeCount>0){t.getRangeAt(0).deleteContents();var l=n.ownerDocument.createTextNode(e.data);t.getRangeAt(0).insertNode(l);var c=this._getDOMText(n,l);u=c.text,a=c.offset,l.parentNode.removeChild(l)}n.lineRemoved=!0;var h=0;while(o.charCodeAt(h)===u.charCodeAt(h)&&h<a)h++;var p=o.length-1,d=u.length-o.length;while(o.charCodeAt(p)===u.charCodeAt(p+d)&&p+d>=a+e.data.length)p--;p++;var v=u.substring(h,p+d);h+=f,p+=f,this._modifyContent({text:v,start:h,end:p,_ignoreDOMSelection:!0},!0)}}else this._doContent(e.data);e.preventDefault()},_handleTouchStart:function(e){this._commitIME();var t=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",t.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var n=e.touches;if(n.length===1){var r=n[0],s=r.clientX,o=r.clientY;this._touchStartX=s,this._touchStartY=o,i.isAndroid&&(o<r.pageY-t.pageYOffset||s<r.pageX-t.pageXOffset)&&(s=r.pageX-t.pageXOffset,o=r.pageY-t.pageYOffset);var u=this.convert({x:s,y:o},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(u.x,u.y),this._touchStartTime=e.timeStamp,this._touching=!0}},_handleTouchMove:function(e){var t=e.touches;if(t.length===1){var n=t[0];this._touchCurrentX=n.clientX,this._touchCurrentY=n.clientY;var r=10;if(!this._touchScrollTimer&&e.timeStamp-this._touchStartTime<r*20){this._vScrollDiv.style.display="block",this._wrapMode||(this._hScrollDiv.style.display="block");var i=this,s=this._getWindow();this._touchScrollTimer=s.setInterval(function(){var e=0,t=0;if(i._touching)e=i._touchStartX-i._touchCurrentX,t=i._touchStartY-i._touchCurrentY,i._touchSpeedX=e/r,i._touchSpeedY=t/r,i._touchStartX=i._touchCurrentX,i._touchStartY=i._touchCurrentY;else{if(Math.abs(i._touchSpeedX)<.1&&Math.abs(i._touchSpeedY)<.1){i._vScrollDiv.style.display="none",i._hScrollDiv.style.display="none",s.clearInterval(i._touchScrollTimer),i._touchScrollTimer=null;return}e=i._touchSpeedX*r,t=i._touchSpeedY*r,i._touchSpeedX*=.95,i._touchSpeedY*=.95}i._scrollView(e,t)},r)}this._touchScrollTimer&&e.preventDefault()}},_handleTouchEnd:function(e){var t=e.touches;t.length===0&&(this._touching=!1)},_doAction:function(e){var t=this._keyBindings;for(var n=0;n<t.length;n++){var r=t[n];if(r.keyBinding.match(e)){if(r.actionID){var i=this._actions,s=i[r.actionID];if(s)if(s.handler){if(!s.handler())return s.defaultHandler?typeof s.defaultHandler()=="boolean":!1}else if(s.defaultHandler)return typeof s.defaultHandler()=="boolean"}return!0}}return!1},_doBackspace:function(e){var t=this._getSelection();if(t.isEmpty()){var n=this._model,r=t.getCaret(),i=n.getLineAtOffset(r),s=n.getLineStart(i);if(r===s)i>0&&t.extend(n.getLineEnd(i-1));else{var o=!1;if(this._expandTab&&e.unit==="character"&&(r-s)%this._tabSize===0){var u=n.getText(s,r);o=!/[^ ]/.test(u)}if(o)t.extend(r-this._tabSize);else{var a=this._getLine(i);t.extend(a.getNextOffset(r,e.unit,-1)),a.destroy()}}}return this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doContent:function(e){var t=this._getSelection();this._modifyContent({text:e,start:t.start,end:t.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._setClipboardText(n,e)}return!0},_doCursorNext:function(e){if(!e.select&&this._clearSelection("next"))return!0;var t=this._model,n=this._getSelection(),r=n.getCaret(),i=t.getLineAtOffset(r);if(r===t.getLineEnd(i))i+1<t.getLineCount()&&n.extend(t.getLineStart(i+1));else{var s=this._getLine(i);n.extend(s.getNextOffset(r,e.unit,1)),s.destroy()}return e.select||n.collapse(),this._setSelection(n,!0),!0},_doCursorPrevious:function(e){if(!e.select&&this._clearSelection("previous"))return!0;var t=this._model,n=this._getSelection(),r=n.getCaret(),i=t.getLineAtOffset(r);if(r===t.getLineStart(i))i>0&&n.extend(t.getLineEnd(i-1));else{var s=this._getLine(i);n.extend(s.getNextOffset(r,e.unit,-1)),s.destroy()}return e.select||n.collapse(),this._setSelection(n,!0),!0},_doCut:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._doContent(""),this._setClipboardText(n,e)}return!0},_doDelete:function(e){var t=this._getSelection();if(t.isEmpty()){var n=this._model,r=t.getCaret(),i=n.getLineAtOffset(r);if(r===n.getLineEnd(i))i+1<n.getLineCount()&&t.extend(n.getLineStart(i+1));else{var s=this._getLine(i);t.extend(s.getNextOffset(r,e.unit,1)),s.destroy()}}return this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doEnd:function(e){var t=this._getSelection(),n=this._model,r;if(e.ctrl)t.extend(n.getCharCount()),r=function(){};else{var i=t.getCaret(),s=n.getLineAtOffset(i);if(this._wrapMode){var o=this._getLine(s),u=o.getLineIndex(i);u===o.getLineCount()-1?i=n.getLineEnd(s):i=o.getLineStart(u+1)-1,o.destroy()}else i=n.getLineEnd(s);t.extend(i)}return e.select||t.collapse(),this._setSelection(t,!0,!0,r),!0},_doEnter:function(e){var t=this._model,n=this._getSelection();return this._doContent(t.getLineDelimiter()),e&&e.noCursor&&(n.end=n.start,this._setSelection(n,!0)),!0},_doHome:function(e){var t=this._getSelection(),n=this._model,r;if(e.ctrl)t.extend(0),r=function(){};else{var i=t.getCaret(),s=n.getLineAtOffset(i);if(this._wrapMode){var o=this._getLine(s),u=o.getLineIndex(i);i=o.getLineStart(u),o.destroy()}else i=n.getLineStart(s);t.extend(i)}return e.select||t.collapse(),this._setSelection(t,!0,!0,r),!0},_doLineDown:function(e){var t=this._model,n=this._getSelection(),r=n.getCaret(),s=t.getLineAtOffset(r),o,u=this._getLine(s),a=this._columnX,f=1,l=!1;if(a===-1||e.wholeLine||e.select&&i.isIE){var c=e.wholeLine?t.getLineEnd(s+1):r;a=u.getBoundingClientRect(c).left}return(o=u.getLineIndex(r))<u.getLineCount()-1?f=u.getClientRects(o+1).top+1:(l=s===t.getLineCount()-1,s++),l?e.select&&(n.extend(t.getCharCount()),this._setSelection(n,!0,!0)):(u.lineIndex!==s&&(u.destroy(),u=this._getLine(s)),n.extend(u.getOffset(a,f)),e.select||n.collapse(),this._setSelection(n,!0,!0)),this._columnX=a,u.destroy(),!0},_doLineUp:function(e){var t=this._model,n=this._getSelection(),r=n.getCaret(),s=t.getLineAtOffset(r),o,u=this._getLine(s),a=this._columnX,f=!1,l;if(a===-1||e.wholeLine||e.select&&i.isIE){var c=e.wholeLine?t.getLineStart(s-1):r;a=u.getBoundingClientRect(c).left}return(o=u.getLineIndex(r))>0?l=u.getClientRects(o-1).top+1:(f=s===0,f||(s--,l=this._getLineHeight(s)-1)),f?e.select&&(n.extend(0),this._setSelection(n,!0,!0)):(u.lineIndex!==s&&(u.destroy(),u=this._getLine(s)),n.extend(u.getOffset(a,l)),e.select||n.collapse(),this._setSelection(n,!0,!0)),this._columnX=a,u.destroy(),!0},_doPageDown:function(e){var t=this,n=this._model,r=this._getSelection(),s=r.getCaret(),o=n.getLineAtOffset(s),u=n.getLineCount(),a=this._getScroll(),f=this._getClientHeight(),l,c;if(this._lineHeight){l=this._columnX;var h=this._getBoundsAtOffset(s);if(l===-1||e.select&&i.isIE)l=h.left;var p=this._getLineIndex(h.top+f);c=this._getLine(p);var d=this._getLinePixel(p),v=h.top+f-d;s=c.getOffset(l,v);var m=c.getBoundingClientRect(s);return c.destroy(),r.extend(s),e.select||r.collapse(),this._setSelection(r,!0,!0,function(){t._columnX=l},m.top+d-h.top),!0}if(o<u-1){var g=this._getLineHeight(),y=Math.floor(f/g),b=Math.min(u-o-1,y);b=Math.max(1,b),l=this._columnX;if(l===-1||e.select&&i.isIE)c=this._getLine(o),l=c.getBoundingClientRect(s).left,c.destroy();c=this._getLine(o+b),r.extend(c.getOffset(l,0)),c.destroy(),e.select||r.collapse();var w=u*g,E=a.y+b*g;E+f>w&&(E=w-f),this._setSelection(r,!0,!0,function(){t._columnX=l},E-a.y)}return!0},_doPageUp:function(e){var t=this,n=this._model,r=this._getSelection(),s=r.getCaret(),o=n.getLineAtOffset(s),u=this._getScroll(),a=this._getClientHeight(),f,l;if(this._lineHeight){f=this._columnX;var c=this._getBoundsAtOffset(s);if(f===-1||e.select&&i.isIE)f=c.left;var h=this._getLineIndex(c.bottom-a);l=this._getLine(h);var p=this._getLinePixel(h),d=c.bottom-a-p;s=l.getOffset(f,d);var v=l.getBoundingClientRect(s);return l.destroy(),r.extend(s),e.select||r.collapse(),this._setSelection(r,!0,!0,function(){t._columnX=f},v.top+p-c.top),!0}if(o>0){var m=this._getLineHeight(),g=Math.floor(a/m),y=Math.max(1,Math.min(o,g));f=this._columnX;if(f===-1||e.select&&i.isIE)l=this._getLine(o),f=l.getBoundingClientRect(s).left,l.destroy();l=this._getLine(o-y),r.extend(l.getOffset(f,this._getLineHeight(o-y)-1)),l.destroy(),e.select||r.collapse();var b=Math.max(0,u.y-y*m);this._setSelection(r,!0,!0,function(){t._columnX=f},b-u.y)}return!0},_doPaste:function(e){var t=this,n=this._getClipboardText(e,function(e){if(e){if(i.isLinux&&t._lastMouseButton===2){var n=(new Date).getTime()-t._lastMouseTime;n<=t._clickTime&&t._setSelectionTo(t._lastMouseX,t._lastMouseY)}t._doContent(e)}});return n!==null},_doScroll:function(e){var t=e.type,n=this._model,r=n.getLineCount(),i=this._getClientHeight(),s=this._getLineHeight(),o=r*s,u=this._getScroll().y,a;switch(t){case"textStart":a=0;break;case"textEnd":a=o-i;break;case"pageDown":a=u+i;break;case"pageUp":a=u-i;break;case"lineDown":a=u+s;break;case"lineUp":a=u-s;break;case"centerLine":var f=this._getSelection(),l=n.getLineAtOffset(f.start),c=n.getLineAtOffset(f.end),h=(c-l+1)*s;a=l*s-i/2+h/2}return a!==undefined&&(a=Math.min(Math.max(0,a),o-i),this._scrollViewAnimated(0,a-u,function(){})),!0},_doSelectAll:function(e){var t=this._model,n=this._getSelection();return n.setCaret(0),n.extend(t.getCharCount()),this._setSelection(n,!1),!0},_doTab:function(e){if(!this._tabMode||this._readonly)return;var t="	";if(this._expandTab){var n=this._model,r=this._getSelection().getCaret(),i=n.getLineAtOffset(r),s=n.getLineStart(i),o=this._tabSize-(r-s)%this._tabSize;t=(new Array(o+1)).join(" ")}return this._doContent(t),!0},_doShiftTab:function(e){if(!this._tabMode||this._readonly)return;return!0},_doTabMode:function(e){return this._tabMode=!this._tabMode,!0},_doWrapMode:function(e){return this.setOptions({wrapMode:!this.getOptions("wrapMode")}),!0},_autoScroll:function(){var e=this._getSelection(),t=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),n=e.getCaret(),r=this._model.getLineAtOffset(n),i,s;if(this._autoScrollDir==="up"||this._autoScrollDir==="down"){var o=this._autoScrollY/this._getLineHeight();o=o<0?Math.floor(o):Math.ceil(o),i=r,i=Math.max(0,Math.min(this._model.getLineCount()-1,i+o))}else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")i=this._getLineIndex(t.y),s=this._getLine(r),t.x+=s.getBoundingClientRect(n,!1).left,s.destroy();s=this._getLine(i),e.extend(s.getOffset(t.x,t.y-this._getLinePixel(i))),s.destroy(),this._setSelection(e,!0)},_autoScrollTimer:function(){this._autoScroll();var e=this,t=this._getWindow();this._autoScrollTimerID=t.setTimeout(function(){e._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(e){if(!this._lineHeight)return;if(this._calculateLHTimer)return;var t=this._model.getLineCount(),n=0;if(e){var r=0,i=100,s=(new Date).getTime(),o=0;while(n<t){this._lineHeight[n]||(r++,o||(o=n),this._lineHeight[n]=this._calculateLineHeight(n)),n++;if((new Date).getTime()-s>i)break}this.redrawRulers(0,t),this._queueUpdate()}var u=this._getWindow();if(n!==t){var a=this;this._calculateLHTimer=u.setTimeout(function(){a._calculateLHTimer=null,a._calculateLineHeightTimer(!0)},0);return}this._calculateLHTimer&&(u.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=undefined)},_calculateLineHeight:function(e){var t=this._getLine(e),n=t.getBoundingClientRect();return t.destroy(),Math.max(1,Math.ceil(n.bottom-n.top))},_calculateMetrics:function(){var e=this._clientDiv,t=e.ownerDocument,n=" ",r=i.createElement(t,"div");r.style.lineHeight="normal";var s=this._model,o=s.getLine(0),u={type:"LineStyle",textView:this,0:0,lineText:o,lineStart:0};this.onLineStyle(u),a(u.style,r),r.style.position="fixed",r.style.left="-1000px";var f=i.createElement(t,"span");f.appendChild(t.createTextNode(n)),r.appendChild(f);var l=i.createElement(t,"span");l.style.fontStyle="italic",l.appendChild(t.createTextNode(n)),r.appendChild(l);var c=i.createElement(t,"span");c.style.fontWeight="bold",c.appendChild(t.createTextNode(n)),r.appendChild(c);var h=i.createElement(t,"span");h.style.fontWeight="bold",h.style.fontStyle="italic",h.appendChild(t.createTextNode(n)),r.appendChild(h),e.appendChild(r);var v=r.getBoundingClientRect(),m=f.getBoundingClientRect(),g=l.getBoundingClientRect(),y=c.getBoundingClientRect(),b=h.getBoundingClientRect(),w=m.bottom-m.top,E=g.bottom-g.top,S=y.bottom-y.top,x=b.bottom-b.top,T=0,N=v.bottom-v.top<=0,C=Math.max(1,v.bottom-v.top);E>w&&(T=1),S>E&&(T=2),x>S&&(T=3);var k;T!==0&&(k={style:{}},(T&1)!==0&&(k.style.fontStyle="italic"),(T&2)!==0&&(k.style.fontWeight="bold"));var L=d(r);e.removeChild(r);var A=p(this._viewDiv),O=i.createElement(t,"div");O.style.position="fixed",O.style.left="-1000px",O.style.paddingLeft=A.left+"px",O.style.paddingTop=A.top+"px",O.style.paddingRight=A.right+"px",O.style.paddingBottom=A.bottom+"px",O.style.width="100px",O.style.height="100px";var M=i.createElement(t,"div");M.style.width="100%",M.style.height="100%",O.appendChild(M),e.appendChild(O);var _=O.getBoundingClientRect(),D=M.getBoundingClientRect();O.style.overflow="hidden",M.style.height="200px";var P=O.clientWidth;O.style.overflow="scroll";var H=O.clientWidth;e.removeChild(O);var B=P-H;return A={left:D.left-_.left,top:D.top-_.top,right:_.right-D.right,bottom:_.bottom-D.bottom},{lineHeight:C,largestFontStyle:k,lineTrim:L,viewPadding:A,scrollWidth:B,invalid:N}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(e){var t=this._getSelection();return t.isEmpty()?!1:(e==="next"?t.start=t.end:t.end=t.start,this._setSelection(t,!0),!0)},_commitIME:function(){if(this._imeOffset===-1)return;this._scrollDiv.focus(),this._clientDiv.focus();var e=this._model,t=e.getLineAtOffset(this._imeOffset),n=e.getLineStart(t),r=this._getDOMText(this._getLineNode(t)).text,i=e.getLine(t),s=this._imeOffset-n,o=s+r.length-i.length;if(s!==o){var u=r.substring(s,o);this._doContent(u)}this._imeOffset=-1},_createActions:function(){var e=t.KeyBinding,n=this._keyBindings=[];n.push({actionID:"lineUp",keyBinding:new e(38),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e(40),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new e(37),predefined:!0}),n.push({actionID:"charNext",keyBinding:new e(39),predefined:!0}),i.isMac?(n.push({actionID:"scrollPageUp",keyBinding:new e(33),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new e(34),predefined:!0}),n.push({actionID:"pageUp",keyBinding:new e(33,null,null,!0),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new e(34,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(37,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(39,!0),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new e(37,null,null,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new e(39,null,null,!0),predefined:!0}),n.push({actionID:"scrollTextStart",keyBinding:new e(36),predefined:!0}),n.push({actionID:"scrollTextEnd",keyBinding:new e(35),predefined:!0}),n.push({actionID:"textStart",keyBinding:new e(38,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new e(40,!0),predefined:!0}),n.push({actionID:"scrollPageUp",keyBinding:new e(38,null,null,null,!0),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new e(40,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(37,null,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(39,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(38,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(40,null,null,!0),predefined:!0})):(n.push({actionID:"pageUp",keyBinding:new e(33),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new e(34),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(36),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(35),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new e(37,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new e(39,!0),predefined:!0}),n.push({actionID:"textStart",keyBinding:new e(36,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new e(35,!0),predefined:!0})),i.isFirefox&&i.isLinux&&(n.push({actionID:"lineUp",keyBinding:new e(38,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e(40,!0),predefined:!0})),i.isWindows&&(n.push({actionID:"scrollLineUp",keyBinding:new e(38,!0),predefined:!0}),n.push({actionID:"scrollLineDown",keyBinding:new e(40,!0),predefined:!0})),n.push({actionID:"selectLineUp",keyBinding:new e(38,null,!0),predefined:!0}),n.push({actionID:"selectLineDown",keyBinding:new e(40,null,!0),predefined:!0}),n.push({actionID:"selectCharPrevious",keyBinding:new e(37,null,!0),predefined:!0}),n.push({actionID:"selectCharNext",keyBinding:new e(39,null,!0),predefined:!0}),n.push({actionID:"selectPageUp",keyBinding:new e(33,null,!0),predefined:!0}),n.push({actionID:"selectPageDown",keyBinding:new e(34,null,!0),predefined:!0}),i.isMac?(n.push({actionID:"selectLineStart",keyBinding:new e(37,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(39,!0,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new e(37,null,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new e(39,null,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(36,null,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(35,null,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(38,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(40,!0,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new e(37,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(39,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new e(38,null,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(40,null,!0,!0),predefined:!0})):(i.isLinux&&(n.push({actionID:"selectWholeLineUp",keyBinding:new e(38,!0,!0),predefined:!0}),n.push({actionID:"selectWholeLineDown",keyBinding:new e(40,!0,!0),predefined:!0})),n.push({actionID:"selectLineStart",keyBinding:new e(36,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(35,null,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new e(37,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new e(39,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(36,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(35,!0,!0),predefined:!0})),n.push({actionID:"undo",keyBinding:new t.KeyBinding("z",!0),predefined:!0}),i.isMac?n.push({actionID:"redo",keyBinding:new t.KeyBinding("z",!0,!0),predefined:!0}):n.push({actionID:"redo",keyBinding:new t.KeyBinding("y",!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e(8),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e(8,null,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new e(46),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new e(46,!0),predefined:!0}),n.push({actionID:"tab",keyBinding:new e(9),predefined:!0}),n.push({actionID:"shiftTab",keyBinding:new e(9,null,!0),predefined:!0}),n.push({actionID:"enter",keyBinding:new e(13),predefined:!0}),n.push({actionID:"enter",keyBinding:new e(13,null,!0),predefined:!0}),n.push({actionID:"selectAll",keyBinding:new e("a",!0),predefined:!0}),n.push({actionID:"toggleTabMode",keyBinding:new e("m",!0),predefined:!0}),i.isMac&&(n.push({actionID:"deleteNext",keyBinding:new e(46,null,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,null,null,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new e(46,null,null,!0),predefined:!0}));if(!i.isFirefox){var r=i.isMac&&i.isChrome;n.push({actionID:null,keyBinding:new e("u",!r,!1,!1,r),predefined:!0}),n.push({actionID:null,keyBinding:new e("i",!r,!1,!1,r),predefined:!0}),n.push({actionID:null,keyBinding:new e("b",!r,!1,!1,r),predefined:!0})}i.isFirefox&&(n.push({actionID:"copy",keyBinding:new e(45,!0),predefined:!0}),n.push({actionID:"paste",keyBinding:new e(45,null,!0),predefined:!0}),n.push({actionID:"cut",keyBinding:new e(46,null,!0),predefined:!0})),i.isMac&&(n.push({actionID:"lineStart",keyBinding:new e("a",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e("e",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineUp",keyBinding:new e("p",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e("n",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new e("b",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charNext",keyBinding:new e("f",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e("h",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new e("d",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineEnd",keyBinding:new e("k",!1,!1,!1,!0),predefined:!0}),i.isFirefox?(n.push({actionID:"scrollPageDown",keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineStart",keyBinding:new e("u",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e("w",!1,!1,!1,!0),predefined:!0})):(n.push({actionID:"pageDown",keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"centerLine",keyBinding:new e("l",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"enterNoCursor",keyBinding:new e("o",!1,!1,!1,!0),predefined:!0})));var s=this;this._actions={lineUp:{defaultHandler:function(){return s._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return s._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return s._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return s._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return s._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return s._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return s._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return s._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return s._doScroll({type:"pageDown"})}},scrollLineUp:{defaultHandler:function(){return s._doScroll({type:"lineUp"})}},scrollLineDown:{defaultHandler:function(){return s._doScroll({type:"lineDown"})}},wordPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return s._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return s._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return s._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return s._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return s._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return s._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return s._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return s._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return s._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return s._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return s._doHome({select:!0,ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return s._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return s._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return s._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return s._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!0,unit:"word"})}},selectWordNext:{defaultHandler:function(){return s._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return s._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return s._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return s._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return s._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return s._doBackspace({unit:"word"})}},deleteWordNext:{defaultHandler:function(){return s._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return s._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return s._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return s._doTab()}},shiftTab:{defaultHandler:function(){return s._doShiftTab()}},enter:{defaultHandler:function(){return s._doEnter()}},enterNoCursor:{defaultHandler:function(){return s._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return s._doSelectAll()}},copy:{defaultHandler:function(){return s._doCopy()}},cut:{defaultHandler:function(){return s._doCut()}},paste:{defaultHandler:function(){return s._doPaste()}},toggleWrapMode:{defaultHandler:function(){return s._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return s._doTabMode()}}}},_createRuler:function(e,t){if(!this._clientDiv)return;var n=e.getLocation(),r=n==="left"?this._leftDiv:this._rightDiv;r.style.display="block";var s=i.createElement(r.ownerDocument,"div");s._ruler=e,s.rulerChanged=!0,s.style.position="relative",s.style.cssFloat="left",s.style.styleFloat="left",s.style.borderWidth="0px",s.style.margin="0px",s.style.padding="0px",s.style.outline="none";if(t===undefined||t<0||t>=r.children.length)r.appendChild(s);else{var o=r.firstChild;while(o&&--t>0)o=o.nextSibling;r.insertBefore(s,o)}},_createView:function(){if(this._clientDiv)return;var e=this._parent;while(e.hasChildNodes())e.removeChild(e.lastChild);var t=e.ownerDocument,n=i.createElement(t,"div");this._rootDiv=n,n.tabIndex=-1,n.style.position="relative",n.style.overflow="hidden",n.style.width="100%",n.style.height="100%",n.style.overflow="hidden",n.style.WebkitTextSizeAdjust="100%",n.setAttribute("role","application"),e.appendChild(n);var r=i.createElement(t,"div");r.className="textviewLeftRuler",this._leftDiv=r,r.tabIndex=-1,r.style.overflow="hidden",r.style.MozUserSelect="none",r.style.WebkitUserSelect="none",r.style.position="absolute",r.style.top="0px",r.style.bottom="0px",r.style.cursor="default",r.style.display="none",r.setAttribute("aria-hidden","true"),n.appendChild(r);var s=i.createElement(t,"div");s.className="textviewScroll",this._viewDiv=s,s.tabIndex=-1,s.style.overflow="auto",s.style.position="absolute",s.style.top="0px",s.style.bottom="0px",s.style.borderWidth="0px",s.style.margin="0px",s.style.outline="none",s.style.background="transparent",i.isMac&&i.isWebkit&&(s.style.pointerEvents="none",s.style.zIndex="2"),n.appendChild(s);var o=i.createElement(t,"div");o.className="textviewRightRuler",this._rightDiv=o,o.tabIndex=-1,o.style.display="none",o.style.overflow="hidden",o.style.MozUserSelect="none",o.style.WebkitUserSelect="none",o.style.position="absolute",o.style.top="0px",o.style.bottom="0px",o.style.cursor="default",o.style.right="0px",o.setAttribute("aria-hidden","true"),n.appendChild(o);var u=i.createElement(t,"div");this._scrollDiv=u,u.style.margin="0px",u.style.borderWidth="0px",u.style.padding="0px",s.appendChild(u);if(i.isFirefox){var a=i.createElement(t,"div");this._clipboardDiv=a,a.style.position="fixed",a.style.whiteSpace="pre",a.style.left="-1000px",n.appendChild(a)}if(!i.isIE&&!i.isIOS){var f=i.createElement(t,"div");this._clipDiv=f,f.style.position="absolute",f.style.overflow="hidden",f.style.margin="0px",f.style.borderWidth="0px",f.style.padding="0px",f.style.background="transparent",n.appendChild(f);var l=i.createElement(t,"div");this._clipScrollDiv=l,l.style.position="absolute",l.style.height="1px",l.style.top="-1000px",l.style.background="transparent",f.appendChild(l)}this._setFullSelection(this._fullSelection,!0);var c=i.createElement(t,"div");c.className="textviewContent",this._clientDiv=c,c.style.position="absolute",c.style.borderWidth="0px",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="1",c.style.WebkitUserSelect="text",c.setAttribute("spellcheck","false");if(i.isIOS||i.isAndroid)c.style.WebkitTapHighlightColor="transparent";(this._clipDiv||n).appendChild(c);if(i.isIOS||i.isAndroid){var h=i.createElement(t,"div");this._vScrollDiv=h,h.style.position="absolute",h.style.borderWidth="1px",h.style.borderColor="white",h.style.borderStyle="solid",h.style.borderRadius="4px",h.style.backgroundColor="black",h.style.opacity="0.5",h.style.margin="0px",h.style.padding="0px",h.style.outline="none",h.style.zIndex="3",h.style.width="8px",h.style.display="none",n.appendChild(h);var p=i.createElement(t,"div");this._hScrollDiv=p,p.style.position="absolute",p.style.borderWidth="1px",p.style.borderColor="white",p.style.borderStyle="solid",p.style.borderRadius="4px",p.style.backgroundColor="black",p.style.opacity="0.5",p.style.margin="0px",p.style.padding="0px",p.style.outline="none",p.style.zIndex="3",p.style.height="8px",p.style.display="none",n.appendChild(p)}if(i.isFirefox&&!c.setCapture){var d=i.createElement(t,"div");this._overlayDiv=d,d.style.position=c.style.position,d.style.borderWidth=c.style.borderWidth,d.style.margin=c.style.margin,d.style.padding=c.style.padding,d.style.cursor="text",d.style.zIndex="2",(this._clipDiv||n).appendChild(d)}c.contentEditable="true",c.setAttribute("role","textbox"),c.setAttribute("aria-multiline","true"),this._setWrapMode(this._wrapMode,!0),this._setReadOnly(this._readonly),this._setThemeClass(this._themeClass,!0),this._setTabSize(this._tabSize,!0),this._hookEvents();var v=this._rulers;for(var m=0;m<v.length;m++)this._createRuler(v[m]);this._update()},_defaultOptions:function(){return{parent:{value:undefined,update:null},model:{value:undefined,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},theme:{value:r.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:undefined,update:this._setThemeClass}}},_destroyRuler:function(e){var t=e.getLocation(),n=t==="left"?this._leftDiv:this._rightDiv;if(n){var r=n.firstChild;while(r){if(r._ruler===e){r._ruler=undefined,n.removeChild(r),n.children.length===0&&(n.style.display="none");break}r=r.nextSibling}}},_destroyView:function(){var e=this._clientDiv;if(!e)return;this._setGrab(null),this._unhookEvents();var t=this._getWindow();this._autoScrollTimerID&&(t.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null),this._updateTimer&&(t.clearTimeout(this._updateTimer),this._updateTimer=null);var n=this._rootDiv;n.parentNode.removeChild(n),this._selDiv1=null,this._selDiv2=null,this._selDiv3=null,this._clipboardDiv=null,this._rootDiv=null,this._scrollDiv=null,this._viewDiv=null,this._clipDiv=null,this._clipScrollDiv=null,this._clientDiv=null,this._overlayDiv=null,this._leftDiv=null,this._rightDiv=null,this._vScrollDiv=null,this._hScrollDiv=null},_doAutoScroll:function(e,t,n){this._autoScrollDir=e,this._autoScrollX=t,this._autoScrollY=n,this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){if(this._autoScrollTimerID){var e=this._getWindow();e.clearTimeout(this._autoScrollTimerID)}this._autoScrollDir=undefined,this._autoScrollTimerID=undefined},_fixCaret:function(){var e=this._clientDiv;if(e){var t=this._hasFocus;this._ignoreFocus=!0,t&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,t&&e.focus(),this._ignoreFocus=!1}},_getBaseText:function(e,t){var n=this._model;return n.getBaseModel&&(e=n.mapOffset(e),t=n.mapOffset(t),n=n.getBaseModel()),n.getText(e,t)},_getBottomIndex:function(e){var t=this._bottomChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),r=this._clientDiv.getBoundingClientRect();n.bottom>r.bottom&&(t=this._getLinePrevious(t)||t)}return t.lineIndex},_getBoundsAtOffset:function(e){var t=this._model,n=this._getLine(t.getLineAtOffset(e)),r=n.getBoundingClientRect(e),i=this._getLinePixel(n.lineIndex);return r.top+=i,r.bottom+=i,n.destroy(),r},_getClientHeight:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-e.top-e.bottom)},_getClientWidth:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-e.left-e.right)},_getClipboardText:function(e,t){var n=this._model.getLineDelimiter(),r,s,o=this._getWindow();if(o.clipboardData)return r=[],s=o.clipboardData.getData("Text"),c(s,function(e){r.push(e)},function(){r.push(n)}),s=r.join(""),t&&t(s),s;if(i.isFirefox){this._ignoreFocus=!0;var u=this._clipboardDiv;u.innerHTML="<pre contenteditable=''></pre>",u.firstChild.focus();var a=this,f=function(){var e=a._getTextFromElement(u);return u.innerHTML="",r=[],c(e,function(e){r.push(e)},function(){r.push(n)}),r.join("")},l=!1;this._ignorePaste=!0;if(!i.isLinux||this._lastMouseButton!==2)try{var h=u.ownerDocument;l=h.execCommand("paste",!1,null)}catch(p){l=u.childNodes.length>1||u.firstChild&&u.firstChild.childNodes.length>0}return this._ignorePaste=!1,l?(this.focus(),this._ignoreFocus=!1,s=f(),s&&t&&t(s),s):e?(o.setTimeout(function(){a.focus(),s=f(),s&&t&&t(s),a._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"")}return e&&e.clipboardData?(r=[],s=e.clipboardData.getData("text/plain"),c(s,function(e){r.push(e)},function(){r.push(n)}),s=r.join(""),s&&t&&t(s),s):""},_getDOMText:function(e,t){var n=e.firstChild,r="",i=0;while(n){var s;if(n.ignoreChars){s=n.lastChild;var o=0,u=[],a=-1;while(s){var f=s.data;for(var l=f.length-1;l>=0;l--){var c=f.substring(l,l+1);o<n.ignoreChars&&(c===" "||c==="\u200c"||c==="\ufeff")?o++:u.push(c==="\u00a0"?"	":c)}t===s&&(a=u.length),s=s.previousSibling}u=u.reverse().join(""),a!==-1&&(i=r.length+u.length-a),r+=u}else{s=n.firstChild;while(s)t===s&&(i=r.length),r+=s.data,s=s.nextSibling}n=n.nextSibling}return{text:r,offset:i}},_getTextFromElement:function(e){var t=e.ownerDocument,n=t.defaultView;if(!n.getSelection)return e.innerText||e.textContent;var r=t.createRange();r.selectNode(e);var i=n.getSelection(),s=[],o;for(o=0;o<i.rangeCount;o++)s.push(i.getRangeAt(o));this._ignoreSelect=!0,i.removeAllRanges(),i.addRange(r);var u=i.toString();i.removeAllRanges();for(o=0;o<s.length;o++)i.addRange(s[o]);return this._ignoreSelect=!1,u},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(e){var t=this._getLineNode(e);return t&&!t.lineChanged&&!t.lineRemoved?t._line:new y(this,e)},_getLineHeight:function(e,t){if(e!==undefined&&this._lineHeight){var n=this._lineHeight[e];if(n)return n;if(t||t===undefined){var r=this._lineHeight[e]=this._calculateLineHeight(e);return r}}return this._metrics.lineHeight},_getLineNode:function(e){var t=this._clientDiv,n=t.firstChild;while(n){if(e===n.lineIndex)return n;n=n.nextSibling}return undefined},_getLineNext:function(e){var t=e?e.nextSibling:this._clientDiv.firstChild;while(t&&t.lineIndex===-1)t=t.nextSibling;return t},_getLinePrevious:function(e){var t=e?e.previousSibling:this._clientDiv.lastChild;while(t&&t.lineIndex===-1)t=t.previousSibling;return t},_getLinePixel:function(e){e=Math.min(Math.max(0,e),this._model.getLineCount());if(this._lineHeight){var t=this._getTopIndex(),n=-this._topIndexY+this._getScroll().y,r;if(e>t)for(r=t;r<e;r++)n+=this._getLineHeight(r);else for(r=t-1;r>=e;r--)n-=this._getLineHeight(r);return n}var i=this._getLineHeight();return i*e},_getLineIndex:function(e){var t,n=0,r=this._model.getLineCount();if(this._lineHeight){n=this._getTopIndex();var i=-this._topIndexY+this._getScroll().y;if(e!==i)if(e<i)while(e<i&&n>0)e+=this._getLineHeight(--n);else{t=this._getLineHeight(n);while(e-t>=i&&n<r-1)e-=t,t=this._getLineHeight(++n)}}else t=this._getLineHeight(),n=Math.floor(e/t);return Math.max(0,Math.min(r-1,n))},_getScroll:function(e){(e===undefined||e)&&this._cancelAnimation();var t=this._viewDiv;return{x:t.scrollLeft,y:t.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(e){var t=this._topChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),r=this._getViewPadding(),i=this._viewDiv.getBoundingClientRect();n.top<i.top+r.top&&(t=this._getLineNext(t)||t)}return t.lineIndex},_hookEvents:function(){var e=this;this._modelListener={onChanging:function(t){e._onModelChanging(t)},onChanged:function(t){e._onModelChanged(t)}},this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._themeListener={onChanged:function(t){e._setThemeClass(e._themeClass)}},this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var t=this._handlers=[],n=this._clientDiv,r=this._viewDiv,s=this._rootDiv,u=this._overlayDiv||n,a=n.ownerDocument,f=this._getWindow(),l=i.isIE?a:f;t.push({target:f,type:"resize",handler:function(t){return e._handleResize(t?t:f.event)}}),t.push({target:n,type:"blur",handler:function(t){return e._handleBlur(t?t:f.event)}}),t.push({target:n,type:"focus",handler:function(t){return e._handleFocus(t?t:f.event)}}),t.push({target:r,type:"focus",handler:function(e){n.focus()}}),t.push({target:r,type:"scroll",handler:function(t){return e._handleScroll(t?t:f.event)}}),t.push({target:n,type:"textInput",handler:function(t){return e._handleTextInput(t?t:f.event)}}),t.push({target:n,type:"keydown",handler:function(t){return e._handleKeyDown(t?t:f.event)}}),t.push({target:n,type:"keypress",handler:function(t){return e._handleKeyPress(t?t:f.event)}}),t.push({target:n,type:"keyup",handler:function(t){return e._handleKeyUp(t?t:f.event)}}),t.push({target:n,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}}),t.push({target:n,type:"copy",handler:function(t){return e._handleCopy(t?t:f.event)}}),t.push({target:n,type:"cut",handler:function(t){return e._handleCut(t?t:f.event)}}),t.push({target:n,type:"paste",handler:function(t){return e._handlePaste(t?t:f.event)}});if(i.isIOS||i.isAndroid)t.push({target:a,type:"selectionchange",handler:function(t){return e._handleSelectionChange(t?t:f.event)}}),t.push({target:n,type:"touchstart",handler:function(t){return e._handleTouchStart(t?t:f.event)}}),t.push({target:n,type:"touchmove",handler:function(t){return e._handleTouchMove(t?t:f.event)}}),t.push({target:n,type:"touchend",handler:function(t){return e._handleTouchEnd(t?t:f.event)}});else{t.push({target:n,type:"selectstart",handler:function(t){return e._handleSelectStart(t?t:f.event)}}),t.push({target:n,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}}),t.push({target:n,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}}),t.push({target:n,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}}),t.push({target:l,type:"mouseup",handler:function(t){return e._handleMouseUp(t?t:f.event)}}),t.push({target:l,type:"mousemove",handler:function(t){return e._handleMouseMove(t?t:f.event)}}),t.push({target:s,type:"mousedown",handler:function(t){return e._handleRootMouseDown(t?t:f.event)}}),t.push({target:s,type:"mouseup",handler:function(t){return e._handleRootMouseUp(t?t:f.event)}}),t.push({target:u,type:"dragstart",handler:function(t){return e._handleDragStart(t?t:f.event)}}),t.push({target:u,type:"drag",handler:function(t){return e._handleDrag(t?t:f.event)}}),t.push({target:u,type:"dragend",handler:function(t){return e._handleDragEnd(t?t:f.event)}}),t.push({target:u,type:"dragenter",handler:function(t){return e._handleDragEnter(t?t:f.event)}}),t.push({target:u,type:"dragover",handler:function(t){return e._handleDragOver(t?t:f.event)}}),t.push({target:u,type:"dragleave",handler:function(t){return e._handleDragLeave(t?t:f.event)}}),t.push({target:u,type:"drop",handler:function(t){return e._handleDrop(t?t:f.event)}}),t.push({target:this._clientDiv,type:i.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}});if(i.isFirefox&&(!i.isWindows||i.isFirefox>=15)){var c=f.MutationObserver||f.MozMutationObserver;c?(this._mutationObserver=new c(function(t){e._handleDataModified(t)}),this._mutationObserver.observe(n,{subtree:!0,characterData:!0})):t.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(t){return e._handleDataModified(t?t:f.event)}})}this._overlayDiv&&(t.push({target:this._overlayDiv,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}})),this._isW3CEvents||t.push({target:this._clientDiv,type:"dblclick",handler:function(t){return e._handleDblclick(t?t:f.event)}})}var h=this._leftDiv,p=this._rightDiv;i.isIE&&t.push({target:h,type:"selectstart",handler:function(){return!1}}),t.push({target:h,type:i.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}}),t.push({target:h,type:"click",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"dblclick",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mousemove",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mouseover",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mouseout",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),i.isIE&&t.push({target:p,type:"selectstart",handler:function(){return!1}}),t.push({target:p,type:i.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}}),t.push({target:p,type:"click",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"dblclick",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mousemove",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mouseover",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mouseout",handler:function(t){e._handleRulerEvent(t?t:f.event)}});for(var d=0;d<t.length;d++){var v=t[d];o(v.target,v.type,v.handler,v.capture)}},_getWindow:function(){return s(this._parent.ownerDocument)},_init:function(t){var n=t.parent;typeof n=="string"&&(n=(t.document||document).getElementById(n));if(!n)throw"no parent";t.parent=n,t.model=t.model||new e.TextModel;var r=this._defaultOptions();for(var s in r)if(r.hasOwnProperty(s)){var o;t[s]!==undefined?o=t[s]:o=r[s].value,this["_"+s]=o}this._rulers=[],this._selection=new m(0,0,!1),this._linksVisible=!1,this._redrawCount=0,this._maxLineWidth=0,this._maxLineIndex=-1,this._ignoreSelect=!0,this._ignoreFocus=!1,this._hasFocus=!1,this._columnX=-1,this._dragOffset=-1,this._isRangeRects=(!i.isIE||i.isIE>=9)&&typeof n.ownerDocument.createRange().getBoundingClientRect=="function",this._isW3CEvents=n.addEventListener,this._autoScrollX=null,this._autoScrollY=null,this._autoScrollTimerID=null,this._AUTO_SCROLL_RATE=50,this._grabControl=null,this._moseMoveClosure=null,this._mouseUpClosure=null,this._lastMouseX=0,this._lastMouseY=0,this._lastMouseTime=0,this._clickCount=0,this._clickTime=250,this._clickDist=5,this._isMouseDown=!1,this._doubleClickSelection=null,this._hScroll=0,this._vScroll=0,this._imeOffset=-1,this._createActions(),this._createView()},_modifyContent:function(e,t){if(this._readonly&&!e._code)return;e.type="Verify",this.onVerify(e);if(e.text===null||e.text===undefined)return;var n=this._model;try{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),n.setText(e.text,e.start,e.end)}finally{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(t){var r=this._getSelection();r.setCaret(e.start+e.text.length),this._setSelection(r,!0)}this.onModify({type:"Modify"})},_onModelChanged:function(e){e.type="ModelChanged",this.onModelChanged(e),e.type="Changed";var t=e.start,n=e.addedCharCount,r=e.removedCharCount,i=e.addedLineCount,s=e.removedLineCount,o=this._getSelection();o.end>t&&(o.end>t&&o.start<t+r?o.setCaret(t+n):(o.start+=n-r,o.end+=n-r),this._setSelection(o,!1,!1));var u=this._model,a=u.getLineAtOffset(t),f=this._getLineNext();while(f){var l=f.lineIndex;a<=l&&l<=a+s&&(a===l&&!f.modelChangedEvent&&!f.lineRemoved?(f.modelChangedEvent=e,f.lineChanged=!0):(f.lineRemoved=!0,f.lineChanged=!1,f.modelChangedEvent=null)),l>a+s&&(f.lineIndex=l+i-s,f._line.lineIndex=f.lineIndex),f=this._getLineNext(f)}this._wrapMode||a<=this._maxLineIndex&&this._maxLineIndex<=a+s&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._update()},_onModelChanging:function(e){e.type="ModelChanging",this.onModelChanging(e),e.type="Changing"},_queueUpdate:function(){if(this._updateTimer||this._ignoreQueueUpdate)return;var e=this,t=this._getWindow();this._updateTimer=t.setTimeout(function(){e._updateTimer=null,e._update()},0)},_resetLineHeight:function(e,t){if(this._wrapMode){if(e!==undefined&&t!==undefined)for(var n=e;n<t;n++)this._lineHeight[n]=undefined;else this._lineHeight=new Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var e=this._clientDiv;if(e){var t=e.firstChild;while(t)t.lineWidth=undefined,t=t.nextSibling}},_reset:function(){this._maxLineIndex=-1,this._maxLineWidth=0,this._columnX=-1,this._topChild=null,this._bottomChild=null,this._topIndexY=0,this._resetLineHeight(),this._setSelection(new m(0,0,!1),!1,!1),this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var e=this._clientDiv;if(e){var t=e.firstChild;while(t)t.lineRemoved=!0,t=t.nextSibling;if(i.isFirefox){this._ignoreFocus=!1;var n=this._hasFocus;n&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,n&&e.focus(),this._ignoreFocus=!1}}},_scrollViewAnimated:function(e,t,n){if(n&&this._scrollAnimation){var r=this;this._animation=new v({window:this._getWindow(),duration:this._scrollAnimation,curve:[t,0],onAnimate:function(e){var n=t-Math.floor(e);r._scrollView(0,n),t-=n},onEnd:function(){r._animation=null,r._scrollView(e,t),n&&n()}}),this._animation.play()}else this._scrollView(e,t),n&&n()},_scrollView:function(e,t){this._ensureCaretVisible=!1;var n=this._viewDiv;e&&(n.scrollLeft+=e),t&&(n.scrollTop+=t)},_setClipboardText:function(e,t){var n,r=this._parent.ownerDocument,s=this._getWindow();if(s.clipboardData)return n=[],c(e,function(e){n.push(e)},function(){n.push(i.platformDelimiter)}),s.clipboardData.setData("Text",n.join(""));if(t&&t.clipboardData){n=[],c(e,function(e){n.push(e)},function(){n.push(i.platformDelimiter)});if(t.clipboardData.setData("text/plain",n.join("")))return!0}var o=i.createElement(r,"pre");o.style.position="fixed",o.style.left="-1000px",c(e,function(e){o.appendChild(r.createTextNode(e))},function(){o.appendChild(i.createElement(r,"br"))}),o.appendChild(r.createTextNode(" ")),this._clientDiv.appendChild(o);var u=r.createRange();u.setStart(o.firstChild,0),u.setEndBefore(o.lastChild);var a=s.getSelection();a.rangeCount>0&&a.removeAllRanges(),a.addRange(u);var f=this,l=function(){o&&o.parentNode===f._clientDiv&&f._clientDiv.removeChild(o),f._updateDOMSelection()},h=!1;this._ignoreCopy=!0;try{h=r.execCommand("copy",!1,null)}catch(p){}return this._ignoreCopy=!1,!h&&t?(s.setTimeout(l,0),!1):(l(),!0)},_setDOMSelection:function(e,t,n,r){var s,o,u,a,f=0,l=e.firstChild,c,h,p=this._model,d=p.getLine(e.lineIndex).length;while(l){c=l.firstChild,h=c.length,l.ignoreChars&&(h-=l.ignoreChars);if(f+h>t||f+h>=d){s=c,o=t-f,l.ignoreChars&&h>0&&o===h&&(o+=l.ignoreChars);break}f+=h,l=l.nextSibling}f=0,l=n.firstChild;var v=this._model.getLine(n.lineIndex).length;while(l){c=l.firstChild,h=c.length,l.ignoreChars&&(h-=l.ignoreChars);if(h+f>r||f+h>=v){u=c,a=r-f,l.ignoreChars&&h>0&&a===h&&(a+=l.ignoreChars);break}f+=h,l=l.nextSibling}this._setDOMFullSelection(e,t,d,n,r,v);if(!this._hasFocus)return;var m,g=this._getWindow(),y=this._parent.ownerDocument;if(g.getSelection){var b=g.getSelection();if(b.anchorNode===s&&b.anchorOffset===o&&b.focusNode===u&&b.focusOffset===a||b.anchorNode===u&&b.anchorOffset===a&&b.focusNode===s&&b.focusOffset===o)return;m=y.createRange(),m.setStart(s,o),m.setEnd(u,a),this._ignoreSelect=!1,b.rangeCount>0&&b.removeAllRanges(),b.addRange(m),this._ignoreSelect=!0}else if(y.selection){var w=y.body,E=i.createElement(y,"div");w.appendChild(E),w.removeChild(E),m=w.createTextRange(),m.moveToElementText(s.parentNode),m.moveStart("character",o);var S=w.createTextRange();S.moveToElementText(u.parentNode),S.moveStart("character",a),m.setEndPoint("EndToStart",S),this._ignoreSelect=!1,m.select(),this._ignoreSelect=!0}},_setDOMFullSelection:function(e,t,n,r,i,s){if(!this._selDiv1)return;var o=this._selDiv1;o.style.width="0px",o.style.height="0px",o=this._selDiv2,o.style.width="0px",o.style.height="0px",o=this._selDiv3,o.style.width="0px",o.style.height="0px";if(e===r&&t===i)return;var u=this._model,a=this._getViewPadding(),f=this._clientDiv.getBoundingClientRect(),l=this._viewDiv.getBoundingClientRect(),c=l.left+a.left,h=f.right,p=l.top+a.top,d=f.bottom,v=0,m=0;if(this._clipDiv){var g=this._clipDiv.getBoundingClientRect();v=g.left-this._clipDiv.scrollLeft,m=g.top}else{var b=this._rootDiv.getBoundingClientRect();v=b.left,m=b.top}this._ignoreDOMSelection=!0;var w=new y(this,e.lineIndex,e),E=w.getBoundingClientRect(u.getLineStart(e.lineIndex)+t,!1),S=E.left,x=new y(this,r.lineIndex,r),T=x.getBoundingClientRect(u.getLineStart(r.lineIndex)+i,!1),N=T.left;this._ignoreDOMSelection=!1;var C=this._selDiv1,k=Math.min(h,Math.max(c,S)),L=Math.min(d,Math.max(p,E.top)),A=h,O=Math.min(d,Math.max(p,E.bottom));C.style.left=k-v+"px",C.style.top=L-m+"px",C.style.width=Math.max(0,A-k)+"px",C.style.height=Math.max(0,O-L)+"px";if(E.top===T.top)A=Math.min(N,h),C.style.width=Math.max(0,A-k)+"px";else{var M=c,_=Math.min(d,Math.max(p,T.top)),D=Math.min(h,Math.max(c,N)),P=Math.min(d,Math.max(p,T.bottom)),H=this._selDiv3;H.style.left=M-v+"px",H.style.top=_-m+"px",H.style.width=Math.max(0,D-M)+"px",H.style.height=Math.max(0,P-_)+"px";if(_-O>0){var B=this._selDiv2;B.style.left=c-v+"px",B.style.top=O-m+"px",B.style.width=Math.max(0,h-c)+"px",B.style.height=Math.max(0,_-O)+"px"}}},_setGrab:function(e){if(e===this._grabControl)return;e?(e.setCapture&&e.setCapture(),this._grabControl=e):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(e){if(this._linksVisible===e)return;this._linksVisible=e,i.isIE&&e&&(this._hadFocus=this._hasFocus);var t=this._clientDiv;t.contentEditable=!e,this._hadFocus&&!e&&t.focus(),this._overlayDiv&&(this._overlayDiv.style.zIndex=e?"-1":"1");var n=this._getLineNext();while(n){if(n.hasLink){var r=n.firstChild;while(r){var s=r.nextSibling,o=r.viewStyle;o&&o.tagName==="A"&&n.replaceChild(n._line._createSpan(n,r.firstChild.data,o),r),r=s}}n=this._getLineNext(n)}},_setSelection:function(e,t,n,r,i){if(e){this._columnX=-1,n===undefined&&(n=!0);var s=this._selection;this._selection=e,t!==!1&&this._showCaret(!1,r,t,i),n&&this._updateDOMSelection();if(!s.equals(e)){var o={type:"Selection",oldValue:{start:s.start,end:s.end},newValue:{start:e.start,end:e.end}};this.onSelection(o)}}},_setSelectionTo:function(e,t,n,r){var i=this._model,s,o=this._getSelection(),u=this.convert({x:e,y:t},"page","document"),a=this._getLineIndex(u.y),f;if(this._clickCount===1){f=this._getLine(a),s=f.getOffset(u.x,u.y-this._getLinePixel(a)),f.destroy();if(r&&!n&&o.start<=s&&s<o.end)return this._dragOffset=s,!1;o.extend(s),n||o.collapse()}else{var l=(this._clickCount&1)===0,c,h;if(l)f=this._getLine(a),s=f.getOffset(u.x,u.y-this._getLinePixel(a)),this._doubleClickSelection?s>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,h=f.getNextOffset(s,"wordend",1)):(c=f.getNextOffset(s,"word",-1),h=this._doubleClickSelection.end):(c=f.getNextOffset(s,"word",-1),h=f.getNextOffset(c,"wordend",1)),f.destroy();else if(this._doubleClickSelection){var p=i.getLineAtOffset(this._doubleClickSelection.start);a>=p?(c=i.getLineStart(p),h=i.getLineEnd(a)):(c=i.getLineStart(a),h=i.getLineEnd(p))}else c=i.getLineStart(a),h=i.getLineEnd(a);o.setCaret(c),o.extend(h)}return this._setSelection(o,!0,!0),!0},_setFullSelection:function(e,t){this._fullSelection=e,i.isWebkit&&(this._fullSelection=!0);var n=this._clipDiv||this._rootDiv;if(!n)return;if(!this._fullSelection){this._selDiv1&&(n.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(n.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(n.removeChild(this._selDiv3),this._selDiv3=null);return}if(!this._selDiv1&&this._fullSelection&&!i.isIOS){var r=n.ownerDocument;this._highlightRGB=i.isWebkit?"transparent":"Highlight";var s=i.createElement(r,"div");this._selDiv1=s,s.style.position="absolute",s.style.borderWidth="0px",s.style.margin="0px",s.style.padding="0px",s.style.outline="none",s.style.background=this._highlightRGB,s.style.width="0px",s.style.height="0px",s.style.zIndex="0",n.appendChild(s);var o=i.createElement(r,"div");this._selDiv2=o,o.style.position="absolute",o.style.borderWidth="0px",o.style.margin="0px",o.style.padding="0px",o.style.outline="none",o.style.background=this._highlightRGB,o.style.width="0px",o.style.height="0px",o.style.zIndex="0",n.appendChild(o);var u=i.createElement(r,"div");this._selDiv3=u,u.style.position="absolute",u.style.borderWidth="0px",u.style.margin="0px",u.style.padding="0px",u.style.outline="none",u.style.background=this._highlightRGB,u.style.width="0px",u.style.height="0px",u.style.zIndex="0",n.appendChild(u);if(i.isFirefox&&i.isMac){var a=this._getWindow(),f=a.getComputedStyle(u,null),l=f.getPropertyValue("background-color");switch(l){case"rgb(119, 141, 168)":l="rgb(199, 208, 218)";break;case"rgb(127, 127, 127)":l="rgb(198, 198, 198)";break;case"rgb(255, 193, 31)":l="rgb(250, 236, 115)";break;case"rgb(243, 70, 72)":l="rgb(255, 176, 139)";break;case"rgb(255, 138, 34)":l="rgb(255, 209, 129)";break;case"rgb(102, 197, 71)":l="rgb(194, 249, 144)";break;case"rgb(140, 78, 184)":l="rgb(232, 184, 255)";break;default:l="rgb(180, 213, 255)"}this._highlightRGB=l,s.style.background=l,o.style.background=l,u.style.background=l}t||this._updateDOMSelection()}},_setReadOnly:function(e){this._readonly=e,this._clientDiv.setAttribute("aria-readonly",e?"true":"false")},_setTabSize:function(e,t){this._tabSize=e,this._customTabSize=undefined;var n=this._clientDiv;i.isOpera?n&&(n.style.OTabSize=this._tabSize+""):i.isWebkit>=537.1?n&&(n.style.tabSize=this._tabSize+""):i.isFirefox>=4?n&&(n.style.MozTabSize=this._tabSize+""):this._tabSize!==8&&(this._customTabSize=this._tabSize),t||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(e){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._theme=e,this._theme&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged),this._setThemeClass(this._themeClass)},_setThemeClass:function(e,t){this._themeClass=e;var n="textview",r=this._theme.getThemeClass();r&&(n+=" "+r),this._themeClass&&r!==this._themeClass&&(n+=" "+this._themeClass),this._rootDiv.className=n,this._updateStyle(t)},_setWrapMode:function(e,t){this._wrapMode=e;var n=this._clientDiv,r=this._viewDiv;e?(n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",r.style.overflowX="hidden",r.style.overflowY="scroll"):(n.style.whiteSpace="pre",n.style.wordWrap="normal",r.style.overflowX="auto",r.style.overflowY="auto"),t||(this.redraw(),this._resetLineWidth()),this._resetLineHeight()},_showCaret:function(e,t,n,r){if(!this._clientDiv)return;var i=this._model,s=this._getSelection(),o=this._getScroll(),u=s.getCaret(),a=s.start,f=s.end,l=i.getLineAtOffset(f),c=Math.max(Math.max(a,i.getLineStart(l)),f-1),h=this._getClientWidth(),p=this._getClientHeight(),d=h/4,v=this._getBoundsAtOffset(u===a?a:c),m=v.left,g=v.right,y=v.top,b=v.bottom;e&&!s.isEmpty()&&(v=this._getBoundsAtOffset(u===f?a:c),v.top===y?u===a?g=m+Math.min(v.right-m,h):m=g-Math.min(g-v.left,h):u===a?b=y+Math.min(v.bottom-y,p):y=b-Math.min(b-v.top,p));var w=0;m<o.x&&(w=Math.min(m-o.x,-d)),g>o.x+h&&(w=Math.max(g-o.x-h,d));var E=0;return y<o.y?E=y-o.y:b>o.y+p&&(E=b-o.y-p),r&&(r>0?E>0&&(E=Math.max(E,r)):E<0&&(E=Math.min(E,r))),w!==0||E!==0?(E!==0&&typeof n=="number"&&(n<0&&(n=0),n>1&&(n=1),E+=Math.floor(E>0?n*p:-n*p)),this._scrollViewAnimated(w,E,t),p!==this._getClientHeight()||h!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1},_startIME:function(){if(this._imeOffset!==-1)return;var e=this._getSelection();e.isEmpty()||this._modifyContent({text:"",start:e.start,end:e.end},!0),this._imeOffset=e.start},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged),this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._modelListener=null;for(var e=0;e<this._handlers.length;e++){var t=this._handlers[e];u(t.target,t.type,t.handler)}this._handlers=null,this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(this._ignoreDOMSelection)return;if(!this._clientDiv)return;var e=this._getSelection(),t=this._model,n=t.getLineAtOffset(e.start),r=t.getLineAtOffset(e.end),i=this._getLineNext();if(!i)return;var s=this._getLinePrevious(),o,u,a,f;n<i.lineIndex?(o=i,a=0):n>s.lineIndex?(o=s,a=0):(o=this._getLineNode(n),a=e.start-t.getLineStart(n)),r<i.lineIndex?(u=i,f=0):r>s.lineIndex?(u=s,f=0):(u=this._getLineNode(r),f=e.end-t.getLineStart(r)),this._setDOMSelection(o,a,u,f)},_update:function(e){if(this._redrawCount>0)return;if(this._updateTimer){var t=this._getWindow();t.clearTimeout(this._updateTimer),this._updateTimer=null,e=!1}var n=this._clientDiv;if(!n)return;this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var r=this._model,s=this._getScroll(!1),o=this._getViewPadding(),u=r.getLineCount(),a=this._getLineHeight(),f=this._getClientWidth();this._wrapMode&&(n.style.width=f+"px");var l,c,h,p,d,v,m,g,b,w=0,E=0,S;if(this._lineHeight){while(E<u){S=this._getLineHeight(E);if(w+S>s.y)break;w+=S,E++}l=E,c=Math.max(0,l-1),p=h=s.y-w,l>0&&(h+=this._getLineHeight(l-1))}else{var x=Math.max(0,s.y)/a;l=Math.floor(x),c=Math.max(0,l-1),h=Math.round((x-c)*a),p=Math.round((x-l)*a),b=u*a}this._topIndexY=p;var T=this._parent,N=T.clientWidth,C=T.clientHeight;m=this._getClientHeight();if(e){d=0,this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),d=v.right-v.left),g=f,this._wrapMode||(g=Math.max(this._maxLineWidth,g));while(E<u)S=this._getLineHeight(E,!1),w+=S,E++;b=w}else{var k=this._viewDiv,L=Math.floor((m+p)/a),A=Math.min(l+L,u-1),O=Math.min(A+1,u-1),M,_,D=n.firstChild;while(D){M=D.lineIndex;var P=D.nextSibling;if(!(c<=M&&M<=O)||D.lineRemoved||D.lineIndex===-1)this._mouseWheelLine===D?(D.style.display="none",D.lineIndex=-1):n.removeChild(D);D=P}D=this._getLineNext();var H=k.ownerDocument,B=H.createDocumentFragment();for(M=c;M<=O;M++)!D||D.lineIndex>M?(new y(this,M)).create(B,null):(B.firstChild&&(n.insertBefore(B,D),B=H.createDocumentFragment()),D&&D.lineChanged&&(D=(new y(this,M)).create(B,D),D.lineChanged=!1),D=this._getLineNext(D));B.firstChild&&n.insertBefore(B,D),i.isWebkit&&!this._wrapMode&&(n.style.width="0x7fffffffpx");var j;D=this._getLineNext();var F=m+h,I=!1;while(D)_=D.lineWidth,_===undefined&&(j=D._line.getBoundingClientRect(),_=D.lineWidth=Math.ceil(j.right-j.left),this._lineHeight&&(this._lineHeight[D.lineIndex]=Math.ceil(j.bottom-j.top))),this._lineHeight&&!I&&(F-=this._lineHeight[D.lineIndex],F<0&&(A=D.lineIndex,I=!0)),this._wrapMode||(_>=this._maxLineWidth&&(this._maxLineWidth=_,this._maxLineIndex=D.lineIndex),this._checkMaxLineIndex===D.lineIndex&&(this._checkMaxLineIndex=-1)),D.lineIndex===l&&(this._topChild=D),D.lineIndex===A&&(this._bottomChild=D),D=this._getLineNext(D);if(this._checkMaxLineIndex!==-1){M=this._checkMaxLineIndex,this._checkMaxLineIndex=-1;if(0<=M&&M<u){var q=new y(this,M);j=q.getBoundingClientRect(),_=j.right-j.left,_>=this._maxLineWidth&&(this._maxLineWidth=_,this._maxLineIndex=M),q.destroy()}}while(E<u)S=this._getLineHeight(E,E<=A),w+=S,E++;b=w,this._updateRuler(this._leftDiv,l,O,C),this._updateRuler(this._rightDiv,l,O,C),d=0,this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),d=v.right-v.left);var R=0;if(this._rightDiv){var U=this._rightDiv.getBoundingClientRect();R=U.right-U.left}k.style.left=d+"px",k.style.right=R+"px";var z=this._scrollDiv;z.style.height=b+"px",f=this._getClientWidth();var W=f;this._wrapMode||(W=Math.max(this._maxLineWidth,W)),g=W,(!i.isIE||i.isIE>=9)&&this._maxLineWidth>f&&(W+=o.right+o.left),z.style.width=W+"px",this._clipScrollDiv&&(this._clipScrollDiv.style.width=W+"px"),s=this._getScroll(!1)}if(this._vScrollDiv){var X=m-8,V=Math.max(15,Math.ceil(Math.min(1,X/(b+o.top+o.bottom))*X));this._vScrollDiv.style.left=d+f-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,s.y*X/b))+"px",this._vScrollDiv.style.height=V+"px"}if(!this._wrapMode&&this._hScrollDiv){var $=f-8,J=Math.max(15,Math.ceil(Math.min(1,$/(this._maxLineWidth+o.left+o.right))*$));this._hScrollDiv.style.left=d+Math.floor(Math.max(0,Math.floor(s.x*$/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=m-9+"px",this._hScrollDiv.style.width=J+"px"}var K=s.x,Q=this._clipDiv,G=this._overlayDiv,Y,Z;if(Q){Q.scrollLeft=K,Y=d+o.left,Z=o.top;var et=f,tt=m,nt=0,rt=-h;s.x===0&&(Y-=o.left,et+=o.left,nt=o.left),s.x+f===g&&(et+=o.right),s.y===0&&(Z-=o.top,tt+=o.top,rt+=o.top),s.y+m===b&&(tt+=o.bottom),Q.style.left=Y+"px",Q.style.top=Z+"px",Q.style.right=N-et-Y+"px",Q.style.bottom=C-tt-Z+"px",n.style.left=nt+"px",n.style.top=rt+"px",n.style.width=g+"px",n.style.height=m+h+"px",G&&(G.style.left=n.style.left,G.style.top=n.style.top,G.style.width=n.style.width,G.style.height=n.style.height)}else{Y=K,Z=h;var it=K+f,st=h+m;Y===0&&(Y-=o.left),Z===0&&(Z-=o.top),it===g&&(it+=o.right),s.y+m===b&&(st+=o.bottom),n.style.clip="rect("+Z+"px,"+it+"px,"+st+"px,"+Y+"px)",n.style.left=-K+d+o.left+"px",n.style.width=(i.isWebkit?g:f+K)+"px",e||(n.style.top=-h+o.top+"px",n.style.height=m+h+"px"),G&&(G.style.clip=n.style.clip,G.style.left=n.style.left,G.style.width=n.style.width,e||(G.style.top=n.style.top,G.style.height=n.style.height))}this._updateDOMSelection();var ot=this._ensureCaretVisible;this._ensureCaretVisible=!1,m!==this._getClientHeight()&&(this._update(),ot&&this._showCaret())},_updateRuler:function(e,t,n,r){if(!e)return;var s=this._parent.ownerDocument,o=this._getLineHeight(),u=this._getViewPadding(),f=e.firstChild;while(f){var l=f._ruler,c=o,h=l.getOverview();h==="page"&&(c+=this._topIndexY),f.style.top=-c+"px",f.style.height=r+c+"px",f.rulerChanged&&a(l.getRulerStyle(),f);var p,d=f.firstChild;d?(p=d,d=d.nextSibling):(p=i.createElement(s,"div"),p.style.visibility="hidden",f.appendChild(p));var v,m;f.rulerChanged&&p&&(v=-1,m=l.getWidestAnnotation(),m&&(a(m.style,p),m.html&&(p.innerHTML=m.html)),p.lineIndex=v,p.style.height=o+u.top+"px");var g,y,b;if(h==="page"){b=l.getAnnotations(t,n+1);while(d){v=d.lineIndex;var w=d.nextSibling;(!(t<=v&&v<=n)||d.lineChanged)&&f.removeChild(d),d=w}d=f.firstChild.nextSibling,y=s.createDocumentFragment();for(v=t;v<=n;v++)!d||d.lineIndex>v?(g=i.createElement(s,"div"),m=b[v],m&&(a(m.style,g),m.html&&(g.innerHTML=m.html),g.annotation=m),g.lineIndex=v,g.style.height=this._getLineHeight(v)+"px",y.appendChild(g)):(y.firstChild&&(f.insertBefore(y,d),y=s.createDocumentFragment()),d&&(d=d.nextSibling));y.firstChild&&f.insertBefore(y,d)}else{var E=this._getClientHeight(),S=this._model.getLineCount(),x=o*S,T=E+u.top+u.bottom-2*this._metrics.scrollWidth,N;x<T?N=o:N=T/S;if(f.rulerChanged){var C=f.childNodes.length;while(C>1)f.removeChild(f.lastChild),C--;b=l.getAnnotations(0,S),y=s.createDocumentFragment();for(var k in b){v=k>>>0;if(v<0)continue;g=i.createElement(s,"div"),m=b[k],a(m.style,g),g.style.position="absolute",g.style.top=this._metrics.scrollWidth+o+Math.floor(v*N)+"px",m.html&&(g.innerHTML=m.html),g.annotation=m,g.lineIndex=v,y.appendChild(g)}f.appendChild(y)}else if(f._oldTrackHeight!==T){g=f.firstChild?f.firstChild.nextSibling:null;while(g)g.style.top=this._metrics.scrollWidth+o+Math.floor(g.lineIndex*N)+"px",g=g.nextSibling}f._oldTrackHeight=T}f.rulerChanged=!1,f=f.nextSibling}},_updateStyleSheet:function(){var e="";i.isWebkit&&this._metrics.scrollWidth>0&&(e+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"),i.isFirefox&&i.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&(e+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(e){var t=document.getElementById("_textviewStyle");if(!t){t=i.createElement(document,"style"),t.id="_textviewStyle";var n=document.getElementsByTagName("head")[0]||document.documentElement;t.appendChild(document.createTextNode(e)),n.insertBefore(t,n.firstChild)}else t.removeChild(t.firstChild),t.appendChild(document.createTextNode(e))}},_updateStyle:function(e){!e&&i.isIE&&(this._rootDiv.style.lineHeight="normal");var t=this._metrics=this._calculateMetrics();i.isIE?this._rootDiv.style.lineHeight=t.lineHeight-(t.lineTrim.top+t.lineTrim.bottom)+"px":this._rootDiv.style.lineHeight="normal",this._updateStyleSheet(),e||(this.redraw(),this._resetLineWidth())}},n.EventTarget.addMixin(b.prototype),{TextView:b}}),define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(e,t){function n(e){this._model=e,this._projections=[]}return n.prototype={addProjection:function(t){if(!t)return;var n=this._model,r=this._projections;t._lineIndex=n.getLineAtOffset(t.start),t._lineCount=n.getLineAtOffset(t.end)-t._lineIndex;var i=t.text;i||(i=""),typeof i=="string"?t._model=new e.TextModel(i,n.getLineDelimiter()):t._model=i;var s=this.mapOffset(t.start,!0),o=t.end-t.start,u=t._lineCount,a=t._model.getCharCount(),f=t._model.getLineCount()-1,l={type:"Changing",text:t._model.getText(),start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(l);var c=this._binarySearch(r,t.start);r.splice(c,0,t);var h={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(h)},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(e,t){var n=this._projections,r=0,i,s;if(t){for(i=0;i<n.length;i++){s=n[i];if(s.start>e)break;if(s.end>e)return-1;r+=s._model.getCharCount()-(s.end-s.start)}return e+r}for(i=0;i<n.length;i++){s=n[i];if(s.start>e-r)break;var o=s._model.getCharCount();if(s.start+o>e-r)return-1;r+=o-(s.end-s.start)}return e-r},removeProjection:function(e){var t,n=0;for(t=0;t<this._projections.length;t++){var r=this._projections[t];if(r===e){e=r;break}n+=r._model.getCharCount()-(r.end-r.start)}if(t<this._projections.length){var i=this._model,s=e.start+n,o=e.end-e.start,u=e._lineCount,a=e._model.getCharCount(),f=e._model.getLineCount()-1,l={type:"Changing",text:i.getText(e.start,e.end),start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanging(l),this._projections.splice(t,1);var c={type:"Changed",start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanged(c)}},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1)i=Math.floor((n+r)/2),t<=e[i].start?n=i:r=i;return n},getCharCount:function(){var e=this._model.getCharCount(),t=this._projections;for(var n=0;n<t.length;n++){var r=t[n];e+=r._model.getCharCount()-(r.end-r.start)}return e},getLine:function(e,t){if(e<0)return null;var n=this._model,r=this._projections,i=0,s=[],o=0,u,a,f;for(u=0;u<r.length;u++){f=r[u];if(f._lineIndex>=e-i)break;a=f._model.getLineCount()-1;if(f._lineIndex+a>=e-i){var l=e-(f._lineIndex+i);if(l<a)return f._model.getLine(l,t);s.push(f._model.getLine(a))}o=f.end,i+=a-f._lineCount}o=Math.max(o,n.getLineStart(e-i));for(;u<r.length;u++){f=r[u];if(f._lineIndex>e-i)break;s.push(n.getText(o,f.start)),a=f._model.getLineCount()-1;if(f._lineIndex+a>e-i)return s.push(f._model.getLine(0,t)),s.join("");s.push(f._model.getText()),o=f.end,i+=a-f._lineCount}var c=n.getLineEnd(e-i,t);return o<c&&s.push(n.getText(o,c)),s.join("")},getLineAtOffset:function(e){var t=this._model,n=this._projections,r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o.start>e-r)break;var u=o._model.getCharCount();if(o.start+u>e-r){var a=e-(o.start+r);i+=o._model.getLineAtOffset(a),r+=a;break}i+=o._model.getLineCount()-1-o._lineCount,r+=u-(o.end-o.start)}return t.getLineAtOffset(e-r)+i},getLineCount:function(){var e=this._model,t=this._projections,n=e.getLineCount();for(var r=0;r<t.length;r++){var i=t[r];n+=i._model.getLineCount()-1-i._lineCount}return n},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(e,t){if(e<0)return-1;var n=this._model,r=this._projections,i=0,s=0;for(var o=0;o<r.length;o++){var u=r[o];if(u._lineIndex>e-i)break;var a=u._model.getLineCount()-1;if(u._lineIndex+a>e-i){var f=e-(u._lineIndex+i);return u._model.getLineEnd(f,t)+u.start+s}s+=u._model.getCharCount()-(u.end-u.start),i+=a-u._lineCount}return n.getLineEnd(e-i,t)+s},getLineStart:function(e){if(e<0)return-1;var t=this._model,n=this._projections,r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o._lineIndex>=e-r)break;var u=o._model.getLineCount()-1;if(o._lineIndex+u>=e-r){var a=e-(o._lineIndex+r);return o._model.getLineStart(a)+o.start+i}i+=o._model.getCharCount()-(o.end-o.start),r+=u-o._lineCount}return t.getLineStart(e-r)+i},getText:function(e,t){e===undefined&&(e=0);var n=this._model,r=this._projections,i=0,s=[],o,u,a;for(o=0;o<r.length;o++){u=r[o];if(u.start>e-i)break;a=u._model.getCharCount();if(u.start+a>e-i){if(t!==undefined&&u.start+a>t-i)return u._model.getText(e-(u.start+i),t-(u.start+i));s.push(u._model.getText(e-(u.start+i))),e=u.end+i+a-(u.end-u.start)}i+=a-(u.end-u.start)}var f=e-i;if(t!==undefined){for(;o<r.length;o++){u=r[o];if(u.start>t-i)break;s.push(n.getText(f,u.start)),a=u._model.getCharCount();if(u.start+a>t-i)return s.push(u._model.getText(0,t-(u.start+i))),s.join("");s.push(u._model.getText()),f=u.end,i+=a-(u.end-u.start)}s.push(n.getText(f,t-i))}else{for(;o<r.length;o++)u=r[o],s.push(n.getText(f,u.start)),s.push(u._model.getText()),f=u.end;s.push(n.getText(f))}return s.join("")},_onChanging:function(e,t,n,r,i,s){var o=this._model,u=this._projections,a,f,l=0,c,h=t+n;for(;a<u.length;a++){f=u[a];if(f.start>t)break;l+=f._model.getCharCount()-(f.end-f.start)}var p=t+l,d=a;for(;a<u.length;a++){f=u[a];if(f.start>h)break;l+=f._model.getCharCount()-(f.end-f.start),c+=f._model.getLineCount()-1-f._lineCount}var v=h+l,m=a;this.onChanging(p,v-p,r,i+c,s),u.splice(u,m-d);var g=e.length-(v-p);for(;a<u.length;a++)f=u[a],f.start+=g,f.end+=g,f._lineIndex=o.getLineAtOffset(f.start)},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e){this._model.setLineDelimiter(e)},setText:function(e,t,n){e===undefined&&(e=""),t===undefined&&(t=0);var r=t,i=n,s=this._model,o=this._projections,u=0,a=0,f,l,c,h,p,d=0;for(f=0;f<o.length;f++){l=o[f];if(l.start>t-u)break;c=l._model.getCharCount();if(l.start+c>t-u){if(n!==undefined&&l.start+c>n-u){l._model.setText(e,t-(l.start+u),n-(l.start+u));return}d=l._model.getLineCount()-1-l._model.getLineAtOffset(t-(l.start+u)),h={projection:l,start:t-(l.start+u)},t=l.end+u+c-(l.end-l.start)}a+=l._model.getLineCount()-1-l._lineCount,u+=c-(l.end-l.start)}var v=t-u,m=f,g=s.getLineAtOffset(v)+a-d;if(n!==undefined)for(;f<o.length;f++){l=o[f];if(l.start>n-u)break;c=l._model.getCharCount();if(l.start+c>n-u){a+=l._model.getLineAtOffset(n-(l.start+u)),c=n-(l.start+u),n=l.end+u,p={projection:l,end:c};break}a+=l._model.getLineCount()-1-l._lineCount,u+=c-(l.end-l.start)}else{for(;f<o.length;f++)l=o[f],a+=l._model.getLineCount()-1-l._lineCount,u+=l._model.getCharCount()-(l.end-l.start);n=i=s.getCharCount()+u}var y=n-u,b=f,w=s.getLineAtOffset(y)+a,E=i-r,S=w-g,x=e.length,T=0,N=0,C=0,k=0;for(;;){N!==-1&&N<=k&&(N=e.indexOf("\r",k)),C!==-1&&C<=k&&(C=e.indexOf("\n",k));if(C===-1&&N===-1)break;N!==-1&&C!==-1?N+1===C?k=C+1:k=(N<C?N:C)+1:N!==-1?k=N+1:k=C+1,T++}var L={type:"Changing",text:e,start:r,removedCharCount:E,addedCharCount:x,removedLineCount:S,addedLineCount:T};this.onChanging(L),s.setText(e,v,y),h&&(l=h.projection,l._model.setText("",h.start)),p&&(l=p.projection,l._model.setText("",0,p.end),l.start=l.end,l._lineCount=0),o.splice(m,b-m);var A=e.length-(y-v);for(f=b;f<o.length;f++)l=o[f],l.start+=A,l.end+=A,l._lineIndex=s.getLineAtOffset(l.start);var O={type:"Changed",start:r,removedCharCount:E,addedCharCount:x,removedLineCount:S,addedLineCount:T};this.onChanged(O)}},t.EventTarget.addMixin(n.prototype),{ProjectionTextModel:n}}),define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/util"],function(e,t,n,r,i){function s(e){this._view=e,this._create(e.getOptions("parent").ownerDocument),e.addEventListener("Destroy",this,this.destroy)}return s.getTooltip=function(e){return e._tooltip||(e._tooltip=new s(e)),e._tooltip},s.prototype={_create:function(e){if(this._tooltipDiv)return;var t=this._tooltipDiv=i.createElement(e,"div");t.className="textviewTooltip",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true");var n=this._tooltipContents=i.createElement(e,"div");t.appendChild(n),e.body.appendChild(t),this.hide()},_getWindow:function(){var e=this._tooltipDiv.ownerDocument;return e.defaultView||e.parentWindow},destroy:function(){if(!this._tooltipDiv)return;this.hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv),this._tooltipDiv=null},hide:function(){this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),this._tooltipDiv&&(this._tooltipDiv.style.visibility="hidden");var e=this._getWindow();this._showTimeout&&(e.clearTimeout(this._showTimeout),this._showTimeout=null),this._hideTimeout&&(e.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(e.clearInterval(this._fadeTimeout),this._fadeTimeout=null)},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(e,t){if(this.target===e)return;this._target=e,this.hide();if(e){var n=this;if(t===0)n.show(!0);else{var r=this._getWindow();n._showTimeout=r.setTimeout(function(){n.show(!0)},t?t:500)}}},show:function(e){if(!this._target)return;var n=this._target.getTooltipInfo();if(!n)return;var i=this._tooltipDiv,s=this._tooltipContents;i.style.left=i.style.right=i.style.width=i.style.height=s.style.width=s.style.height="auto";var o=n.contents;o instanceof Array&&(o=this._getAnnotationContents(o));if(typeof o=="string")s.innerHTML=o;else if(this._isNode(o))s.appendChild(o);else{if(!(o instanceof r.ProjectionTextModel))return;var u=this._view,a=u.getOptions();a.wrapMode=!1,a.parent=s;var f="tooltip",l=a.themeClass;l?(l=l.replace(f,""),l&&(l=" "+l),l=f+l):l=f,a.themeClass=l;var c=this._contentsView=new t.TextView(a);c._clientDiv.contentEditable=!1;var h={onLineStyle:function(e){u.onLineStyle(e)}};c.addEventListener("LineStyle",h.onLineStyle),c.setModel(o);var p=c.computeSize();s.style.width=p.width+"px",s.style.height=p.height+"px",c.resize()}var d=i.ownerDocument.documentElement;if(n.anchor==="right"){var v=d.clientWidth-n.x;i.style.right=v+"px",i.style.maxWidth=d.clientWidth-v-10+"px"}else{var m=parseInt(this._getNodeStyle(i,"padding-left","0"),10);m+=parseInt(this._getNodeStyle(i,"border-left-width","0"),10),m=n.x-m,i.style.left=m+"px",i.style.maxWidth=d.clientWidth-m-10+"px"}var g=parseInt(this._getNodeStyle(i,"padding-top","0"),10);g+=parseInt(this._getNodeStyle(i,"border-top-width","0"),10),g=n.y-g,i.style.top=g+"px",i.style.maxHeight=d.clientHeight-g-10+"px",i.style.opacity="1",i.style.visibility="visible";if(e){var y=this,b=this._getWindow();y._hideTimeout=b.setTimeout(function(){var e=parseFloat(y._getNodeStyle(i,"opacity","1"));y._fadeTimeout=b.setInterval(function(){if(i.style.visibility==="visible"&&e>0){e-=.1,i.style.opacity=e;return}y.hide()},50)},5e3)}},_getAnnotationContents:function(t){function o(e,t){var n=s.getLineStart(s.getLineAtOffset(e)),r=s.getLineEnd(s.getLineAtOffset(t),!0);return s.getText(n,r)}function u(e){var t=e.title;if(t==="")return null;var n="<div>";return e.html&&(n+=e.html+"&nbsp;"),t||(t=o(e.start,e.end)),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n+="<span style='vertical-align:middle;'>"+t+"</span><div>",n}if(t.length===0)return null;var n=this._view.getModel(),i,s=n.getBaseModel?n.getBaseModel():n;if(t.length===1){i=t[0];if(i.title!==undefined)return u(i);var a=new r.ProjectionTextModel(s),f=s.getLineStart(s.getLineAtOffset(i.start)),l=s.getCharCount();return i.end!==l&&a.addProjection({start:i.end,end:l}),f>0&&a.addProjection({start:0,end:f}),a}var c="<div><em>"+e.multipleAnnotations+"</em></div>";for(var h=0;h<t.length;h++){i=t[h];var p=u(i);p&&(c+=p)}return c},_getNodeStyle:function(e,t,n){var r;if(e){r=e.style[t];if(!r)if(e.currentStyle){var i=0,s=t;while((i=s.indexOf("-",i))!==-1)s=s.substring(0,i)+s.substring(i+1,i+2).toUpperCase()+s.substring(i+2);r=e.currentStyle[s]}else{var o=e.ownerDocument.defaultView.getComputedStyle(e,null);r=o?o.getPropertyValue(t):null}}return r||n},_isNode:function(e){return typeof Node=="object"?e instanceof Node:e&&typeof e=="object"&&typeof e.nodeType=="number"&&typeof e.nodeName=="string"}},{Tooltip:s}}),define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(e,t){function n(e,t,n){this.start=e,this.end=t,this._projectionModel=n,this.html=this._expandedHTML,this.style=this._expandedStyle,this.expanded=!0}function r(){}function s(t,n){var i=t.lastIndexOf("."),s=t.substring(i+1),o={title:e[s],style:{styleClass:"annotation "+s},html:"<div class='annotationHTML "+s+"'></div>",overviewStyle:{styleClass:"annotationOverview "+s}};n?o.lineStyle={styleClass:"annotationLine "+s}:o.rangeStyle={styleClass:"annotationRange "+s},r.registerType(t,o)}function o(){}function u(e){this._annotations=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)}},this.setTextModel(e)}function a(e,t){this._view=e,this._annotationModel=t;var n=this;this._listener={onDestroy:function(e){n._onDestroy(e)},onLineStyle:function(e){n._onLineStyle(e)},onChanged:function(e){n._onAnnotationModelChanged(e)}},e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("postLineStyle",this._listener.onLineStyle),t.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(!this.expanded)return;this.expanded=!1,this.html=this._collapsedHTML,this.style=this._collapsedStyle;var e=this._projectionModel,t=e.getBaseModel();this._projection={start:t.getLineStart(t.getLineAtOffset(this.start)+1),end:t.getLineEnd(t.getLineAtOffset(this.end),!0)},e.addProjection(this._projection)},expand:function(){if(this.expanded)return;this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}},r.ANNOTATION_ERROR="orion.annotation.error",r.ANNOTATION_WARNING="orion.annotation.warning",r.ANNOTATION_TASK="orion.annotation.task",r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint",r.ANNOTATION_BOOKMARK="orion.annotation.bookmark",r.ANNOTATION_FOLDING="orion.annotation.folding",r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket",r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket",r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine",r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch",r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch",r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence",r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence",r.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup",r.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup",r.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";var i={};return r.registerType=function(e,t){var n=t;return typeof n!="function"&&(n=function(e,t,n){this.start=e,this.end=t,n&&(this.title=n)},n.prototype=t),n.prototype.type=e,i[e]=n,e},r.createAnnotation=function(e,t,n,r){return new(this.getType(e))(t,n,r)},r.getType=function(e){return i[e]},s(r.ANNOTATION_ERROR),s(r.ANNOTATION_WARNING),s(r.ANNOTATION_TASK),s(r.ANNOTATION_BREAKPOINT),s(r.ANNOTATION_BOOKMARK),s(r.ANNOTATION_CURRENT_BRACKET),s(r.ANNOTATION_MATCHING_BRACKET),s(r.ANNOTATION_CURRENT_SEARCH),s(r.ANNOTATION_MATCHING_SEARCH),s(r.ANNOTATION_READ_OCCURRENCE),s(r.ANNOTATION_WRITE_OCCURRENCE),s(r.ANNOTATION_SELECTED_LINKED_GROUP),s(r.ANNOTATION_CURRENT_LINKED_GROUP),s(r.ANNOTATION_LINKED_GROUP),s(r.ANNOTATION_CURRENT_LINE,!0),r.registerType(r.ANNOTATION_FOLDING,n),o.addMixin=function(e){var t=o.prototype;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o.prototype={addAnnotationType:function(e){this._annotationTypes||(this._annotationTypes=[]),this._annotationTypes.push(e)},getAnnotationTypePriority:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e)return t+1;return 0},getAnnotationsByType:function(e,t,n){var r=e.getAnnotations(t,n),i,s=[];while(r.hasNext()){i=r.next();var o=this.getAnnotationTypePriority(i.type);if(o===0)continue;s.push(i)}var u=this;return s.sort(function(e,t){return u.getAnnotationTypePriority(e.type)-u.getAnnotationTypePriority(t.type)}),s},isAnnotationTypeVisible:function(e){return this.getAnnotationTypePriority(e)!==0},removeAnnotationType:function(e){if(!this._annotationTypes)return;for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e){this._annotationTypes.splice(t,1);break}}},u.prototype={addAnnotation:function(e){if(!e)return;var t=this._annotations,n=this._binarySearch(t,e.start);t.splice(n,0,e);var r={type:"Changed",added:[e],removed:[],changed:[]};this.onChanged(r)},getTextModel:function(){return this._model},getAnnotations:function(e,t){var n=this._annotations,r,i=0,s=function(){while(i<n.length){var r=n[i++];if(e===r.start||(e>r.start?e<r.end:r.start<t))return r;if(r.start>=t)break}return null};return r=s(),{next:function(){var e=r;return e&&(r=s()),e},hasNext:function(){return r!==null}}},modifyAnnotation:function(e){if(!e)return;var t=this._getAnnotationIndex(e);if(t<0)return;var n={type:"Changed",added:[],removed:[],changed:[e]};this.onChanged(n)},onChanged:function(e){return this.dispatchEvent(e)},removeAnnotations:function(e){var t=this._annotations,n,r;if(e){n=[];for(r=t.length-1;r>=0;r--){var i=t[r];i.type===e&&t.splice(r,1),n.splice(0,0,i)}}else n=t,t=[];var s={type:"Changed",removed:n,added:[],changed:[]};this.onChanged(s)},removeAnnotation:function(e){if(!e)return;var t=this._getAnnotationIndex(e);if(t<0)return;var n={type:"Changed",removed:this._annotations.splice(t,1),added:[],changed:[]};this.onChanged(n)},replaceAnnotations:function(e,t){var n=this._annotations,r,i,s,o=[];if(e)for(r=e.length-1;r>=0;r--){s=e[r],i=this._getAnnotationIndex(s);if(i<0)continue;n.splice(i,1),o.splice(0,0,s)}t||(t=[]);for(r=0;r<t.length;r++)s=t[r],i=this._binarySearch(n,s.start),n.splice(i,0,s);var u={type:"Changed",removed:o,added:t,changed:[]};this.onChanged(u)},setTextModel:function(e){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged),this._model=e,this._model&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1)i=Math.floor((n+r)/2),t<=e[i].start?n=i:r=i;return n},_getAnnotationIndex:function(e){var t=this._annotations,n=this._binarySearch(t,e.start);while(n<t.length&&t[n].start===e.start){if(t[n]===e)return n;n++}return-1},_onChanged:function(e){var t=e.start,n=e.addedCharCount,r=e.removedCharCount,i=this._annotations,s=t+r,o=0;if(!(0<=o&&o<i.length))return;var u={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:e},a=n-r,f;for(f=o;f<i.length;f++){var l=i[f];l.start>=s?(l.start+=a,l.end+=a,u.changed.push(l)):l.end<=t||(l.start<t&&s<l.end?(l.end+=a,u.changed.push(l)):(i.splice(f,1),u.removed.push(l),f--))}(u.added.length>0||u.removed.length>0||u.changed.length>0)&&this.onChanged(u)}},t.EventTarget.addMixin(u.prototype),a.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);var t=this._annotationModel;t&&(t.removeEventListener("Changed",this._listener.onChanged),t=null)},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.style){e.style||(e.style={});for(n in t.style)e.style[n]||(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)e.attributes[n]||(e.attributes[n]=t.attributes[n])}}return e},_mergeStyleRanges:function(e,t){e||(e=[]);var n,r;for(r=0;r<e.length&&t;r++){var i=e[r];if(t.end<=i.start)break;if(t.start>=i.end)continue;n=this._mergeStyle({},i.style),n=this._mergeStyle(n,t.style);var s=[];s.push(r,1),t.start<i.start&&s.push({start:t.start,end:i.start,style:t.style}),t.start>i.start&&s.push({start:i.start,end:t.start,style:i.style}),s.push({start:Math.max(i.start,t.start),end:Math.min(i.end,t.end),style:n}),t.end<i.end&&s.push({start:t.end,end:i.end,style:i.style}),t.end>i.end?t={start:i.end,end:t.end,style:t.style}:t=null,Array.prototype.splice.apply(e,s)}return t&&(n=this._mergeStyle({},t.style),e.splice(r,0,{start:t.start,end:t.end,style:n})),e},_onAnnotationModelChanged:function(e){function i(e){for(var i=0;i<e.length;i++){if(!n.isAnnotationTypeVisible(e[i].type))continue;var s=e[i].start,o=e[i].end;r.getBaseModel&&(s=r.mapOffset(s,!0),o=r.mapOffset(o,!0)),s!==-1&&o!==-1&&t.redrawRange(s,o)}}if(e.textModelChangedEvent)return;var t=this._view;if(!t)return;var n=this,r=t.getModel();i(e.added),i(e.removed),i(e.changed)},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){var t=this._annotationModel,n=e.textView.getModel(),r=t.getTextModel(),i=e.lineStart,s=e.lineStart+e.lineText.length;r!==n&&(i=n.mapOffset(i),s=n.mapOffset(s));var o=t.getAnnotations(i,s);while(o.hasNext()){var u=o.next();if(!this.isAnnotationTypeVisible(u.type))continue;if(u.rangeStyle){var a=u.start,f=u.end;r!==n&&(a=n.mapOffset(a,!0),f=n.mapOffset(f,!0)),e.ranges=this._mergeStyleRanges(e.ranges,{start:a,end:f,style:u.rangeStyle})}u.lineStyle&&(e.style=this._mergeStyle({},e.style),e.style=this._mergeStyle(e.style,u.lineStyle))}}},o.addMixin(a.prototype),{FoldingAnnotation:n,AnnotationType:r,AnnotationTypeList:o,AnnotationModel:u,AnnotationStyler:a}}),define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/util"],function(e,t,n,r,i,s){function u(e){this._textViewFactory=e.textViewFactory,this._undoStackFactory=e.undoStackFactory,this._textDNDFactory=e.textDNDFactory,this._annotationFactory=e.annotationFactory,this._foldingRulerFactory=e.foldingRulerFactory,this._lineNumberRulerFactory=e.lineNumberRulerFactory,this._contentAssistFactory=e.contentAssistFactory,this._keyBindingFactory=e.keyBindingFactory,this._statusReporter=e.statusReporter,this._domNode=e.domNode,this._annotationStyler=null,this._annotationModel=null,this._annotationRuler=null,this._lineNumberRuler=null,this._overviewRuler=null,this._foldingRuler=null,this._dirty=!1,this._contentAssist=null,this._title=null,this._keyModes=[]}function a(e){var t=this,n=Array.prototype.slice.call(arguments,1);return n.length?function(){return arguments.length?t.apply(e,n.concat(Array.prototype.slice.call(arguments))):t.apply(e,n)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}var o="orion.annotation.highlightError";return u.prototype={destroy:function(){this.uninstallTextView(),this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var e=this._textView.getModel();return e.getBaseModel&&(e=e.getBaseModel()),e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(e){if(this._annotationRulerVisible===e)return;this._annotationRulerVisible=e;if(!this._annotationRuler)return;var t=this._textView;e?t.addRuler(this._annotationRuler,0):t.removeRuler(this._annotationRuler)},setFoldingRulerVisible:function(e){if(this._foldingRulerVisible===e)return;this._foldingRulerVisible=e;if(!this._foldingRuler)return;var t=this._textView;if(!t.getModel().getBaseModel)return;e?t.addRuler(this._foldingRuler,100):t.removeRuler(this._foldingRuler)},setDirty:function(e){if(this._dirty===e)return;this._dirty=e,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(e){if(this._lineNumberRulerVisible===e)return;this._lineNumberRulerVisible=e;if(!this._lineNumberRuler)return;var t=this._textView;e?t.addRuler(this._lineNumberRuler,1):t.removeRuler(this._lineNumberRuler)},setOverviewRulerVisible:function(e){if(this._overviewRulerVisible===e)return;this._overviewRulerVisible=e;if(!this._overviewRuler)return;var t=this._textView;e?t.addRuler(this._overviewRuler):t.removeRuler(this._overviewRuler)},mapOffset:function(e,t){var n=this._textView,r=n.getModel();return r.getBaseModel&&(e=r.mapOffset(e,t)),e},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var e=this._textView,t=e.getSelection(),n=e.getModel();return n.getBaseModel&&(t.start=n.mapOffset(t.start),t.end=n.mapOffset(t.end)),t},getText:function(e,t){var n=this._textView,r=n.getModel();return r.getBaseModel&&(r=r.getBaseModel()),r.getText(e,t)},_expandOffset:function(e){var t=this._textView.getModel(),n=this._annotationModel;if(!n||!t.getBaseModel)return;var r=n.getAnnotations(e,e+1);while(r.hasNext()){var s=r.next();s.type===i.AnnotationType.ANNOTATION_FOLDING&&s.expand&&(s.expand(),n.modifyAnnotation(s))}},setCaretOffset:function(e,t,n){var r=this._textView,i=r.getModel();i.getBaseModel&&(this._expandOffset(e),e=i.mapOffset(e,!0)),r.setCaretOffset(e,t,n)},setText:function(e,t,n){var r=this._textView,i=r.getModel();i.getBaseModel&&(t!==undefined&&(this._expandOffset(t),t=i.mapOffset(t,!0)),n!==undefined&&(this._expandOffset(n),n=i.mapOffset(n,!0))),r.setText(e,t,n)},setFoldingEnabled:function(e){this.setFoldingRulerVisible(e)},setSelection:function(e,t,n,r){var i=this._textView,s=i.getModel();s.getBaseModel&&(this._expandOffset(e),this._expandOffset(t),e=s.mapOffset(e,!0),t=s.mapOffset(t,!0)),i.setSelection(e,t,n,r)},moveSelection:function(e,t,n,r){t=t||e;var i=this._textView;this.setSelection(e,t,1/3,function(){(r===undefined||r)&&i.focus(),n&&n()})},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(e,t,n){this._statusReporter&&this._statusReporter(e,t,n)},_getTooltipInfo:function(e,t){var n=this._textView,r=this.getAnnotationModel();if(!r)return null;var i=this._annotationStyler;if(!i)return null;var s=n.getOffsetAtLocation(e,t);if(s===-1)return null;s=this.mapOffset(s);var o=i.getAnnotationsByType(r,s,s+1),u=[];for(var a=0;a<o.length;a++)o[a].rangeStyle&&u.push(o[a]);if(u.length===0)return null;var f=n.convert({x:e,y:t},"document","page"),l={contents:u,anchor:"left",x:f.x+10,y:f.y+20};return l},_highlightCurrentLine:function(e,t){var n=this._annotationModel;if(!n)return;var r=this._textView,s=r.getModel(),o=t?s.getLineAtOffset(t.start):-1,u=s.getLineAtOffset(e.start),a=e.start===e.end,f=!t||t.start===t.end,l=s.getLineStart(u),c=s.getLineEnd(u);s.getBaseModel&&(l=s.mapOffset(l),c=s.mapOffset(c));var h=this._currentLineAnnotation;if(o===u&&f&&a&&h&&h.start===l&&h.end===c)return;var p=h?[h]:null,d;if(a){var v=i.AnnotationType.ANNOTATION_CURRENT_LINE;h=i.AnnotationType.createAnnotation(v,l,c),d=[h]}this._currentLineAnnotation=h,n.replaceAnnotations(p,d)},installTextView:function(){this._textView=this._textViewFactory(),this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this)),this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));if(this._contentAssistFactory){var n=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(n),this._contentAssist=n.getContentAssist()}var s=this,u=this._textView,a=this;this._listener={onModelChanged:function(e){a.checkDirty()},onMouseOver:function(e){a._listener.onMouseMove(e)},onMouseMove:function(e){var t=r.Tooltip.getTooltip(u);if(!t)return;if(a._listener.lastMouseX===e.event.clientX&&a._listener.lastMouseY===e.event.clientY)return;a._listener.lastMouseX=e.event.clientX,a._listener.lastMouseY=e.event.clientY,t.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){return a._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(e){var t=r.Tooltip.getTooltip(u);if(!t)return;if(a._listener.lastMouseX===e.event.clientX&&a._listener.lastMouseY===e.event.clientY)return;a._listener.lastMouseX=e.event.clientX,a._listener.lastMouseY=e.event.clientY,t.setTarget(null)},onScroll:function(e){var t=r.Tooltip.getTooltip(u);if(!t)return;t.setTarget(null)},onSelection:function(e){a._updateCursorStatus(),a._highlightCurrentLine(e.newValue,e.oldValue)}},u.addEventListener("ModelChanged",this._listener.onModelChanged),u.addEventListener("Selection",this._listener.onSelection),u.addEventListener("MouseOver",this._listener.onMouseOver),u.addEventListener("MouseOut",this._listener.onMouseOut),u.addEventListener("MouseMove",this._listener.onMouseMove),u.addEventListener("Scroll",this._listener.onScroll),this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist),u.setKeyBinding(new t.KeyBinding(27),"cancelMode"),u.setAction("cancelMode",function(){var e=!1;for(var t=0;t<this._keyModes.length;t++)this._keyModes[t].isActive()&&(e=this._keyModes[t].cancel()||e);return e}.bind(this),{name:e.cancelMode}),u.setAction("lineUp",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].lineUp();return!1}.bind(this)),u.setAction("lineDown",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].lineDown();return!1}.bind(this)),u.setAction("enter",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].enter();return!1}.bind(this));var f=function(e,t){if(e===undefined)return;if(e===-1)return;var n=this.getView(),r=n.getModel(),o=this.getAnnotationModel(),u=s.mapOffset(r.getLineStart(e)),a=s.mapOffset(r.getLineEnd(e)),f=o.getAnnotations(u,a),l=null;while(f.hasNext()){var c=f.next();if(c.type===i.AnnotationType.ANNOTATION_BOOKMARK){l=c;break}}l?o.removeAnnotation(l):(l=i.AnnotationType.createAnnotation(i.AnnotationType.ANNOTATION_BOOKMARK,u,a),l.title=undefined,o.addAnnotation(l))};if(this._annotationFactory){var l=u.getModel();l.getBaseModel&&(l=l.getBaseModel()),this._annotationModel=this._annotationFactory.createAnnotationModel(l);if(this._annotationModel){var c=this._annotationStyler=this._annotationFactory.createAnnotationStyler(u,this._annotationModel);c&&(c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),c.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_SEARCH),c.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),c.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),c.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_BRACKET),c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_BRACKET),c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_LINE),c.addAnnotationType(i.AnnotationType.ANNOTATION_READ_OCCURRENCE),c.addAnnotationType(i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),c.addAnnotationType(i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP),c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP),c.addAnnotationType(i.AnnotationType.ANNOTATION_LINKED_GROUP),c.addAnnotationType(o))}u.annotationModel=this._annotationModel;var h=this._annotationFactory.createAnnotationRulers(this._annotationModel),p=this._annotationRuler=h.annotationRuler;p&&(p.onDblClick=f,p.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),p.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),p.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),p.addAnnotationType(i.AnnotationType.ANNOTATION_TASK),p.addAnnotationType(i.AnnotationType.ANNOTATION_BOOKMARK)),this.setAnnotationRulerVisible(!0),p=this._overviewRuler=h.overviewRuler,p&&(p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),p.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_SEARCH),p.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),p.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),p.addAnnotationType(i.AnnotationType.ANNOTATION_TASK),p.addAnnotationType(i.AnnotationType.ANNOTATION_BOOKMARK),p.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_BRACKET),p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_BRACKET),p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_LINE),p.addAnnotationType(i.AnnotationType.ANNOTATION_READ_OCCURRENCE),p.addAnnotationType(i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)),this.setOverviewRulerVisible(!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=f,this.setLineNumberRulerVisible(!0)),this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(i.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1));var d={type:"TextViewInstalled",textView:u};this.dispatchEvent(d)},uninstallTextView:function(){var e=this._textView;if(!e)return;e.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[];var t={type:"TextViewUninstalled",textView:e};this.dispatchEvent(t)},_updateCursorStatus:function(){var t=this.getModel(),n=this.getCaretOffset(),r=t.getLineAtOffset(n),i=t.getLineStart(r),o=n-i;for(var u=0;u<this._keyModes.length;u++){var a=this._keyModes[u];if(a.isActive()&&a.isStatusActive&&a.isStatusActive())return}this.reportStatus(s.formatMessage(e.lineColumn,r+1,o+1))},showProblems:function(e){var t=this._annotationModel;if(!t)return;var n=[],r=[],s=t.getTextModel(),o=t.getAnnotations(0,s.getCharCount()),u;while(o.hasNext())u=o.next(),(u.type===i.AnnotationType.ANNOTATION_ERROR||u.type===i.AnnotationType.ANNOTATION_WARNING)&&n.push(u);if(e)for(var a=0;a<e.length;a++){var f=e[a];if(f){var l=f.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),c=f.line-1,h=s.getLineStart(c),p=f.severity,d=p==="error"?i.AnnotationType.ANNOTATION_ERROR:i.AnnotationType.ANNOTATION_WARNING,v=h+f.start-1,m=h+f.end;u=i.AnnotationType.createAnnotation(d,v,m,l),r.push(u)}}t.replaceAnnotations(n,r)},showOccurrences:function(e){var t=this._annotationModel;if(!t)return;var n=[],r=[],s=t.getTextModel(),o=t.getAnnotations(0,s.getCharCount()),u;while(o.hasNext())u=o.next(),(u.type===i.AnnotationType.ANNOTATION_READ_OCCURRENCE||u.type===i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&n.push(u);if(e)for(var a=0;a<e.length;a++){var f=e[a];if(f){var l=f.line-1,c=s.getLineStart(l),h=c+f.start-1,p=c+f.end,d=f.readAccess===!0?i.AnnotationType.ANNOTATION_READ_OCCURRENCE:i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,v=f.description;u=i.AnnotationType.createAnnotation(d,h,p,v),r.push(u)}}t.replaceAnnotations(n,r)},showSelection:function(e,t,n,r,i){if(typeof e=="number")typeof t!="number"&&(t=e),this.moveSelection(e,t);else if(typeof n=="number"){var s=this.getModel(),o=s.getLineStart(n-1);typeof r=="number"&&(o+=r),typeof i!="number"&&(i=0),this.moveSelection(o,o+i)}},setInput:function(e,t,n,r){this._title=e,this._textView&&(r?(this._undoStack.markClean(),this.checkDirty()):(t?this._textView.setText(t):n!==null&&n!==undefined&&(this._textView.setText(n),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus())),this.onInputChanged({type:"InputChanged",title:e,message:t,contents:n,contentsSaved:r})},onInputChanged:function(e){return this.dispatchEvent(e)},onGotoLine:function(e,t,n){if(this._textView){var r=this.getModel(),i=r.getLineStart(e),s=0;n===undefined&&(n=0);if(typeof t=="string"){var o=r.getLine(e).indexOf(t);o!==-1&&(s=o,n=s+t.length)}else{s=t;var u=r.getLineEnd(e)-i;s=Math.min(s,u),n=Math.min(n,u)}this.moveSelection(i+s,i+n)}},onDirtyChanged:function(e){return this.dispatchEvent(e)}},n.EventTarget.addMixin(u.prototype),Function.prototype.bind||(Function.prototype.bind=a),{Editor:u}}),define("orion/editor/undoStack",[],function(){function e(e,t,n){this.offset=e,this.text=t,this.previousText=n}function t(e){this.owner=e,this.changes=[]}function n(e,t){this.view=e,this.size=t!==undefined?t:100,this.reset();var n=e.getModel();n.getBaseModel&&(n=n.getBaseModel()),this.model=n;var r=this;this._listener={onChanging:function(e){r._onChanging(e)},onDestroy:function(e){r._onDestroy(e)}},n.addEventListener("Changing",this._listener.onChanging),e.addEventListener("Destroy",this._listener.onDestroy)}return e.prototype={undo:function(e,t){this._doUndoRedo(this.offset,this.previousText,this.text,e,t)},redo:function(e,t){this._doUndoRedo(this.offset,this.text,this.previousText,e,t)},_doUndoRedo:function(e,t,n,r,i){var s=r.getModel();if(s.mapOffset&&r.annotationModel){var o=s.mapOffset(e,!0);if(o<0){var u=r.annotationModel,a=u.getAnnotations(e,e+1);while(a.hasNext()){var f=a.next();if(f.type==="orion.annotation.folding"){f.expand(),o=s.mapOffset(e,!0);break}}}if(o<0)return;e=o}s.setText(t,e,e+n.length),i&&r.setSelection(e,e+t.length)}},t.prototype={add:function(e){this.changes.push(e)},end:function(e){this.endSelection=e.getSelection(),this.endCaret=e.getCaretOffset();var t=this.owner;t&&t.end&&t.end()},undo:function(e,t){for(var n=this.changes.length-1;n>=0;n--)this.changes[n].undo(e,!1);if(t){var r=this.startSelection.start,i=this.startSelection.end;e.setSelection(this.startCaret?r:i,this.startCaret?i:r)}var s=this.owner;s&&s.undo&&s.undo()},redo:function(e,t){for(var n=0;n<this.changes.length;n++)this.changes[n].redo(e,!1);if(t){var r=this.endSelection.start,i=this.endSelection.end;e.setSelection(this.endCaret?r:i,this.endCaret?i:r)}var s=this.owner;s&&s.redo&&s.redo()},start:function(e){this.startSelection=e.getSelection(),this.startCaret=e.getCaretOffset();var t=this.owner;t&&t.start&&t.start()}},n.prototype={add:function(e){if(this.compoundChange)this.compoundChange.add(e);else{var t=this.stack.length;this.stack.splice(this.index,t-this.index,e),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--)}},markClean:function(){this.endCompoundChange(),this._commitUndo(),this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view),this.compoundChange=undefined},getSize:function(){var e=this.index,t=this.stack.length;return this._undoStart!==undefined&&e++,{undo:e,redo:t-e}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var e=this.stack[--this.index];return this._ignoreUndo=!0,e.undo(this.view,!0),this._ignoreUndo=!1,!0},redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var e=this.stack[this.index++];return this._ignoreUndo=!0,e.redo(this.view,!0),this._ignoreUndo=!1,!0},reset:function(){this.index=this.cleanIndex=0,this.stack=[],this._undoStart=undefined,this._undoText="",this._undoType=0,this._ignoreUndo=!1,this._compoundChange=undefined},startCompoundChange:function(e){this._commitUndo();var n=new t(e);return this.add(n),this.compoundChange=n,this.compoundChange.start(this.view),this.compoundChange},_commitUndo:function(){this._undoStart!==undefined&&(this._undoType===-1?this.add(new e(this._undoStart,"",this._undoText)):this.add(new e(this._undoStart,this._undoText,"")),this._undoStart=undefined,this._undoText="",this._undoType=0),this.endCompoundChange()},_onDestroy:function(e){this.model.removeEventListener("Changing",this._listener.onChanging),this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(t){var n=t.text,r=t.start,i=t.removedCharCount,s=t.addedCharCount;if(this._ignoreUndo)return;this._undoStart!==undefined&&(s!==1||i!==0||this._undoType!==1||r!==this._undoStart+this._undoText.length)&&(s!==0||i!==1||this._undoType!==-1||r+1!==this._undoStart&&r!==this._undoStart)&&this._commitUndo();if(!this.compoundChange){if(s===1&&i===0){this._undoStart===undefined&&(this._undoStart=r),this._undoText=this._undoText+n,this._undoType=1;return}if(s===0&&i===1){var o=this._undoText.length>0&&this._undoStart===r;this._undoStart=r,this._undoType=-1,o?this._undoText=this._undoText+this.model.getText(r,r+i):this._undoText=this.model.getText(r,r+i)+this._undoText;return}}this.add(new e(r,n,this.model.getText(r,r+i)))}},{UndoStack:n}}),define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(e,t,n,r){function i(e,t,n,r){this._location=t||"left",this._overview=n||"page",this._rulerStyle=r,this._view=null;var i=this;this._listener={onTextModelChanged:function(e){i._onTextModelChanged(e)},onAnnotationModelChanged:function(e){i._onAnnotationModelChanged(e)}},this.setAnnotationModel(e)}function s(e,t,n,r,s){i.call(this,e,t,"page",n),this._oddStyle=r||{style:{backgroundColor:"white"}},this._evenStyle=s||{style:{backgroundColor:"white"}},this._numOfDigits=0}function o(e,t,n){i.call(this,e,t,"page",n)}function u(e,t,n){i.call(this,e,t,"document",n)}function a(e,t,n){o.call(this,e,t,n)}return i.prototype={getAnnotations:function(e,t){var n=this._annotationModel;if(!n)return[];var r=this._view.getModel(),i=r.getLineStart(e),s=r.getLineEnd(t-1),o=r;r.getBaseModel&&(o=r.getBaseModel(),i=r.mapOffset(i),s=r.mapOffset(s));var u=[],a=this.getAnnotationsByType(n,i,s);for(var f=0;f<a.length;f++){var l=a[f],c=o.getLineAtOffset(l.start),h=o.getLineAtOffset(Math.max(l.start,l.end-1));for(var p=c;p<=h;p++){var d=p;if(r!==o){var v=o.getLineStart(p);v=r.mapOffset(v,!0);if(v===-1)continue;d=r.getLineAtOffset(v)}if(!(e<=d&&d<t))continue;var m=this._mergeAnnotation(u[d],l,p-c,h-c+1);m&&(u[d]=m)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var g in u)u[g]._multiple&&(u[g].html=u[g].html+this._multiAnnotationOverlay.html);return u},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged),this._annotationModel=e,this._annotationModel&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=e},setView:function(e){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged),this._view=e,this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(e,t){if(e===undefined)return;var r=this._view,i=r.getModel(),s=i,o=i.getLineStart(e),u=o,a=this._annotationModel;if(a){var f=r.getSelection(),l=Math.max(f.start,f.end);u=i.getLineEnd(e,!0),o<=l&&l<i.getLineEnd(e)&&(o=l+1),i.getBaseModel&&(o=i.mapOffset(o),u=i.mapOffset(u),s=i.getBaseModel());var c,h=a.getAnnotations(o,u);while(!c&&h.hasNext()){var p=h.next();if(!this.isAnnotationTypeVisible(p.type))continue;c=p}c&&s.getLineAtOffset(c.start)===s.getLineAtOffset(o)?(o=c.start,u=c.end):u=o,i.getBaseModel&&(o=i.mapOffset(o,!0),u=i.mapOffset(u,!0))}var d=n.Tooltip.getTooltip(this._view);d&&d.setTarget(null),this._view.setSelection(u,o,1/3,function(){})},onDblClick:function(e,t){},onMouseMove:function(e,t){var r=n.Tooltip.getTooltip(this._view);if(!r)return;if(r.isVisible()&&this._tooltipLineIndex===e)return;this._tooltipLineIndex=e;var i=this;r.setTarget({y:t.clientY,getTooltipInfo:function(){return i._getTooltipInfo(i._tooltipLineIndex,this.y)}})},onMouseOver:function(e,t){this.onMouseMove(e,t)},onMouseOut:function(e,t){var r=n.Tooltip.getTooltip(this._view);if(!r)return;r.setTarget(null)},_getTooltipInfo:function(e,t){if(e===undefined)return;var n=this._view,r=n.getModel(),i=this._annotationModel,s=[];if(i){var o=r.getLineStart(e),u=r.getLineEnd(e);r.getBaseModel&&(o=r.mapOffset(o),u=r.mapOffset(u)),s=this.getAnnotationsByType(i,o,u)}var a=this._getTooltipContents(e,s);if(!a)return null;var f={contents:a,anchor:this.getLocation()},l=n.getClientArea();return this.getOverview()==="document"?l.y=n.convert({y:t},"view","document").y:l.y=n.getLocationAtOffset(r.getLineStart(e)).y,n.convert(l,"document","page"),f.x=l.x,f.y=l.y,f.anchor==="right"&&(f.x+=l.width),f},_getTooltipContents:function(e,t){return t},_onAnnotationModelChanged:function(e){function u(e){for(var i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type))continue;var s=e[i].start,o=e[i].end;n.getBaseModel&&(s=n.mapOffset(s,!0),o=n.mapOffset(o,!0)),s!==-1&&o!==-1&&t.redrawLines(n.getLineAtOffset(s),n.getLineAtOffset(Math.max(s,o-1))+1,r)}}var t=this._view;if(!t)return;var n=t.getModel(),r=this,i=n.getLineCount();if(e.textModelChangedEvent){var s=e.textModelChangedEvent.start;n.getBaseModel&&(s=n.mapOffset(s,!0));var o=n.getLineAtOffset(s);t.redrawLines(o,i,r);return}u(e.added),u(e.removed),u(e.changed)},_mergeAnnotation:function(e,t,n,r){return e||(e={}),n===0&&(e.html&&t.html?(t.html!==e.html&&!e._multiple&&this._multiAnnotation&&(e.html=this._multiAnnotation.html),e._multiple=!0):e.html=t.html),e.style=this._mergeStyle(e.style,t.style),e},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.style){e.style||(e.style={});for(n in t.style)e.style[n]||(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)e.attributes[n]||(e.attributes[n]=t.attributes[n])}}return e}},t.AnnotationTypeList.addMixin(i.prototype),s.prototype=new i,s.prototype.getAnnotations=function(e,t){var n=i.prototype.getAnnotations.call(this,e,t),r=this._view.getModel();for(var s=e;s<t;s++){var o=s&1?this._oddStyle:this._evenStyle,u=s;if(r.getBaseModel){var a=r.getLineStart(u);u=r.getBaseModel().getLineAtOffset(r.mapOffset(a))}n[s]||(n[s]={}),n[s].html=u+1+"",n[s].style||(n[s].style=o)}return n},s.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]},s.prototype._onTextModelChanged=function(e){var t=e.start,n=this._view.getModel(),r=n.getBaseModel?n.getBaseModel().getLineCount():n.getLineCount(),i=(r+"").length;if(this._numOfDigits!==i){this._numOfDigits=i;var s=n.getLineAtOffset(t);this._view.redrawLines(s,n.getLineCount(),this)}},o.prototype=new i,u.prototype=new i,u.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};return e=this._mergeStyle(e,this._rulerStyle),e},u.prototype._getTooltipContents=function(t,n){if(n.length===0){var s=this._view.getModel(),o=t;if(s.getBaseModel){var u=s.getLineStart(o);o=s.getBaseModel().getLineAtOffset(s.mapOffset(u))}return r.formatMessage(e.line,o+1)}return i.prototype._getTooltipContents.call(this,t,n)},u.prototype._mergeAnnotation=function(e,t,n,r){if(n!==0)return undefined;var i=e;if(!i){var s=3*r;i={html:"&nbsp;",style:{style:{height:s+"px"}}},i.style=this._mergeStyle(i.style,t.overviewStyle)}return i},a.prototype=new o,a.prototype.onClick=function(e,t){if(e===undefined)return;var r=this._annotationModel;if(!r)return;var i=this._view,s=i.getModel(),o=s.getLineStart(e),u=s.getLineEnd(e,!0);s.getBaseModel&&(o=s.mapOffset(o),u=s.mapOffset(u),s=s.getBaseModel());var a,f=r.getAnnotations(o,u);while(!a&&f.hasNext()){var l=f.next();if(!this.isAnnotationTypeVisible(l.type))continue;a=l}if(a&&s.getLineAtOffset(a.start)===s.getLineAtOffset(o)){var c=n.Tooltip.getTooltip(this._view);c&&c.setTarget(null),a.expanded?a.collapse():a.expand(),this._annotationModel.modifyAnnotation(a)}},a.prototype._getTooltipContents=function(e,t){return t.length===1&&t[0].expanded?null:o.prototype._getTooltipContents.call(this,e,t)},a.prototype._onAnnotationModelChanged=function(e){function a(e){for(i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type))continue;var t=e[i].start;n.getBaseModel&&(t=n.mapOffset(t,!0)),t!==-1&&(u=Math.min(u,n.getLineAtOffset(t)))}}if(e.textModelChangedEvent){o.prototype._onAnnotationModelChanged.call(this,e);return}var t=this._view;if(!t)return;var n=t.getModel(),r=this,i,s=n.getLineCount(),u=s;a(e.added),a(e.removed),a(e.changed);var f=t.getRulers();for(i=0;i<f.length;i++)t.redrawLines(u,s,f[i])},{Ruler:i,AnnotationRuler:o,LineNumberRuler:s,OverviewRuler:u,FoldingRuler:a}}),define("orion/editor/textDND",[],function(){function e(e,t){this._view=e,this._undoStack=t,this._dragSelection=null,this._dropOffset=-1,this._dropText=null;var n=this;this._listener={onDragStart:function(e){n._onDragStart(e)},onDragEnd:function(e){n._onDragEnd(e)},onDragEnter:function(e){n._onDragEnter(e)},onDragOver:function(e){n._onDragOver(e)},onDrop:function(e){n._onDrop(e)},onDestroy:function(e){n._onDestroy(e)}},e.addEventListener("DragStart",this._listener.onDragStart),e.addEventListener("DragEnd",this._listener.onDragEnd),e.addEventListener("DragEnter",this._listener.onDragEnter),e.addEventListener("DragOver",this._listener.onDragOver),e.addEventListener("Drop",this._listener.onDrop),e.addEventListener("Destroy",this._listener.onDestroy)}return e.prototype={destroy:function(){var e=this._view;if(!e)return;e.removeEventListener("DragStart",this._listener.onDragStart),e.removeEventListener("DragEnd",this._listener.onDragEnd),e.removeEventListener("DragEnter",this._listener.onDragEnter),e.removeEventListener("DragOver",this._listener.onDragOver),e.removeEventListener("Drop",this._listener.onDrop),e.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(e){this.destroy()},_onDragStart:function(e){var t=this._view,n=t.getSelection(),r=t.getModel();r.getBaseModel&&(n.start=r.mapOffset(n.start),n.end=r.mapOffset(n.end),r=r.getBaseModel());var i=r.getText(n.start,n.end);i&&(this._dragSelection=n,e.event.dataTransfer.effectAllowed="copyMove",e.event.dataTransfer.setData("Text",i))},_onDragEnd:function(e){var t=this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();var n=e.event.dataTransfer.dropEffect==="move";n&&t.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var r=this._dropText,i=this._dropOffset;n&&(i>=this._dragSelection.end?i-=this._dragSelection.end-this._dragSelection.start:i>=this._dragSelection.start&&(i=this._dragSelection.start)),t.setText(r,i,i),t.setSelection(i,i+r.length),this._dropText=null,this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(e){this._onDragOver(e)},_onDragOver:function(e){var t=e.event.dataTransfer.types;if(t){var n=!this._view.getOptions("readonly");n&&(n=t.contains?t.contains("text/plain"):t.indexOf("text/plain")!==-1),n||(e.event.dataTransfer.dropEffect="none")}},_onDrop:function(e){var t=this._view,n=e.event.dataTransfer.getData("Text");if(n){var r=t.getOffsetAtLocation(e.x,e.y);this._dragSelection?(this._dropOffset=r,this._dropText=n):(t.setText(n,r,r),t.setSelection(r,r+n.length))}}},{TextDND:e}}),define("orion/editor/regex",[],function(){function e(e){return e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")}function t(e){var t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(e);return t?{pattern:t[1],flags:t[2]}:null}return{escape:e,parse:t}}),define("orion/editor/editorFeatures",["i18n!orion/editor/nls/messages","orion/editor/undoStack","orion/keyBinding","orion/editor/rulers","orion/editor/annotations","orion/editor/tooltip","orion/editor/textDND","orion/editor/regex","orion/util"],function(e,t,n,r,i,s,o,u,a){function f(){}function l(){}function c(){}function h(){}function p(){}function d(e){this.editor=e,this._active=!1,this._success=!0,this._ignoreSelection=!1,this._prefix="";var t=this;this._listener={onVerify:function(e){var n=t.editor,r=n.getModel(),i=n.mapOffset(e.start),s=n.mapOffset(e.end),o=r.getText(i,s),a=t._prefix,f=a.match(new RegExp("^"+u.escape(o),"i"));f&&f.length>0&&(a=t._prefix+=e.text,t._success=!0,t._status(),t.find(!0),e.text=null)},onSelection:function(){t._ignoreSelection||t.setActive(!1)}}}function v(e,t,n){this.editor=e,this.undoStack=t,this._incrementalFind=new d(e),this._searcher=n,this._lastEditLocation=null,this.init()}function m(e,t,n,r){this.editor=e,this.undoStack=t,this.contentAssist=n,this.linkedMode=r,this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this)),this.init()}function g(e,t){this.editor=e,this.undoStack=t,this.linkedModeActive=!1,this.linkedModeModel=null,this.linkedModeGroupIndex=0,this.linkedModeListener={onModelChanged:function(e){this._viewEditing||this.cancel(!0)}.bind(this),onModify:function(e){this._viewEditing=!1}.bind(this),onVerify:function(e){this._viewEditing=!0;if(this.ignoreVerify)return;var t=e.start,n=e.text.length,r=e.end-e.start,i=t+r,s=n-r,o=[],u=this.linkedModeModel.groups,a;for(a=0;a<u.length;a++){var f=u[a].positions;for(var l=0;l<f.length;l++)o.push({group:a,position:f[l]})}o.sort(function(e,t){return e.position.offset-t.position.offset});var c,h,p,d=e.start,v=e.end;for(a=0;a<o.length;a++){h=o[a].group,p=o[a].position;if(p.offset<=t&&i<=p.offset+p.length){d-=p.offset,v-=p.offset,c=h;break}}if(c!==undefined){this._compoundChange?this._compoundChange.owner.group!==c&&(this.linkedModeGroupIndex=c,this.endUndo(),this.startUndo()):this.startUndo(),this.ignoreVerify=!0;var m=this.editor.getTextView();for(a=o.length-1;a>=0;a--)h=o[a].group,p=o[a].position,h===c&&m.setText(e.text,p.offset+d,p.offset+v);this.ignoreVerify=!1,e.text=null;var g=0,y;for(a=0;a<o.length;++a)h=o[a].group,p=o[a].position,y===undefined&&this.linkedModeModel.escapePosition<p.offset&&(y=g),h===c?(p.offset+=g,p.length+=s,g+=s):p.offset+=g;y===undefined&&(y=g),this.linkedModeModel.escapePosition+=y,this._updateAnnotations()}else this.cancel()}.bind(this)}}return f.prototype={createUndoStack:function(n){var r=n.getTextView(),i=new t.UndoStack(r,200);return r.setAction("undo",function(){return i.undo(),!0},{name:e.undo}),r.setAction("redo",function(){return i.redo(),!0},{name:e.redo}),i}},l.prototype={createLineNumberRuler:function(e){return new r.LineNumberRuler(e,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}},c.prototype={createFoldingRuler:function(e){return new r.FoldingRuler(e,"left",{styleClass:"ruler folding"})}},h.prototype={createAnnotationModel:function(e){return new i.AnnotationModel(e)},createAnnotationStyler:function(e,t){return new i.AnnotationStyler(e,t)},createAnnotationRulers:function(e){var t=new r.AnnotationRuler(e,"left",{styleClass:"ruler annotations"}),n=new r.OverviewRuler(e,"right",{styleClass:"ruler overview"});return{annotationRuler:t,overviewRuler:n}}},p.prototype={createTextDND:function(e,t){return new o.TextDND(e.getTextView(),t)}},d.prototype={backspace:function(){if(!this.isActive())return!1;var e=this._prefix;return e=this._prefix=e.substring(0,e.length-1),e.length===0?(this._success=!0,this._ignoreSelection=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(!1)},find:function(e){if(!this.isActive())return!1;var t=this._prefix;if(t.length===0)return!1;var n=this.editor,r=n.getModel(),i;e?this._success?i=n.getSelection().start+1:i=0:this._success?i=n.getCaretOffset()-t.length-1:i=r.getCharCount()-1;var s=n.getModel().find({string:t,start:i,reverse:!e,caseInsensitive:t.toLowerCase()===t}).next();return s?(this._success=!0,this._ignoreSelection=!0,n.moveSelection(s.start,s.end),this._ignoreSelection=!1):this._success=!1,this._status(),!0},isActive:function(){return this._active},setActive:function(e){this._active=e,this._prefix="",this._success=!0;var t=this.editor,n=t.getTextView();this.editor.setCaretOffset(this.editor.getCaretOffset()),this._active?(n.addEventListener("Verify",this._listener.onVerify),n.addEventListener("Selection",this._listener.onSelection)):(n.removeEventListener("Verify",this._listener.onVerify),n.removeEventListener("Selection",this._listener.onSelection)),this._status()},_status:function(){if(!this.isActive()){this.editor.reportStatus("");return}var t=a.formatMessage(this._success?e.incrementalFind:e.incrementalFindNotFound,this._prefix);this.editor.reportStatus(t,this._success?"":"error")}},v.prototype={init:function(){var t=this,r=this.editor.getTextView();this._lastEditListener={onModelChanged:function(e){t.editor.isDirty()&&(t._lastEditLocation=e.start+e.addedCharCount)}},r.addEventListener("ModelChanged",this._lastEditListener.onModelChanged),r.setKeyBinding(new n.KeyBinding("k",!0),"findNext"),r.setAction("findNext",function(){if(this._searcher){var e=r.getSelection();return e.start<e.end?this._searcher.findNext(!0,r.getText(e.start,e.end)):this._searcher.findNext(!0),!0}return!1}.bind(this),{name:e.findNext}),r.setKeyBinding(new n.KeyBinding("k",!0,!0),"findPrevious"),r.setAction("findPrevious",function(){if(this._searcher){var e=r.getSelection();return e.start<e.end?this._searcher.findNext(!1,r.getText(e.start,e.end)):this._searcher.findNext(!1),!0}return!1}.bind(this),{name:e.findPrevious}),r.setKeyBinding(new n.KeyBinding("j",!0),"incrementalFind"),r.setAction("incrementalFind",function(){return this._searcher&&this._searcher.visible()?!0:(this._incrementalFind.isActive()?this._incrementalFind.find(!0):this._incrementalFind.setActive(!0),!0)}.bind(this),{name:e.incrementalFindKey}),r.setAction("deletePrevious",function(){return this._incrementalFind.backspace()}.bind(this)),r.setAction("tab",function(){if(r.getOptions("readonly"))return!1;if(!r.getOptions("tabMode"))return;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start),s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end);if(i!==s){var o=[];o.push("");for(var u=i;u<=s;u++)o.push(t.getLine(u,!0));var a=t.getLineStart(i),f=t.getLineEnd(s,!0),l=r.getOptions("tabSize","expandTab"),c=l.expandTab?(new Array(l.tabSize+1)).join(" "):"	";return e.setText(o.join(c),a,f),e.setSelection(a===n.start?n.start:n.start+c.length,n.end+(s-i+1)*c.length),!0}var h=e.getKeyModes();for(var p=0;p<h.length;p++)if(h[p].isActive())return h[p].tab();return!1}.bind(this)),r.setAction("shiftTab",function(){if(r.getOptions("readonly"))return!1;if(!r.getOptions("tabMode"))return;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start),s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),o=r.getOptions("tabSize"),u=(new Array(o+1)).join(" "),a=[],f=0,l=0;for(var c=i;c<=s;c++){var h=t.getLine(c,!0);if(t.getLineStart(c)!==t.getLineEnd(c))if(h.indexOf("	")===0)h=h.substring(1),f++;else{if(h.indexOf(u)!==0)return!0;h=h.substring(o),f+=o}c===i&&(l=f),a.push(h)}var p=t.getLineStart(i),d=t.getLineEnd(s,!0),v=t.getLineStart(s);e.setText(a.join(""),p,d);var m=p===n.start?n.start:n.start-l,g=Math.max(m,n.end-f+(n.end===v+1&&n.start!==n.end?1:0));return e.setSelection(m,g),!0}.bind(this),{name:e.unindentLines}),r.setKeyBinding(new n.KeyBinding(38,!1,!1,!0),"moveLinesUp"),r.setAction("moveLinesUp",function(){if(r.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start);if(i===0)return!0;var s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),o=t.getLineCount(),u=t.getLineStart(i-1),a=t.getLineStart(i),f=t.getLineEnd(s,!0),l=t.getText(a,f),c=0;if(s===o-1){var h=t.getLineEnd(i-1),p=t.getLineEnd(i-1,!0);l+=t.getText(h,p),a=h,c=p-h}return this.startUndo(),e.setText("",a,f),e.setText(l,u,u),e.setSelection(u,u+l.length-c),this.endUndo(),!0}.bind(this),{name:e.moveLinesUp}),r.setKeyBinding(new n.KeyBinding(40,!1,!1,!0),"moveLinesDown"),r.setAction("moveLinesDown",function(){if(r.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start),s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),o=t.getLineCount();if(s===o-1)return!0;var u=t.getLineStart(i),a=t.getLineEnd(s,!0),f=t.getLineEnd(s+1,!0)-(a-u),l,c=0;if(s!==o-2)l=t.getText(u,a);else{var h=t.getLineEnd(s);l=t.getText(h,a)+t.getText(u,h),c+=a-h}return this.startUndo(),e.setText("",u,a),e.setText(l,f,f),e.setSelection(f+c,f+c+l.length),this.endUndo(),!0}.bind(this),{name:e.moveLinesDown}),r.setKeyBinding(new n.KeyBinding(38,!0,!1,!0),"copyLinesUp"),r.setAction("copyLinesUp",function(){if(r.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start),s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),o=t.getLineStart(i),u=t.getLineEnd(s,!0),a=t.getLineCount(),f="",l=t.getText(o,u);s===a-1&&(l+=f=t.getLineDelimiter());var c=o;return e.setText(l,c,c),e.setSelection(c,c+l.length-f.length),!0}.bind(this),{name:e.copyLinesUp}),r.setKeyBinding(new n.KeyBinding(40,!0,!1,!0),"copyLinesDown"),r.setAction("copyLinesDown",function(){if(r.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),i=t.getLineAtOffset(n.start),s=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),o=t.getLineStart(i),u=t.getLineEnd(s,!0),a=t.getLineCount(),f="",l=t.getText(o,u);s===a-1&&(l=(f=t.getLineDelimiter())+l);var c=u;return e.setText(l,c,c),e.setSelection(c+f.length,c+l.length),!0}.bind(this),{name:e.copyLinesDown}),r.setKeyBinding(new n.KeyBinding("d",!0,!1,!1),"deleteLines"),r.setAction("deleteLines",function(){if(r.getOptions("readonly"))return!1;var e=this.editor,t=e.getSelection(),n=e.getModel(),i=n.getLineAtOffset(t.start),s=n.getLineAtOffset(t.end>t.start?t.end-1:t.end),o=n.getLineStart(i),u=n.getLineEnd(s,!0);return e.setText("",o,u),!0}.bind(this),{name:e.deleteLines}),r.setKeyBinding(new n.KeyBinding("l",!0),"gotoLine"),r.setAction("gotoLine",function(){var t=this.editor,n=t.getModel(),r=n.getLineAtOffset(t.getCaretOffset());return r=prompt(e.gotoLinePrompty,r+1),r&&(r=parseInt(r,10),t.onGotoLine(r-1,0)),!0}.bind(this),{name:e.gotoLine}),r.setKeyBinding(new n.KeyBinding(190,!0),"nextAnnotation"),r.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:e.nextAnnotation}),r.setKeyBinding(new n.KeyBinding(188,!0),"previousAnnotation"),r.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:e.prevAnnotation}),r.setKeyBinding(new n.KeyBinding("e",!0,!1,!0,!1),"expand"),r.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:e.expand}),r.setKeyBinding(new n.KeyBinding("c",!0,!1,!0,!1),"collapse"),r.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:e.collapse}),r.setKeyBinding(new n.KeyBinding("e",!0,!0,!0,!1),"expandAll"),r.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:e.expandAll}),r.setKeyBinding(new n.KeyBinding("c",!0,!0,!0,!1),"collapseAll"),r.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:e.collapseAll}),r.setKeyBinding(new n.KeyBinding("q",!a.isMac,!1,!1,a.isMac),"lastEdit"),r.setAction("lastEdit",function(){return typeof this._lastEditLocation=="number"&&this.editor.showSelection(this._lastEditLocation),!0}.bind(this),{name:e.lastEdit})},nextAnnotation:function(e){var t=this.editor,n=t.getAnnotationModel();if(!n)return!0;var r=t.getModel(),o=t.getCaretOffset(),u=n.getAnnotations(e?o:0,e?r.getCharCount():o),a=null;while(u.hasNext()){var f=u.next();if(e){if(f.start<=o)continue}else if(f.start>=o)continue;switch(f.type){case i.AnnotationType.ANNOTATION_ERROR:case i.AnnotationType.ANNOTATION_WARNING:case i.AnnotationType.ANNOTATION_TASK:case i.AnnotationType.ANNOTATION_BOOKMARK:break;default:continue}a=f;if(e)break}if(a){var l=t.getTextView(),c=r.getLineAtOffset(a.start),h=s.Tooltip.getTooltip(l);if(!h)return t.moveSelection(a.start),!0;t.moveSelection(a.start,a.start,function(){h.setTarget({getTooltipInfo:function(){var e=l.convert({x:l.getLocationAtOffset(a.start).x,y:l.getLocationAtOffset(r.getLineStart(c)).y},"document","page");return{contents:[a],x:e.x,y:e.y+Math.floor(l.getLineHeight(c)*1.33)}}},0)})}return!0},expandAnnotation:function(e){var t=this.editor,n=t.getAnnotationModel();if(!n)return!0;var r=t.getModel(),s=t.getCaretOffset(),o=r.getLineAtOffset(s),u=r.getLineStart(o),a=r.getLineEnd(o,!0);r.getBaseModel&&(u=r.mapOffset(u),a=r.mapOffset(a),r=r.getBaseModel());var f,l=n.getAnnotations(u,a);while(!f&&l.hasNext()){var c=l.next();if(c.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;f=c}return f&&e!==f.expanded&&(e?f.expand():(t.setCaretOffset(f.start),f.collapse()),n.modifyAnnotation(f)),!0},expandAnnotations:function(e){var t=this.editor,n=t.getTextView(),r=t.getAnnotationModel();if(!r)return!0;var s=t.getModel(),o,u=r.getAnnotations(0,s.getCharCount());n.setRedraw(!1);while(u.hasNext()){o=u.next();if(o.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;e!==o.expanded&&(e?o.expand():o.collapse(),r.modifyAnnotation(o))}return n.setRedraw(!0),!0},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this._incrementalFind.setActive(!1)},isActive:function(){return this._incrementalFind.isActive()},isStatusActive:function(){return this._incrementalFind.isActive()},lineUp:function(){return this._incrementalFind.find(!1)},lineDown:function(){return this._incrementalFind.find(!0)},enter:function(){return!1}},m.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function r(e,t,n){var r="/*",i="*/",s=e.getLineAtOffset(t),o=e.getLineAtOffset(n),u,a,f,l,c,h,p;for(u=s;u>=0;u--){a=e.getLine(u),f=u===s?t-e.getLineStart(s):a.length,l=a.lastIndexOf(r,f),c=a.lastIndexOf(i,f);if(c>l)break;if(l!==-1){h=e.getLineStart(u)+l;break}}for(u=o;u<e.getLineCount();u++){a=e.getLine(u),f=u===o?n-e.getLineStart(o):0,l=a.indexOf(r,f),c=a.indexOf(i,f);if(l!==-1&&l<c)break;if(c!==-1){p=e.getLineStart(u)+c;break}}return{commentStart:h,commentEnd:p}}var t=this.editor.getTextView();t.setAction("lineStart",function(){var e=this.editor,t=e.getModel(),n=e.getCaretOffset(),r=t.getLineAtOffset(n),i=t.getLineStart(r),s=t.getLine(r),o;for(o=0;o<s.length;o++){var u=s.charCodeAt(o);if(u!==32&&u!==9)break}return o+=i,n!==o?(e.setSelection(o,o),!0):!1}.bind(this)),t.setKeyBinding(new n.KeyBinding(191,!0),"toggleLineComment"),t.setAction("toggleLineComment",function(){if(t.getOptions("readonly"))return!1;var e=this.editor,n=e.getModel(),r=e.getSelection(),i=n.getLineAtOffset(r.start),s=n.getLineAtOffset(r.end>r.start?r.end-1:r.end),o=!0,u=[],a,f;for(var l=i;l<=s;l++){a=n.getLine(l,!0),u.push(a);if(!o||(f=a.indexOf("//"))===-1)o=!1;else if(f!==0){var c;for(c=0;c<f;c++){var h=a.charCodeAt(c);if(h!==32&&h!==9)break}o=c===f}}var p,d,v,m=n.getLineStart(i),g=n.getLineEnd(s,!0);if(o){for(var y=0;y<u.length;y++)a=u[y],f=a.indexOf("//"),u[y]=a.substring(0,f)+a.substring(f+2);p=u.join("");var b=n.getLineStart(s);d=m===r.start?r.start:r.start-2,v=r.end-2*(s-i+1)+(r.end===b+1?2:0)}else u.splice(0,0,""),p=u.join("//"),d=m===r.start?r.start:r.start+2,v=r.end+2*(s-i+1);return e.setText(p,m,g),e.setSelection(d,v),!0}.bind(this),{name:e.toggleLineComment}),t.setKeyBinding(new n.KeyBinding(191,!0,!a.isMac,!1,a.isMac),"addBlockComment"),t.setAction("addBlockComment",function(){if(t.getOptions("readonly"))return!1;var e=this.editor,n=e.getModel(),i=e.getSelection(),s="/*",o="*/",u=new RegExp("/\\*|\\*/","g"),a=r(n,i.start,i.end);if(a.commentStart!==undefined&&a.commentEnd!==undefined)return!0;var f=n.getText(i.start,i.end);if(f.length===0)return!0;var l=f.length;f=f.replace(u,"");var c=f.length;return e.setText(s+f+o,i.start,i.end),e.setSelection(i.start+s.length,i.end+s.length+(c-l)),!0}.bind(this),{name:e.addBlockComment}),t.setKeyBinding(new n.KeyBinding(220,!0,!a.isMac,!1,a.isMac),"removeBlockComment"),t.setAction("removeBlockComment",function(){if(t.getOptions("readonly"))return!1;var e=this.editor,n=e.getModel(),i=e.getSelection(),s="/*",o="*/",u=n.getText(i.start,i.end),a,f,l;for(l=0;l<u.length;l++)if(u.substring(l,l+s.length)===s){a=i.start+l;break}for(;l<u.length;l++)if(u.substring(l,l+o.length)===o){f=i.start+l;break}if(a!==undefined&&f!==undefined)e.setText(n.getText(a+s.length,f),a,f+o.length),e.setSelection(a,f);else{var c=r(n,i.start,i.end);if(c.commentStart===undefined||c.commentEnd===undefined)return!0;var h=n.getText(c.commentStart+s.length,c.commentEnd);e.setText(h,c.commentStart,c.commentEnd+o.length),e.setSelection(i.start-s.length,i.end-o.length)}return!0}.bind(this),{name:e.removeBlockComment})},contentAssistProposalApplied:function(e){var t=e.data.proposal;if(t.positions&&t.positions.length>0&&this.linkedMode){var n=[];for(var r=0;r<t.positions.length;++r)n[r]={positions:[{offset:t.positions[r].offset,length:t.positions[r].length}]};var i={groups:n,escapePosition:t.escapePosition};this.linkedMode.enterLinkedMode(i)}else if(t.groups&&t.groups.length>0&&this.linkedMode)this.linkedMode.enterLinkedMode({groups:t.groups,escapePosition:t.escapePosition});else if(t.escapePosition){var s=this.editor.getTextView();s.setCaretOffset(t.escapePosition)}return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){var e=this.editor.getTextView();if(e.getOptions("readonly"))return!1;var t=this.editor,n=t.getSelection();if(n.start===n.end){var r=t.getModel(),i=r.getLineAtOffset(n.start),s=r.getLine(i,!0),o=r.getLineStart(i),u=0,a=n.start-o,f;while(u<a&&((f=s.charCodeAt(u))===32||f===9))u++;if(u>0){var l=s.substring(0,u);u=a;while(u<s.length&&((f=s.charCodeAt(u++))===32||f===9))n.end++;return t.setText(r.getLineDelimiter()+l,n.start,n.end),!0}}return!1},tab:function(){return!1}},g.prototype={enterLinkedMode:function(t){if(this.linkedModeActive)return;this.linkedModeActive=!0,this.linkedModeModel=t,this.selectLinkedGroup(0);var r=this.editor.getTextView();r.addEventListener("Verify",this.linkedModeListener.onVerify),r.addEventListener("Modify",this.linkedModeListener.onModify),r.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged),r.setKeyBinding(new n.KeyBinding(9),"nextLinkedModePosition"),r.setAction("nextLinkedModePosition",function(){return this.selectLinkedGroup((this.linkedModeGroupIndex+1)%this.linkedModeModel.groups.length),!0}.bind(this)),r.setKeyBinding(new n.KeyBinding(9,!1,!0),"previousLinkedModePosition"),r.setAction("previousLinkedModePosition",function(){return this.selectLinkedGroup(this.linkedModeGroupIndex>0?this.linkedModeGroupIndex-1:this.linkedModeModel.groups.length-1),!0}.bind(this)),this.editor.reportStatus(e.linkedModeEntered,null,!0)},_cloneModel:function(){var e=this.linkedModeModel,t=[],n={escapePosition:e.escapePosition,groups:t},r=e.groups;for(var i=0;i<r.length;i++){var s=[];t.push({positions:s});var o=r[i].positions;for(var u=0;u<o.length;u++)s.push({offset:o[u].offset,length:o[u].length})}return n},startUndo:function(){if(this.undoStack){var e=this;this._compoundChange=this.undoStack.startCompoundChange({startModel:e._cloneModel(),group:e.linkedModeGroupIndex,end:function(){e._compoundChange=null,this.endModel=e._cloneModel()},redo:function(){e.linkedModeActive&&(e.linkedModeModel=this.endModel,e.selectLinkedGroup(0))},undo:function(){e.linkedModeActive&&(e.linkedModeModel=this.startModel,e.selectLinkedGroup(0))}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){return this.cancel(),!0},cancel:function(t){if(!this.linkedModeActive)return;this.linkedModeActive=!1;var r=this.editor.getTextView();r.removeEventListener("Verify",this.linkedModeListener.onVerify),r.removeEventListener("Modify",this.linkedModeListener.onModify),r.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged),r.setKeyBinding(new n.KeyBinding(9),"tab"),r.setKeyBinding(new n.KeyBinding(9,!1,!0),"shiftTab"),t||r.setCaretOffset(this.linkedModeModel.escapePosition,!1),this._compoundChange&&(this.endUndo(),this._compoundChange=null),this._updateAnnotations(),this.editor.reportStatus(e.linkedModeExited,null,!0)},lineUp:function(){return this.cancel(!0),!1},lineDown:function(){return this.cancel(!0),!1},selectLinkedGroup:function(e){this.linkedModeGroupIndex=e;var t=this.linkedModeModel.groups[e],n=t.positions[0],r=this.editor.getTextView();r.setSelection(n.offset,n.offset+n.length),this._updateAnnotations()},_updateAnnotations:function(){var e=this.editor.getAnnotationModel();if(!e)return;var t=[],n=[],r=e.getTextModel(),s=e.getAnnotations(0,r.getCharCount()),o;while(s.hasNext()){o=s.next();switch(o.type){case i.AnnotationType.ANNOTATION_LINKED_GROUP:case i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:t.push(o)}}if(this.linkedModeActive){var u=this.linkedModeModel.groups;for(var a=0;a<u.length;a++){var f=u[a].positions;for(var l=0;l<f.length;l++){var c=f[l],h=i.AnnotationType.ANNOTATION_LINKED_GROUP;a===this.linkedModeGroupIndex&&(l===0?h=i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:h=i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP),o=i.AnnotationType.createAnnotation(h,c.offset,c.offset+c.length),n.push(o)}}}e.replaceAnnotations(t,n)}},{UndoFactory:f,LineNumberRulerFactory:l,FoldingRulerFactory:c,AnnotationFactory:h,TextDNDFactory:p,TextActions:v,SourceCodeActions:m,LinkedMode:g}}),define("orion/webui/splitter",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._tracking=null,this._resizeListeners=[],this._animationDelay=501,this.$node=t.node(e.node);if(!this.$node)throw"no dom node for splitter found";this.$sideNode=t.node(e.sidePanel);if(!this.$sideNode)throw"no dom node for side panel found";this.$mainNode=t.node(e.mainPanel);if(!this.$mainNode)throw"no dom node for main panel found";this._vertical=e.vertical,this._prefix="/orion/splitter/"+(this.$node.id||document.body.id||""),e.toggle&&(this._thumb=document.createElement("div"),this.$node.appendChild(this._thumb),this._thumb.classList.add("splitThumb"),this._thumb.classList.add("splitThumbLayout")),this._initializeFromStoredSettings(),this._closed?(this._closed=!1,this._thumbDown()):this._adjustToSplitPosition(),this.$node.style.visibility="visible",this.$mainNode.style.display="block",this.$sideNode.style.display="block",this.$node.addEventListener("mousedown",this._mouseDown.bind(this),!1),window.addEventListener("mouseup",this._mouseUp.bind(this),!1),window.addEventListener("resize",this._resize.bind(this),!1)},toggleSidePanel:function(){this._thumbDown()},openSidePanel:function(){this._closed||this._thumbDown()},addResizeListener:function(e){this._resizeListeners.push(e)},_initializeFromStoredSettings:function(){this._closed=localStorage.getItem(this._prefix+"/toggleState")==="closed";var e;this._vertical?(e=localStorage.getItem(this._prefix+"/yPosition"),e&&(this._splitTop=parseInt(e,10))):(e=localStorage.getItem(this._prefix+"/xPosition"),e&&(this._splitLeft=parseInt(e,10)))},_adjustToSplitPosition:function(e){var n=t.bounds(this.$node),r=t.bounds(this.$node.parentNode);if(this._vertical){this._splitHeight=n.height;if(e||!this._splitTop)this._splitTop=n.top,localStorage.setItem(this._prefix+"/yPosition",this._splitTop);var i=this._splitTop;this.$node.parentNode.style.position==="relative"&&(i=this._splitTop-r.top),this.$sideNode.style.height=i+"px",this.$sideNode.style.bottom=i-1+"px",this.$sideNode.style.display="block",this.$node.style.top=i+"px",this._resize()}else{this._splitWidth=n.width;if(e||!this._splitLeft)this._splitLeft=n.left,localStorage.setItem(this._prefix+"/xPosition",this._splitLeft);var s=this._splitLeft;this.$node.parentNode.style.position==="relative"&&(s=this._splitLeft-r.left),this.$sideNode.style.width=s+"px",this.$sideNode.style.right=s-1+"px",this.$sideNode.style.display="block",this.$node.style.left=s+"px",this._resize()}},_resize:function(e){e=e||0;var n=t.bounds(this.$node.parentNode),r=t.bounds(this.$node);this._vertical?this.$mainNode.style.height=n.height-(r.top-n.top+r.height)+"px":this.$mainNode.style.width=n.width-(r.left-n.left+r.width)+"px";var i=this;window.setTimeout(function(){i._notifyResizeListeners(i.$mainNode)},e),window.setTimeout(function(){i._notifyResizeListeners(i.$sideNode)},e)},_notifyResizeListeners:function(e){for(var t=0;t<this._resizeListeners.length;t++)this._resizeListeners[t](e)},_thumbDown:function(){this._closed?(this._closed=!1,this._addAnimation(),this._vertical?(this.$sideNode.style.height=this._splitTop+"px",this.$node.style.top=this._splitTop+"px"):(this.$sideNode.style.width=this._splitLeft+"px",this.$node.style.left=this._splitLeft+"px"),this._resize(this._animationDelay),this._removeAnimation()):(this._closed=!0,this._addAnimation(),this._vertical?(this.$sideNode.style.top=0,this.$node.style.top="1px"):(this.$sideNode.style.width=0,this.$node.style.left="1px"),this._resize(this._animationDelay),this._removeAnimation()),localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null)},_removeAnimation:function(){var e=this;window.setTimeout(function(){e.$sideNode.classList.remove("sidePanelLayoutAnimation"),e.$mainNode.classList.remove("mainPanelLayoutAnimation"),e.$node.classList.remove("splitLayoutAnimation"),e._thumb.classList.remove("splitLayoutAnimation")},this._animationDelay)},_addAnimation:function(){this.$sideNode.classList.add("sidePanelLayoutAnimation"),this.$mainNode.classList.add("mainPanelLayoutAnimation"),this.$node.classList.add("splitLayoutAnimation"),this._thumb&&this._thumb.classList.add("splitLayoutAnimation")},_mouseDown:function(e){if(e.target===this._thumb)return t.stop(e),this._thumbDown(e);if(this._tracking)return;this.$node.classList.add("splitTracking"),this.$mainNode.classList.add("panelTracking"),this.$sideNode.classList.add("panelTracking"),this._tracking=this._mouseMove.bind(this),window.addEventListener("mousemove",this._tracking),t.stop(e)},_mouseMove:function(e){if(this._tracking){var n;if(this._vertical){this._splitTop=e.clientY;var r=this._splitTop;this.$node.parentNode.style.position==="relative"&&(n=t.bounds(this.$node.parentNode),r=this._splitTop-n.top),this.$node.style.top=r+"px"}else{this._splitLeft=e.clientX;var i=this._splitLeft;this.$node.parentNode.style.position==="relative"&&(n=t.bounds(this.$node.parentNode),i=this._splitLeft-n.left),this.$node.style.left=i+"px"}this._adjustToSplitPosition(!0),t.stop(e)}},_mouseUp:function(e){this._tracking&&(window.removeEventListener("mousemove",this._tracking),this._tracking=null,this.$node.classList.remove("splitTracking"),this.$mainNode.classList.remove("panelTracking"),this.$sideNode.classList.remove("panelTracking"),t.stop(e))}},n.prototype.constructor=n,{Splitter:n}}),define("text!orion/compare/sideBySideTemplate.html",[],function(){return'<div id="topWidget_id" style="height:100%;width:100%;position:relative">\r\n	<div class="leftPanelLayout ">\r\n		<div class="titleContainer" id="left_title_id"></div>\r\n		<div class="compareEditorParent" id="left_editor_id"></div>\r\n		<div class="statusContainer" id="left_status_id"></div>\r\n	</div>\r\n	<div class="split compareSplitLayout"></div>\r\n	<div class="rightPanelLayout">\r\n		<div class="titleContainer" id="right_title_id"></div>\r\n		<div class="compareEditorParent"  id="right_editor_wrapper_id">\r\n			<div class="canvasContainer">\r\n				<canvas id="diff_canvas_id" class="compareCanvas" width="46" height="3000"></canvas>\r\n			</div>\r\n			<div class="compareEditorParentWithCanvas" id="right_editor_id"></div>\r\n		</div>\r\n		<div class="statusContainer" id="right_status_id"></div>\r\n	</div>\r\n</div>\r\n'}),define("orion/compare/compareUIFactory",["orion/webui/littlelib","orion/webui/splitter","text!orion/compare/sideBySideTemplate.html"],function(e,t,n){var r=r||{};return r.TwoWayCompareUIFactory=function(){function r(e){this._parentDivID=e.parentDivID,this._commandSpanId=e.commandSpanId,this._showTitle=e.showTitle,this._leftTitle=e.leftTitle,this._rightTitle=e.rightTitle,this._showLineStatus=e.showLineStatus}return r.prototype={_init:function(){var t=this._parentDivID+"_";this._topWidgetDiv=e.node("topWidget_id"),this._topWidgetDiv.id=t+"topWidget_id",this._leftEditorParentDiv=e.node("left_editor_id"),this._leftEditorParentDiv.id=t+"left_editor_id",this._rightEditorParentDiv=e.node("right_editor_id"),this._rightEditorParentDiv.id=t+"right_editor_id",this._rightEditorWrapperDiv=e.node("right_editor_wrapper_id"),this._rightEditorWrapperDiv.id=t+"right_editor_wrapper_id",this._leftTitleDiv=e.node("left_title_id"),this._leftTitleDiv.id=t+"left_title_id",this._rightTitleDiv=e.node("right_title_id"),this._rightTitleDiv.id=t+"right_title_id",this._leftStatusDiv=e.node("left_status_id"),this._leftStatusDiv.id=t+"left_status_id",this._rightStatusDiv=e.node("right_status_id"),this._rightStatusDiv.id=t+"right_status_id",this._diffCanvasDiv=e.node("diff_canvas_id"),this._diffCanvasDiv.id=t+"diff_canvas_id",this._splitterId=t+"orion_splitter",this._showTitle||(this._leftEditorParentDiv.style.top="0px",this._rightEditorWrapperDiv.style.top="0px",this._leftTitleDiv.style.height="0px",this._rightTitleDiv.style.height="0px"),this._showLineStatus||(this._leftEditorParentDiv.style.marginBottom="0px",this._rightEditorWrapperDiv.style.marginBottom="0px",this._leftStatusDiv.style.height="0px",this._rightStatusDiv.style.height="0px")},_createSplitter:function(){var n=e.$(".split",this._topWidgetDiv);n.id=this._splitterId;var r=e.$(".leftPanelLayout",this._topWidgetDiv),i=e.$(".rightPanelLayout",this._topWidgetDiv);n&&r&&i&&(this._splitter=new t.Splitter({node:n,sidePanel:r,mainPanel:i}))},buildUI:function(){e.node(this._parentDivID).innerHTML=n,this._init(),this._createSplitter()},destroy:function(){},getSplitter:function(){return this._splitter},isLeftPane:function(t){var n=e.$(".leftPanelLayout",this._topWidgetDiv);return n===t},getEditorParentDiv:function(e){return e?this._leftEditorParentDiv:this._rightEditorParentDiv},getTitleDiv:function(e){return e?this._leftTitleDiv:this._rightTitleDiv},getStatusDiv:function(e){return e?this._leftStatusDiv:this._rightStatusDiv},getCommandSpanId:function(){return this._commandSpanId},getDiffCanvasDiv:function(){return this._diffCanvasDiv}},r}(),r});var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){var t=[];for(var n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}function n(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;"),t}var r=function(e){this.ignoreWhitespace=e};r.prototype={diff:function(t,n){if(n==t)return[{value:n}];if(!n)return[{value:t,removed:!0}];if(!t)return[{value:n,added:!0}];n=this.tokenize(n),t=this.tokenize(t);var r=n.length,i=t.length,s=r+i,o=[{newPos:-1,components:[]}],u=this.extractCommon(o[0],n,t,0);if(o[0].newPos+1>=r&&u+1>=i)return o[0].components;for(var a=1;a<=s;a++)for(var f=-1*a;f<=a;f+=2){var l,c=o[f-1],h=o[f+1];u=(h?h.newPos:0)-f,c&&(o[f-1]=undefined);var p=c&&c.newPos+1<r,d=h&&0<=u&&u<i;if(!p&&!d){o[f]=undefined;continue}!p||d&&c.newPos<h.newPos?(l=e(h),this.pushComponent(l.components,t[u],undefined,!0)):(l=e(c),l.newPos++,this.pushComponent(l.components,n[l.newPos],!0,undefined));var u=this.extractCommon(l,n,t,f);if(l.newPos+1>=r&&u+1>=i)return l.components;o[f]=l}},pushComponent:function(e,t,n,r){var i=e[e.length-1];i&&i.added===n&&i.removed===r?e[e.length-1]={value:this.join(i.value,t),added:n,removed:r}:e.push({value:t,added:n,removed:r})},extractCommon:function(e,t,n,r){var i=t.length,s=n.length,o=e.newPos,u=o-r;while(o+1<i&&u+1<s&&this.equals(t[o+1],n[u+1]))o++,u++,this.pushComponent(e.components,t[o],undefined,undefined);return e.newPos=o,u},equals:function(e,t){var n=/\S/;return this.ignoreWhitespace&&!n.test(e)&&!n.test(t)?!0:e==t},join:function(e,t){return e+t},tokenize:function(e){return e}};var i=new r,s=new r(!1);s.tokenize=function(e){return t(e.split(/(\s+|\b)/))};var o=new r(!0);o.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))};var u=new r;return u.tokenize=function(e){return e.split(/^/m)},{diffChars:function(e,t){return i.diff(e,t)},diffWords:function(e,t){return s.diff(e,t)},diffLines:function(e,t){return u.diff(e,t)},diffCss:function(e,t){return o.diff(e,t)},createPatch:function(e,t,n,r,i){var s=[];s.push("Index: "+e),s.push("==================================================================="),s.push("--- "+e+"	"+r),s.push("+++ "+e+"	"+i);var o=u.diff(t,n);o.push({value:"",lines:[]});var a=0,f=0,l=[],c=1,h=1;for(var p=0;p<o.length;p++){var d=o[p],v=d.lines||d.value.replace(/\n$/,"").split("\n");d.lines=v;if(d.added||d.removed){if(!a){var m=o[p-1];a=c,f=h,m&&(l.push.apply(l,m.lines.slice(-4).map(function(e){return" "+e})),a-=4,f-=4)}l.push.apply(l,v.map(function(e){return(d.added?"+":"-")+e})),d.added?h+=v.length:c+=v.length}else{if(a)if(v.length<=8&&p<o.length-1)l.push.apply(l,v.map(function(e){return" "+e}));else{var g=Math.min(v.length,4);s.push("@@ -"+a+","+(c-a+g)+" +"+f+","+(h-f+g)+" @@"),s.push.apply(s,l),s.push.apply(s,v.slice(0,g).map(function(e){return" "+e})),a=0,f=0,l=[]}c+=v.length,h+=v.length}}return o.length>1&&!/\n$/.test(o[o.length-2].value)&&s.push("\\ No newline at end of file\n"),s.join("\n")},convertChangesToXML:function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];i.added?t.push("<ins>"):i.removed&&t.push("<del>"),t.push(n(i.value)),i.added?t.push("</ins>"):i.removed&&t.push("</del>")}return t.join("")}}}();typeof module!="undefined"&&(module.exports=JsDiff),typeof define=="function"&&define.amd&&define("jsdiff/diff",[],function(){return JsDiff}),define("orion/compare/jsdiffAdapter",["jsdiff/diff"],function(e){var t=t||{};return t.JSDiffAdapter=function(){function t(){}return t.prototype={adapt:function(t,n,r){r||(r="\n");var i=t.split(r),s=n.split(r),o=i[i.length-1]==="",u=s[s.length-1]==="",a=e.diffLines(t,n),f=[],l=[],c=0,h=0,p=-1,d=0,v=!0;for(var m=0;m<a.length;m++){var g=a[m],y=g.lines||g.value.split(r),b=y.length,w=0;y.length>1&&y[y.length-1]===""&&b--,b>1&&!v&&y[0]===""&&(b--,w++),g.lines=y;if(!g.added&&!g.removed){if(c||h)f.push([c,h,p]),c=0,h=0,p=-1,d+=h;f.push([b,b,0]),d+=b}else if(g.added){p===-1&&(p=l.length+1),c+=b;for(var E=w;E<b+w;E++)l.push(g.lines[E])}else h+=b;v=!1,y.length>1&&y[y.length-1]===""&&(v=!0)}if(c||h)f.push([c,h,p]),d+=h;if(d<i.length&&i.length>1){var S=f[f.length-1];S[2]===0?(S[0]+=1,S[1]+=1):S[2]===-1?f.push([1,1,0]):o===u?f.push([1,1,0]):(u&&(S[0]+=1),o&&(S[1]+=1))}return{mapper:f,changContents:{array:l,index:0}}},adaptCharDiff:function(t,n,r){var i=r?e.diffWords(t,n):e.diffChars(t,n),s=[],o=0,u=0,a=0,f=0;for(var l=0;l<i.length;l++){var c=i[l];if(!c.added&&!c.removed){if(a>0||f>0)s.push([u,u+a,o,o+f]),u+=a,o+=f,a=0,f=0;u+=c.value.length,o+=c.value.length}else c.added?a+=c.value.length:f+=c.value.length}return(a>0||f>0)&&s.push([u,u+a,o,o+f]),s}},t}(),t}),define("orion/treeModelIterator",[],function(){var e={};return e.TreeModelIterator=function(){function e(e,t){this.firstLevelChildren=e,this.reset(),this._init(t)}return e.prototype={_init:function(e){if(!e)return;this.isExpanded=e.isExpanded,this.isExpandable=e.isExpandable,this.forceExpandFunc=e.forceExpandFunc},topLevel:function(e){return e.parent?e.parent===this.root:!0},_expanded:function(e){if(!e)return!0;var t=e.children&&e.children.length>0;return this.isExpanded&&t&&(t=this.isExpanded(e)),t},_expandable:function(e){return e?this.isExpandable?this.isExpandable(e):!1:!0},_diveIn:function(e){return this._expanded(e)?(this.setCursor(e.children[0]),this.cursor()):null},_drillToLast:function(e){return this._expanded(e)?this._drillToLast(e.children[e.children.length-1]):e},_forward:function(e){if(!this._cursor)return null;var t=this._diveIn(this._cursor);if(!t){if(e&&this._expandable(this._cursor)&&this.forceExpandFunc){var n=this;return this.forceExpandFunc(this._cursor,"first",function(e){e&&n.setCursor(e)})}t=this._findSibling(this._cursor,!0),t&&this.setCursor(t)}return t},_backward:function(e){if(!this._cursor)return null;var t=this._findSibling(this._cursor,!1);t&&t!==this._cursor.parent&&(t=this._drillToLast(t));if(e&&t&&this._expandable(t)&&this.forceExpandFunc&&t!==this._cursor.parent){var n=this;return this.forceExpandFunc(t,"last",function(e){e&&n.setCursor(e)})}return t&&this.setCursor(t),t},_findSibling:function(e,t){var n=this.topLevel(e),r=n?this.firstLevelChildren:e.parent.children;for(var i=0;i<r.length;i++)if(r[i]===e)return i===0&&!t?n?null:e.parent:i===r.length-1&&t?n?null:this._findSibling(e.parent,t):t?r[i+1]:r[i-1];return null},_inParentChain:function(e,t){var n=e.parent;while(n){if(n===t)return!0;n=n.parent}return!1},_getTopLevelParent:function(e){if(this.topLevel(e))return e;var t=e.parent;while(t){if(this.topLevel(t))return t;t=t.parent}return null},_onCollapse:function(e){return this._expanded(e.parent)?e:this._onCollapse(e.parent)},_scan:function(e,t,n){this.setCursor(t);var r=[];r.push(t);for(;;){if(!this.iterate(e))break;r.push(this.cursor());if(n===this.cursor())return r}return r=[],null},setCursor:function(e){this._prevCursor=this._cursor,this._cursor=e},setTree:function(e){this.firstLevelChildren=e,this.firstLevelChildren.length>0&&(this.root=this.firstLevelChildren[0].parent)},scan:function(e,t){var n=this.cursor(),r=this._scan(!0,e,t);return r||(r=this._scan(!1,e,t)),this.setCursor(n),r},iterate:function(e,t){return e?this._forward(t):this._backward(t)},iterateOnTop:function(e,t){var n=this._findSibling(this._getTopLevelParent(this.cursor()),e);n?this.setCursor(n):t&&this.firstLevelChildren.length>0&&this.setCursor(e?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])},collapse:function(e){return this._cursor?this._inParentChain(this._cursor,e)?(this.setCursor(e),this._cursor):null:null},reset:function(){this._cursor=null,this._prevCursor=null,this.root=null,this.firstLevelChildren.length>0&&(this._cursor=this.firstLevelChildren[0],this.root=this.firstLevelChildren[0].parent)},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}},e}(),e}),define("orion/compare/diffTreeNavigator",["orion/treeModelIterator","orion/compare/compareUtils","orion/editor/annotations","orion/compare/jsdiffAdapter"],function(e,t,n,r){var i={},s={};return i.DiffTreeNavigator=function(){function i(e,t,n,r,i,s){this._root={type:"root",children:[]},this._initialized=!1,this.initAll(e,t,n,r,i,s)}s.ANNO_DIFF_ADDED_BLOCK="orion.annotation.diff.addedBlock",s.ANNO_DIFF_CURRENT_ADDED_BLOCK="orion.annotation.diff.currentAddedBlock",s.ANNO_DIFF_DELETED_BLOCK="orion.annotation.diff.deletedBlock",s.ANNO_DIFF_CURRENT_DELETED_BLOCK="orion.annotation.diff.currentDeletedBlock",s.ANNO_DIFF_BLOCK_TOPONLY="orion.annotation.diff.blockTop",s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY="orion.annotation.diff.currentBlockTop",s.ANNO_DIFF_BLOCK_CONFLICT="orion.annotation.diff.blockConflict",s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT="orion.annotation.diff.currentBlockConflict",s.ANNO_DIFF_ADDED_WORD="orion.annotation.diff.addedWord",s.ANNO_DIFF_CURRENT_ADDED_WORD="orion.annotation.diff.currentAddedWord",s.ANNO_DIFF_DELETED_WORD="orion.annotation.diff.deletedWord",s.ANNO_DIFF_CURRENT_DELETED_WORD="orion.annotation.diff.currentDeletedWord",s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT="orion.annotation.diff.emptyDeletedWordLeft",s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT="orion.annotation.diff.emptyDeletedWordRight",s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT="orion.annotation.diff.emptyAddedWordLeft",s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT="orion.annotation.diff.emptyAddedWordRight",n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine addedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentAddedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine deletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentDeletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_WORD,{title:"word added",html:"",rangeStyle:{styleClass:"annotationRange addedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentAddedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_WORD,{title:"word deleted",html:"",rangeStyle:{styleClass:"annotationRange deletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentDeletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffRight"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffRight"}});var o=5e3;return i.prototype={initAll:function(e,t,n,r,i,s,o){e?this._charOrWordDiff=e:this._charOrWordDiff="word",t&&(this._initialized=!0),this.editorWrapper=[{editor:t,diffFeeder:r},{editor:n,diffFeeder:i}],this._curveRuler=o,this._overviewRuler=s,this._overviewRuler&&this._overviewRuler.setDiffNavigator(this)},initMapper:function(e){if(e)for(var t=0;t<this.editorWrapper.length;t++)this.editorWrapper[t].diffFeeder.init(this.editorWrapper[t].editor.getTextView().getModel(),e)},destroy:function(){this.initAll(this._charOrWordDiff)},renderAnnotations:function(){var t;for(t=0;t<this.editorWrapper.length;t++){this.editorWrapper[t].annoTypes=[],this.editorWrapper[t].diffFeeder.getBlockAnnoTypes(this.editorWrapper[t].annoTypes),this.editorWrapper[t].diffFeeder.getWordAnnoTypes(this.editorWrapper[t].annoTypes);for(var n=0;n<this.editorWrapper[t].annoTypes.length;n++)this.editorWrapper[t].annoTypes[n].current&&this.editorWrapper[t].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[t].annoTypes[n].current),this.editorWrapper[t].annoTypes[n].normal&&this.editorWrapper[t].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[t].annoTypes[n].normal)}this._root.children=[];var i=this.editorWrapper[0].diffFeeder.getDiffBlocks();if(!i||i.length===0){this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]),this.replaceAllAnnotations(!0,0,"block",!0,[]),this.replaceAllAnnotations(!0,1,"block",!0,[]),this.replaceAllAnnotations(!0,0,"word",!0,[]),this.replaceAllAnnotations(!0,1,"word",!0,[]);return}var s=new r.JSDiffAdapter;for(t=0;t<i.length;t++){var o=this.generatePairBlockAnnotations(this._root,t);this._root.children.push(o);var u=this.generatePairWordAnnotations(o,t,s);u&&(o.children=u)}this.replaceAllAnnotations(!1,0,"block",!0),this.replaceAllAnnotations(!1,1,"block",!0),this.replaceAllAnnotations(!1,0,"word",!0),this.replaceAllAnnotations(!1,1,"word",!0),this.iterator=new e.TreeModelIterator(this._root.children)},replaceAllAnnotations:function(e,t,n,r,i){if(!this.editorWrapper[t].annoTypes)return;for(var s=0;s<this.editorWrapper[t].annoTypes.length;s++)this.editorWrapper[t].annoTypes[s].type===n&&this.replaceDiffAnnotations(this.editorWrapper[t].editor,i?i:this.editorWrapper[t].annoTypes[s].list,r?this.editorWrapper[t].annoTypes[s].normal:this.editorWrapper[t].annoTypes[s].current,e)},getMapper:function(){return this.editorWrapper[0].diffFeeder.getMapper()},getFeeder:function(e){return e?this.editorWrapper[1].diffFeeder:this.editorWrapper[0].diffFeeder},iterateOnBlock:function(e,t){if(!this.iterator)return;this.iterator.iterateOnTop(e,t),this.updateCurrentAnnotation(!0)},iterateOnChange:function(e){if(!this.iterator)return null;var t=this.iterator.iterate(e);if(t){var n=this.iterator.cursor();n.type==="block"&&n.children&&n.children.length>0&&this.iterator.iterate(e),this.updateCurrentAnnotation(!0)}return t},gotoBlock:function(e,t){if(!this.iterator)return;if(e<0||e>=this._root.children.length||this._root.children.length===0)e=0;t!==undefined&&t>=0&&this._root.children[e].children&&t<this._root.children[e].children.length?this.iterator.setCursor(this._root.children[e].children[t]):this.iterator.setCursor(this._root.children[e]),this.updateCurrentAnnotation(!1),this._positionDiffBlock()},_hitDiffAnnotation:function(e,t,n){if(n!==this.editorWrapper[e].editor.getTextView())return;for(var r=0;r<this._root.children.length;r++){var i=this._root.children[r],s=e===0?i.oldA:i.newA;if(t>=s.start&&t<=s.end){var o=i;if(i.children&&i.children.length>0)for(var u=0;u<i.children.length;u++){var a=i.children[u],f=e===0?a.oldA:a.newA;if(t>=f.start&&t<=f.end){o=a;break}}return o}}return null},gotoChange:function(e,t){for(var n=0;n<this.editorWrapper.length;n++){var r=this._hitDiffAnnotation(n,e,t);if(r)return this.iterator.setCursor(r),this.updateCurrentAnnotation(!1,t),!0}return!1},getCurrentBlockIndex:function(){if(!this.iterator)return-1;var e=this.iterator.cursor();return e?e.type==="block"?e.index:e.parent.index:-1},getCurrentPosition:function(){if(!this.iterator)return{};var e=this.iterator.cursor();return e.type==="block"?{block:e.index+1}:{block:e.parent.index+1,change:e.index+1}},getCurrentMapperIndex:function(){var e=this.getCurrentBlockIndex();e<0&&(e=0);var t=this.getFeeder().getDiffBlocks();return!t||t.length===0?-1:(e>t.length-1&&(e=0),t[e][1])},replaceDiffAnnotations:function(e,t,n,r){if(!t||!n)return;var i=e.getAnnotationModel();if(!i)return;var s=i.getAnnotations(0,i.getTextModel().getCharCount()),o=[];while(r&&s.hasNext()){var u=s.next();u.type===n&&o.push(u)}i.replaceAnnotations(o,t)},updateCurrentAnnotation:function(e,t){this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]);if(!this.iterator)return;var r=this.iterator.cursor();if(!r)return;var i,s,o={start:r.oldA.start,end:r.oldA.end},u={start:r.newA.start,end:r.newA.end};r.type==="word"?(i=this.editorWrapper[0].diffFeeder.getCurrentWordAnnoType(o,this.editorWrapper[0].editor.getTextView().getModel()),s=this.editorWrapper[1].diffFeeder.getCurrentWordAnnoType(u,this.editorWrapper[1].editor.getTextView().getModel())):(i=this.editorWrapper[0].diffFeeder.getCurrentBlockAnnoType(r.index),s=this.editorWrapper[1].diffFeeder.getCurrentBlockAnnoType(r.index)),i&&this.replaceDiffAnnotations(this.editorWrapper[0].editor,[new(n.AnnotationType.getType(i.current))(o.start,o.end)],i,!0),s&&this.replaceDiffAnnotations(this.editorWrapper[1].editor,[new(n.AnnotationType.getType(s.current))(u.start,u.end)],s,!0),e?(this.autoSelecting=!0,this.editorWrapper[0].editor.setSelection(r.oldA.start,r.oldA.end,!0),this.editorWrapper[1].editor.setSelection(r.newA.start,r.newA.end,!0),this.autoSelecting=!1):t&&(this.autoSelecting=!0,t!==this.editorWrapper[0].editor.getTextView()&&this.editorWrapper[0].editor.setSelection(r.oldA.start,r.oldA.end,!0),t!==this.editorWrapper[1].editor.getTextView()&&this.editorWrapper[1].editor.setSelection(r.newA.start,r.newA.end,!0),this.autoSelecting=!1)},generatePairBlockAnnotations:function(e,t){var n=this.generateBlockDiffAnnotations(0,t),r=this.generateBlockDiffAnnotations(1,t);return{parent:e,index:t,type:"block",oldA:n,newA:r}},generatePairWordAnnotations:function(e,t,n){var r=this.editorWrapper[0].diffFeeder.getTextOnBlock(t),i=this.editorWrapper[1].diffFeeder.getTextOnBlock(t),s=null,u=0,a=0;if(!(r&&i&&r.text&&i.text&&r.text.length<=o&&i.text.length<=o))return null;s=n.adaptCharDiff(r.text,i.text,this._charOrWordDiff==="word"),a=i.start,u=r.start;var f=[],l=[];this.generateWordDiffAnnotations(0,f,u,s,2,3),this.generateWordDiffAnnotations(1,l,a,s,0,1);var c=[];for(var h=0;h<f.length;h++)c.push({parent:e,index:h,type:"word",oldA:f[h],newA:l[h]});return c},getAnnoModelList:function(e,t,n){for(var r=0;r<this.editorWrapper[e].annoTypes.length;r++)if(this.editorWrapper[e].annoTypes[r].type===t&&this.editorWrapper[e].annoTypes[r].normal===n)return this.editorWrapper[e].annoTypes[r].list;return null},generateBlockDiffAnnotations:function(e,t){var r=this.editorWrapper[e].diffFeeder.getCurrentBlockAnnoType(t),i=this.getAnnoModelList(e,"block",r.normal),s=this.editorWrapper[e].diffFeeder.getCharRange(t),o=n.AnnotationType.createAnnotation(r.normal,s.start,s.end);return i&&i.push(o),o},generateWordDiffAnnotations:function(e,t,r,i,s,o){if(i){var u=this.editorWrapper[e].diffFeeder.getCurrentWordAnnoType({start:-1,end:-1}),a=this.getAnnoModelList(e,"word",u.normal);for(var f=0;f<i.length;f++){var l=i[f][s]+r,c=i[f][o]+r,h=n.AnnotationType.createAnnotation(u.normal,l,c);a.push(h),t.push(h)}}},_updateOverviewRuler:function(){if(this._overviewRuler){var e=this.editorWrapper[0].editor.getTextView().getTopIndex();this.editorWrapper[0].editor.getTextView().redrawLines(e,e+1,this._overviewRuler)}},_updateCurveRuler:function(){this._curveRuler&&this._curveRuler.render()},_setTextViewPosition:function(e,t){var n=e.getLineHeight(),r=e.getClientArea(),i=Math.floor(r.height/n/3);e.setTopIndex(t-i>0?t-i:0)},_positionDiffBlock:function(){var e=this.getCurrentBlockIndex();e<0&&(e=0);var n=this.getFeeder().getDiffBlocks();if(n.length===0)return;this._setTextViewPosition(this.editorWrapper[0].editor.getTextView(),n[e][0]);if(this.editorWrapper[0].editor!==this.editorWrapper[1].editor){var r=t.lookUpLineIndex(this.getMapper(),0,n[e][1]);this._setTextViewPosition(this.editorWrapper[1].editor.getTextView(),r)}this._updateOverviewRuler(),this._updateCurveRuler()},matchPositionFromOverview:function(e){if(!this._initialized)return;var n;e<0?n=0:n=t.getAnnotationIndex(this.getFeeder().getDiffBlocks(),e),this.gotoBlock(n)},gotoDiff:function(e,t){this.gotoChange(e,t)&&(this._updateOverviewRuler(),this._updateCurveRuler())},nextDiff:function(){this.iterateOnBlock(!0,!0),this._positionDiffBlock()},prevDiff:function(){this.iterateOnBlock(!1,!0),this._positionDiffBlock()},nextChange:function(){var e=this.iterateOnChange(!0);return this._positionDiffBlock(),e},prevChange:function(){this.iterateOnChange(!1),this._positionDiffBlock()}},i}(),i.DiffBlockFeeder=function(){function e(){}return e.prototype={getWordAnnoTypes:function(e){this._mapperColumnIndex===0?e.push({type:"word",current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD,list:[]}):e.push({type:"word",current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD,list:[]}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT})},getCurrentWordAnnoType:function(e,t){return e.start===e.end&&t?this._mapperColumnIndex===0?{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_ADDED_WORD}:{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_DELETED_WORD}:this._mapperColumnIndex===0?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:{current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD}},_repositionEmptyWord:function(e,t){var n=t.getLineAtOffset(e.start),r=t.getLineStart(n),i=t.getLineEnd(n);if(r!==i)return e.start===i?(e.start--,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT):(e.end++,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT);if(n>0){n--,r=t.getLineStart(n),i=t.getLineEnd(n);if(r!==i)return e.start=i-1,e.end=i,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}return this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT},getMapper:function(){return this._mapper},getDiffBlocks:function(){return this._diffBlocks},getDiffBlockH:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return-1;var t=this._diffBlocks[e][1];return t===-1?0:this._mapper[t][this._mapperColumnIndex]},getOverviewLineCount:function(){return this._textModel.getLineCount()},getLineNumber:function(e){return e},getCharRange:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var t=this._diffBlocks[e][1],n=this._diffBlocks[e][0],r=n+this._mapper[t][this._mapperColumnIndex]-1,i=this._textModel.getLineStart(n);if(r<n)return{start:i,end:i};var s=this._textModel.getLineEnd(r,!0);return{start:i,end:s}},getTextOnBlock:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var t=this._diffBlocks[e][1];this._mapper[t][0]===0||this._mapper[t][1]===0||this._mapper[t][2]===0;var n=this.getCharRange(e);return{start:n.start,text:this._textModel.getText(n.start,n.end)}},isMapperEmpty:function(){return this._mapper.length===0}},e}(),i.TwoWayDiffBlockFeeder=function(){function e(e,t,n){this._mapperColumnIndex=n,this.init(e,t)}return e.prototype=new i.DiffBlockFeeder,e.prototype.init=function(e,t){this._textModel=e,this._diffBlocks=undefined;if(t){this._mapper=t,this._diffBlocks=[];var n=0;for(var r=0;r<this._mapper.length;r++)this._mapper[r][2]!==0&&this._diffBlocks.push([n,r]),n+=this._mapper[r][this._mapperColumnIndex]}},e.prototype.getBlockAnnoTypes=function(e){this._mapperColumnIndex===0?e.push({type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}):e.push({type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||this._diffBlocks.length===0||this._diffBlocks.length<=e)return null;var n=this._diffBlocks[e][1];return this._mapper[n][this._mapperColumnIndex]===0?{normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY}:t.isMapperConflict(this.getMapper(),n)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._mapperColumnIndex===0?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e}(),i.inlineDiffBlockFeeder=function(){function e(e,t){this._mapperColumnIndex=t,this.init(e)}return e.prototype=new i.DiffBlockFeeder,e.prototype.setModel=function(e){this._textModel=e},e.prototype.init=function(e){this._diffBlocks=undefined;if(e){this._mapper=e,this._diffBlocks=[],this._gapBlocks=[];var t=0,n=0;for(var r=0;r<this._mapper.length;r++){if(this._mapper[r][2]!==0){if(this._mapperColumnIndex===0){var i=t+this._mapper[r][1];this._diffBlocks.push([i,r]),this._gapBlocks.push([i,i+this._mapper[r][0],n])}else this._diffBlocks.push([t,r]),this._gapBlocks.push([t,t+this._mapper[r][1],n]);t+=this._mapper[r][0]+this._mapper[r][1]}else this._gapBlocks.push([t,t+this._mapper[r][this._mapperColumnIndex],n]),t+=this._mapper[r][this._mapperColumnIndex];n+=this._mapper[r][this._mapperColumnIndex]}}},e.prototype.getBlockAnnoTypes=function(e){this._mapperColumnIndex===0?e.push({type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}):e.push({type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var n=this._diffBlocks[e][1];return this._mapper[n][this._mapperColumnIndex]===0?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:t.isMapperConflict(this.getMapper(),n)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._mapperColumnIndex===0?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e.prototype.getDiffBlockH=function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return-1;var t=this._diffBlocks[e][1];return this._mapper[t][0]+this._mapper[t][1]},e.prototype.getLineNumber=function(e){for(var t=0;t<this._gapBlocks.length;t++)if(this._gapBlocks[t][0]!==this._gapBlocks[t][1]&&e>=this._gapBlocks[t][0]&&e<this._gapBlocks[t][1]){var n=e-this._gapBlocks[t][0];return n+this._gapBlocks[t][2]}return-1},e}(),i}),define("orion/compare/compareView",["i18n!orion/compare/nls/messages","orion/Deferred","orion/webui/littlelib","orion/compare/diffParser","orion/compare/compareRulers","orion/editor/editor","orion/editor/editorFeatures","orion/keyBinding","orion/editor/textView","orion/compare/compareUIFactory","orion/compare/compareUtils","orion/compare/jsdiffAdapter","orion/compare/diffTreeNavigator"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m={};return m.CompareView=function(){function e(){this._diffParser=new r.DiffParser}return e.prototype={_clearOptions:function(){this.options={},this.options.blockNumber=1,this.options.changeNumber=0},_getLineDelim:function(e,t){var n="\n";return n},_generateMapper:function(e,t,n,r,i){var s=this._getLineDelim(e,n);this._diffParser.setLineDelim(s);if(this.options.mapper&&this.options.toggler)return{delim:s,mapper:this.options.mapper,output:this.options.newFile.Content,diffArray:this.options.diffArray};if(typeof t=="string"&&typeof e=="string"){var o=new c.JSDiffAdapter,u=o.adapt(e,t,s);return this.options.toggler&&(this.options.mapper=u.mapper,this.options.newFile.Content=t,this.options.diffArray=u.changContents),{delim:s,mapper:u.mapper,output:t,diffArray:u.changContents}}var a=this._diffParser.parse(e,n,r,i),f=this._diffParser.getDiffArray();return this.options.toggler&&(this.options.mapper=a.mapper,this.options.newFile.Content=a.outPutFile,this.options.diffArray=f),{delim:s,mapper:a.mapper,output:a.outPutFile,diffArray:f}},_initSyntaxHighlighter:function(e){this._syntaxHighlighters=null;if(this.options.highlighters&&this.options.highlighters.length>0){if(e.length<1||e.length>2)return;this._syntaxHighlighters=[{highlighter:this.options.highlighters[0],target:e[0]}],e.length===2&&this.options.highlighters.length===2&&this._syntaxHighlighters.push({highlighter:this.options.highlighters[1],target:e[1]})}},_highlightSyntax:function(){if(this._syntaxHighlighters){var e=[];this._syntaxHighlighters.forEach(function(t){e.push(t.highlighter.highlight(t.target.fileName,t.target.contentType,t.target.editor))}.bind(this)),t.all(e,function(e){return{_error:e}}).then(function(e){this._diffNavigator.renderAnnotations(),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}.bind(this))}else window.setTimeout(function(){this._diffNavigator.renderAnnotations(),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}.bind(this),50)},setOptions:function(e,t){t&&this._clearOptions(),this.options||(this.options={}),e&&Object.keys(e).forEach(function(t){this.options[t]=e[t]}.bind(this))},getOptions:function(){return this.options},getCurrentDiffPos:function(){return this._diffNavigator.getCurrentPosition()},initDiffNav:function(){this._diffNavigator.gotoBlock(0,0)},nextDiff:function(){this._diffNavigator.nextDiff()},prevDiff:function(){this._diffNavigator.prevDiff()},nextChange:function(){return this._diffNavigator.nextChange()},prevChange:function(){this._diffNavigator.prevChange()},getWidget:function(){return this},startup:function(){this.initEditors(),this.refresh(!0)},initEditors:function(e){}},e}(),m.TwoWayCompareView=function(){function t(e){this.setOptions(e,!0),this._diffNavigator=new h.DiffTreeNavigator("word"),this.type="twoWay",this._uiFactory=this.options.uiFactory,this._uiFactory||(this._uiFactory=new f.TwoWayCompareUIFactory({parentDivID:this.options.parentDivId,showTitle:this.options.showTitle?this.options.showTitle:!1,showLineStatus:this.options.showLineStatus?this.options.showLineStatus:!1}),this._uiFactory.buildUI()),this._viewLoadedCounter=0,this.options.commandProvider&&this.options.commandProvider.initCommands(this),this._curveRuler=new i.CompareCurveRuler(this._uiFactory.getDiffCanvasDiv())}return t.prototype=new m.CompareView,t.prototype.initEditors=function(t){this._editors=[],this._editors.push(this._createEditor(t,this._uiFactory.getEditorParentDiv(!1),this._uiFactory.getStatusDiv(!1),this.options.oldFile)),this._editors.push(this._createEditor(t,this._uiFactory.getEditorParentDiv(!0),this._uiFactory.getStatusDiv(!0),this.options.newFile,!0)),this._overviewRuler=new i.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e,t){this._diffNavigator.matchPositionFromOverview(e)}.bind(this)),window.onbeforeunload=function(){if(this._editors){var t=this._editors.some(function(e){return e.isDirty()});if(t)return e["There are unsaved changes."]}}.bind(this)},t.prototype.getEditors=function(){return this._editors},t.prototype.gotoDiff=function(e,t,n){var r=n?this._editors[1].getTextView():this._editors[0].getTextView(),i=r.getModel().getLineStart(e)+t;this._diffNavigator.gotoDiff(i,r)},t.prototype.copyToLeft=function(){this._curveRuler.copyTo(!0)},t.prototype.copyToRight=function(){this._curveRuler.copyTo(!1)},t.prototype.resizeEditors=function(){this._editors.forEach(function(e){e.getTextView().resize()})},t.prototype.getSplitter=function(){return this._uiFactory.getSplitter()},t.prototype._createEditor=function(t,n,r,i,u){var f=typeof i.readonly=="undefined"?!0:i.readonly,l=function(){var e=new a.TextView({parent:n,readonly:f,tabSize:4});this._viewLoadedCounter++,this._viewLoadedCounter===2&&this._diffNavigator.matchPositionFromOverview(-1),this.onLoad&&this.onLoad();var t=this.getSplitter();return t&&t.addResizeListener(function(t){if(t){var n=!1;this._uiFactory.isLeftPane(t)?n=u:n=!u,n&&e.resize()}}.bind(this)),e}.bind(this),c=i.keyBindingFactory;c||(c=function(e,t,n,r){var i=new o.TextActions(e,n);t.push(i);var s=new o.SourceCodeActions(e,n,r);t.push(s)});var h=null;if(r){var p="",d="";h=function(t,n){if(!r)return;n?d=e["ERROR: "]+t:d=t,r.textContent=p+d}}var v=new s.Editor({textViewFactory:l,undoStackFactory:new o.UndoFactory,annotationFactory:new o.AnnotationFactory,keyBindingFactory:c,statusReporter:h,domNode:n});v.installTextView(),v.setInput(null,null,i.Content?i.Content:t),v.setOverviewRulerVisible(!1);var m=v.getTextView();return m.addEventListener("Selection",function(e){if(e.newValue&&e.newValue.start!==e.newValue.end)return;if(this._diffNavigator.autoSelecting||!this._diffNavigator.editorWrapper[0].diffFeeder)return;var t=m.getCaretOffset();this._diffNavigator.gotoDiff(t,m)}.bind(this)),m.getModel().addEventListener("Changed",function(e){this._curveRuler.onChanged(e,!u)||(this.options.mapper=null)}.bind(this)),u?m.addEventListener("Scroll",function(e){this._curveRuler&&(this._curveRuler.matchPositionFrom(!0),this._curveRuler.render()),this.onScroll&&this.onScroll()}.bind(this)):m.addEventListener("Scroll",function(e){this._curveRuler&&this._curveRuler.render()}.bind(this)),v},t.prototype.destroy=function(){this._editors&&(this._diffNavigator.destroy(),this._editors.forEach(function(e){e.destroy()}),this._uiFactory.destroy())},t.prototype.addRulers=function(){if(this._editors&&!this._hasRuler){var e=new i.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),t=new i.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});this._editors[1].getTextView().addRuler(e),this._editors[0].getTextView().addRuler(t),this._editors[0].getTextView().addRuler(this._overviewRuler),this._hasRuler=!0}},t.prototype.refresh=function(e){var t=this.options.oldFile.Content,r=this.options.newFile.Content,i=this.options.diffContent,s;typeof r=="string"?s=this._generateMapper(t,r,i,this.options.hasConflicts):(s=this._generateMapper(t,r,i,this.options.hasConflicts),r=s.output);var o=new h.TwoWayDiffBlockFeeder(this._editors[0].getTextView().getModel(),s.mapper,1),u=new h.TwoWayDiffBlockFeeder(this._editors[1].getTextView().getModel(),s.mapper,0);this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._editors[0],this._editors[1],o,u,this._overviewRuler,this._curveRuler),this._curveRuler.init(s.mapper,this._editors[1],this._editors[0],this._diffNavigator),e&&(this._editors[1].setInput(this.options.newFile.Name,null,r),this._editors[0].setInput(this.options.oldFile.Name,null,t)),this._initSyntaxHighlighter([{fileName:this.options.newFile.Name,contentType:this.options.newFile.Type,editor:this._editors[1]},{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,editor:this._editors[0]}]),this._highlightSyntax(),this.options.commandProvider&&this.options.commandProvider.renderCommands(this),this.addRulers(),this._viewLoadedCounter===2&&this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1);var a=this._uiFactory.getTitleDiv(!0),f=this._uiFactory.getTitleDiv(!1);f&&a&&(n.empty(f),n.empty(a),f.appendChild(document.createTextNode(this.options.oldFile.Name)),a.appendChild(document.createTextNode(this.options.newFile.Name)));var l=this._editors[1].getTextView().getModel().getLineCount()*this._editors[1].getTextView().getLineHeight()+5,c=this._editors[0].getTextView().getModel().getLineCount()*this._editors[0].getTextView().getLineHeight()+5;return l>c?l:c},t}(),m.InlineCompareView=function(){function e(e){this.setOptions(e,!0),this._diffNavigator=new h.DiffTreeNavigator("word"),this.type="inline",this.options.commandProvider&&this.options.commandProvider.initCommands(this),this._editorDivId=this.options.parentDivId}return e.prototype=new m.CompareView,e.prototype.addRulers=function(){this._textView&&!this._hasRuler&&(this._textView.addRuler(this._rulerOrigin),this._textView.addRuler(this._rulerNew),this._textView.addRuler(this._overviewRuler),this._hasRuler=!0)},e.prototype.removeRulers=function(){this._textView&&this._hasRuler&&(this._textView.removeRuler(this._rulerOrigin),this._textView.removeRuler(this._rulerNew),this._textView.removeRuler(this._overviewRuler),this._hasRuler=!1)},e.prototype.destroyEditor=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.setText(""),this.removeRulers())},e.prototype.destroy=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.destroy())},e.prototype.initEditors=function(e){var t=n.node(this._editorDivId),r=function(){var e=new a.TextView({parent:t,readonly:!0,tabSize:4});return e}.bind(this);this._editor=new s.Editor({textViewFactory:r,undoStackFactory:new o.UndoFactory,annotationFactory:new o.AnnotationFactory,domNode:t}),this._editor.installTextView(),this._editor.setInput(null,null,e),this._editor.setOverviewRulerVisible(!1),this._editor.setAnnotationRulerVisible(!1),this._textView=this._editor.getTextView(),this._rulerOrigin=new i.LineNumberCompareRuler(this._diffNavigator,1,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._rulerNew=new i.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._overviewRuler=new i.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e,t){this._diffNavigator.matchPositionFromOverview(e)}.bind(this)),this._textView.addEventListener("Selection",function(e){if(e.newValue&&e.newValue.start!==e.newValue.end)return;if(this._diffNavigator.autoSelecting||!this._diffNavigator.editorWrapper[0].diffFeeder)return;var t=this._textView.getCaretOffset();this._diffNavigator.gotoDiff(t,this._textView)}.bind(this))},e.prototype._initDiffPosition=function(e){var t=e.getModel();if(t&&t.getAnnotations){var n=t.getAnnotations();if(n.length>0){var r=n[0][0],i=e.getLineHeight(),s=e.getClientArea(),o=Math.floor(s.height/i/3);e.setTopIndex(r-o>0?r-o:0)}}},e.prototype.refresh=function(){var e=this.options.oldFile.Content,t=this.options.newFile.Content,n=this.options.diffContent,r=this._generateMapper(e,t,n,this.options.hasConflicts,!this.options.toggler);typeof t!="string"&&(t=r.output),this._textView.getModel().setText(e);var i=new h.inlineDiffBlockFeeder(r.mapper,1),s=new h.inlineDiffBlockFeeder(r.mapper,0);l.mergeDiffBlocks(this._textView.getModel(),s.getDiffBlocks(),r.mapper,r.diffArray.array,r.diffArray.index,this._diffParser._lineDelimiter),i.setModel(this._textView.getModel()),s.setModel(this._textView.getModel()),this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._editor,this._editor,i,s,this._overviewRuler),this._initSyntaxHighlighter([{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,editor:this._editor}]),this._highlightSyntax(),this.options.commandProvider&&this.options.commandProvider.renderCommands(this),this.addRulers();var o=this._textView.getTopIndex();return this._textView.redrawLines(o,o+1,this._overviewRuler),this._textView.redrawLines(o,o+1,this._rulerOrigin),this._textView.redrawLines(o,o+1,this._rulerNew),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1),this._textView.getLineHeight()*this._textView.getModel().getLineCount()+5},e.prototype.setConflicting=function(e){this._conflcit=e},e}(),m.toggleableCompareView=function(){function e(e,t){t&&(t.toggler=this),e==="inline"?this._widget=new m.InlineCompareView(t):this._widget=new m.TwoWayCompareView(t)}return e.prototype={startup:function(){this._widget.startup()},toggle:function(){var e=this._widget.options,t=this._widget.getCurrentDiffPos();e.blockNumber=t.block,e.changeNumber=t.change,this._widget.destroy(),n.empty(n.node(e.parentDivId)),this._widget.type==="inline"?this._widget=new m.TwoWayCompareView(e):this._widget=new m.InlineCompareView(e),this._widget.initEditors(),this._widget.refresh(!0)},getWidget:function(){return this._widget}},e}(),m}),define("orion/compare/compareCommands",["i18n!orion/compare/nls/messages","orion/commands","orion/keyBinding","orion/webui/littlelib"],function(e,t,n,r){var i={};return i.CompareCommandFactory=function(){function i(e){this.setOptions(e,!0)}return i.prototype={setOptions:function(e,t){t&&(this.options={}),this.options||(this.options={}),e&&Object.keys(e).forEach(function(t){this.options[t]=e[t]}.bind(this))},getOptions:function(){return this.options},initCommands:function(r){var i=this.options.commandSpanId,s=this.options.commandService;if(!s||!i)return;var o=new t.Command({name:e["Copy current change from right to left"],tooltip:e["Copy current change from right to left"],imageClass:"core-sprite-leftarrow",id:"orion.compare.copyToLeft",groupId:"orion.compareGroup",visibleWhen:function(e){return r.type==="twoWay"&&r.options.newFile&&!r.options.newFile.readonly}.bind(this),callback:function(e){e.items.copyToLeft()}}),u=new t.Command({name:e["Copy current change from left to right"],tooltip:e["Copy current change from left to right"],imageClass:"core-sprite-rightarrow",id:"orion.compare.copyToRight",groupId:"orion.compareGroup",visibleWhen:function(e){return r.type==="twoWay"&&r.options.oldFile&&!r.options.oldFile.readonly}.bind(this),callback:function(e){e.items.copyToRight()}}),a=new t.Command({tooltip:e["Switch to unified diff"],name:e.Unified,id:"orion.compare.toggle2Inline",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.toggler&&e.options.toggler.getWidget().type==="twoWay"},callback:function(e){e.items.options.toggler.toggle()}}),f=new t.Command({tooltip:e["Switch to side by side diff"],name:e["Side by side"],id:"orion.compare.toggle2TwoWay",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.toggler&&e.options.toggler.getWidget().type==="inline"},callback:function(e){e.items.options.toggler.toggle()}}),l=new t.Command({name:e["Next diff block"],tooltip:e["Next diff block"],imageClass:"core-sprite-move_down",id:"orion.compare.nextDiff",groupId:"orion.compareGroup",callback:function(e){e.items.nextDiff()}}),c=new t.Command({name:e["Previous diff block"],tooltip:e["Previous diff block"],imageClass:"core-sprite-move_up",id:"orion.compare.prevDiff",groupId:"orion.compareGroup",callback:function(e){e.items.prevDiff()}}),h=new t.Command({name:e["Next diff change"],tooltip:e["Next diff change"],imageClass:"core-sprite-move_down",id:"orion.compare.nextChange",groupId:"orion.compareGroup",callback:function(e){e.items.nextChange()}}),p=new t.Command({name:e["Previous diff change"],tooltip:e["Previous diff change"],imageClass:"core-sprite-move_up",id:"orion.compare.prevChange",groupId:"orion.compareGroup",callback:function(e){e.items.prevChange(e)}});s.addCommand(o),s.addCommand(u),s.addCommand(f),s.addCommand(a),s.addCommand(l),s.addCommand(c),s.addCommand(h),s.addCommand(p),s.registerCommandContribution(i,"orion.compare.toggle2Inline",108),s.registerCommandContribution(i,"orion.compare.toggle2TwoWay",109),s.registerCommandContribution(i,"orion.compare.copyToLeft",110,null,!1,new n.KeyBinding(37,!0,!1,!0)),s.registerCommandContribution(i,"orion.compare.copyToRight",111,null,!1,new n.KeyBinding(39,!0,!1,!0)),s.registerCommandContribution(i,"orion.compare.nextDiff",112,null,!1,new n.KeyBinding(40,!0)),s.registerCommandContribution(i,"orion.compare.prevDiff",113,null,!1,new n.KeyBinding(38,!0)),r.options.wordLevelNav?(s.registerCommandContribution(i,"orion.compare.nextChange",114,null,!1,new n.KeyBinding(40,!0,!0)),s.registerCommandContribution(i,"orion.compare.prevChange",115,null,!1,new n.KeyBinding(38,!0,!0))):(s.registerCommandContribution(i,"orion.compare.nextChange",114,null,!0,new n.KeyBinding(40,!0,!0)),s.registerCommandContribution(i,"orion.compare.prevChange",115,null,!0,new n.KeyBinding(38,!0,!0)))},renderCommands:function(e){var t=this.options.commandSpanId,n=this.options.commandService;if(!n||!t)return;r.empty(r.node(t)),this.options.gridRenderer&&this.options.gridRenderer.navGridHolder?(this.options.gridRenderer.navGridHolder.splice(0,this.options.gridRenderer.navGridHolder.length),this.options.gridRenderer.additionalCmdRender?this.options.gridRenderer.before?(this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder),n.renderCommands(t,t,e,e,"tool",null,this.options.gridRenderer.navGridHolder)):(n.renderCommands(t,t,e,e,"tool",null,this.options.gridRenderer.navGridHolder),this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder)):n.renderCommands(t,t,e,e,"tool",null,this.options.gridRenderer.navGridHolder)):n.renderCommands(t,t,e,e,"tool",null)}},i}(),i}),define("orion/editor/textMateStyler",["orion/editor/regex"],function(e){function n(e){var t;if(e instanceof Array){t=new Array(e.length);for(var r=0;r<e.length;r++)t[r]=n(e[r])}else{t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s=="object"&&s!==null?t[i]=n(s):t[i]=s}}return t}function r(e,t,r){this.initialize(e),this.grammar=n(t),this.externalGrammars=r?n(r):[],this._styles={},this._tree=null,this._allGrammars={},this.preprocess(this.grammar)}var t={unsupported:[{regex:/\(\?[ims\-]:/,func:function(e){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(e){return e[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(e){return"atomic group"}}],toRegExp:function(e){function n(e,t){throw new Error('Unsupported regex feature "'+e+'": "'+t[0]+'" at index: '+t.index+" in "+t.input)}function r(e){var t="",n=!1,r=e.length;for(var i=0;i<r;){var s=e.charAt(i);if(!n&&s==="#")while(i<r&&s!=="\r"&&s!=="\n")s=e.charAt(++i);else if(!n&&/\s/.test(s))while(i<r&&/\s/.test(s))s=e.charAt(++i);else s==="\\"?(t+=s,/\s/.test(e.charAt(i+1))||(t+=e.charAt(i+1),i+=1),i+=1):s==="["?(n=!0,t+=s,i+=1):s==="]"?(n=!1,t+=s,i+=1):(t+=s,i+=1)}return t}var i="",s;e=t.processGlobalFlag("x",e,function(e){return r(e)}),e=t.processGlobalFlag("i",e,function(e){return i+="i",e});for(s=0;s<this.unsupported.length;s++){var o;(o=this.unsupported[s].regex.exec(e))&&n(this.unsupported[s].func(o),o)}return new RegExp(e,i)},processGlobalFlag:function(e,t,n){function r(e,t){var n=0,r=e.length,i=-1;for(var s=t;s<r&&i===-1;s++)switch(e.charAt(s)){case"\\":s++;break;case"(":n++;break;case")":n--,n===0&&(i=s)}return i}var i="(?"+e+")",s="(?"+e+":";if(t.substring(0,i.length)===i)return n(t.substring(i.length));if(t.substring(0,s.length)===s){var o=r(t,0);if(o<t.length-1)throw new Error("Only a "+s+") group that encloses the entire regex is supported in: "+t);return n(t.substring(s.length,o))}return t},hasBackReference:function(e){return/\\\d+/.test(e.source)},getSubstitutedRegex:function(t,n,r){r=typeof r=="undefined"?!0:!1;var i=t.source.split(/(\\\d+)/g),s=[];for(var o=0;o<i.length;o++){var u=i[o],a=/\\(\d+)/.exec(u);if(a){var f=n[a[1]]||"";s.push(r?e.escape(f):f)}else s.push(u)}return new RegExp(s.join(""))},groupify:function(e,t){var n=1,r=2,i=3,s=4,o=e.source,u=o.length,a=[],f=0,l=[],c=1,h=1,p=[],d={},v={};for(var m=0;m<u;m++){var g=a[a.length-1],y=o.charAt(m);switch(y){case"(":g===s&&(a.pop(),p.push(")"),l[l.length-1].end=m);var b=m+2<u?o.charAt(m+1)+""+o.charAt(m+2):null;if(b==="?:"||b==="?="||b==="?!"){var w;b==="?:"?w=n:(w=i,f++),a.push(w),l.push({start:m,end:-1,type:w}),p.push(y),p.push(b),m+=b.length}else a.push(r),l.push({start:m,end:-1,type:r,oldNum:c,num:h}),p.push(y),f===0&&(v[h]=null),d[c]=h,c++,h++;break;case")":var E=a.pop();E===i&&f--,l[l.length-1].end=m,p.push(y);break;case"*":case"+":case"?":case"}":var S=y,x=o.charAt(m-1),T=m-1;if(y==="}"){for(var N=m-1;o.charAt(N)!=="{"&&N>=0;N--);x=o.charAt(N-1),T=N-1,S=o.substring(N,m+1)}var C=l[l.length-1];if(x===")"&&(C.type===r||C.type===s)){p.splice(C.start,0,"("),p.push(S),p.push(")");var k={start:C.start,end:p.length-1,type:s,num:C.num};for(var L=0;L<l.length;L++)E=l[L],(E.type===r||E.type===s)&&E.start>=C.start&&E.end<=T&&(E.start+=1,E.end+=1,E.num=E.num+1,E.type===r&&(d[E.oldNum]=E.num));l.push(k),h++;break};default:y!=="|"&&g!==r&&g!==s&&f===0&&(a.push(s),l.push({start:m,end:-1,type:s,num:h}),p.push("("),v[h]=null,h++),p.push(y);if(y==="\\"){var A=o.charAt(m+1);p.push(A),m+=1}}}while(a.length)a.pop(),p.push(")");var O=new RegExp(p.join("")),M={};t=t||d;for(var _ in t)t.hasOwnProperty(_)&&(M[_]="\\"+t[_]);return O=this.getSubstitutedRegex(O,M,!1),[O,d,v]},complexCaptures:function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t)&&t!=="0")return!0;return!1}};return r.prototype={initialize:function(e){this.textView=e,this.textView.stylerOptions=this;var t=this;this._listener={onModelChanged:function(e){t.onModelChanged(e)},onDestroy:function(e){t.onDestroy(e)},onLineStyle:function(e){t.onLineStyle(e)},onStorage:function(e){t.onStorage(e)}},e.addEventListener("ModelChanged",this._listener.onModelChanged),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),e.redrawLines()},onDestroy:function(e){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null),this.grammar=null,this._styles=null,this._tree=null,this._listener=null},preprocess:function(e){var t=[e];for(;t.length!==0;){var n=t.pop();if(n._resolvedRule&&n._typedRule)continue;n._resolvedRule=this._resolve(n),n._typedRule=this._createTypedRule(n),this.addStyles(n.name),this.addStyles(n.contentName),this.addStylesForCaptures(n.captures),this.addStylesForCaptures(n.beginCaptures),this.addStylesForCaptures(n.endCaptures),n._resolvedRule!==n&&t.push(n._resolvedRule);if(n.patterns)for(var r=0;r<n.patterns.length;r++)t.push(n.patterns[r])}},addStyles:function(e){if(e&&!this._styles[e]){this._styles[e]=[];var t=e.split(".");for(var n=0;n<t.length;n++)this._styles[e].push(t.slice(0,n+1).join("-"))}},addStylesForCaptures:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].name;this.addStyles(n)}},ContainerRule:function(){function e(e){this.rule=e,this.subrules=e.patterns}return e.prototype.valueOf=function(){return"aa"},e}(),BeginEndRule:function(){function e(e){this.rule=e,this.beginRegex=t.toRegExp(e.begin),this.endRegex=t.toRegExp(e.end),this.subrules=e.patterns||[],this.endRegexHasBackRef=t.hasBackReference(this.endRegex);var n=t.complexCaptures(e.captures),r=t.complexCaptures(e.beginCaptures)||t.complexCaptures(e.endCaptures);this.isComplex=n||r;if(this.isComplex){var i=t.groupify(this.beginRegex);this.beginRegex=i[0],this.beginOld2New=i[1],this.beginConsuming=i[2];var s=t.groupify(this.endRegex,this.beginOld2New);this.endRegex=s[0],this.endOld2New=s[1],this.endConsuming=s[2]}}return e.prototype.valueOf=function(){return this.beginRegex},e}(),MatchRule:function(){function e(e){this.rule=e,this.matchRegex=t.toRegExp(e.match),this.isComplex=t.complexCaptures(e.captures);if(this.isComplex){var n=t.groupify(this.matchRegex);this.matchRegex=n[0],this.matchOld2New=n[1],this.matchConsuming=n[2]}}return e.prototype.valueOf=function(){return this.matchRegex},e}(),_createTypedRule:function(e){return e.match?new this.MatchRule(e):e.begin?new this.BeginEndRule(e):new this.ContainerRule(e)},_resolve:function(e){var t=e;if(e.include){if(e.begin||e.end||e.match)throw new Error('Unexpected regex pattern in "include" rule '+e.include);var n=e.include;if(n.charAt(0)==="#"){t=this.grammar.repository&&this.grammar.repository[n.substring(1)];if(!t)throw new Error("Couldn't find included rule "+n+" in grammar repository")}else if(n==="$self")t=this.grammar;else{if(n==="$base")throw new Error('Include "$base" is not supported');t=this._allGrammars[n];if(!t)for(var r=0;r<this.externalGrammars.length;r++){var i=this.externalGrammars[r];if(i.scopeName===n){this.preprocess(i),this._allGrammars[n]=i,t=i;break}}}}return t},ContainerNode:function(){function e(e,t){this.parent=e,this.rule=t,this.children=[],this.start=null,this.end=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.valueOf=function(){var e=this.rule;return"ContainerNode { "+(e.include||"")+" "+(e.name||"")+(e.comment||"")+"}"},e}(),BeginEndNode:function(){function e(e,n,r){this.parent=e,this.rule=n,this.children=[],this.setStart(r),this.end=null,this.endMatch=null,n.endRegexHasBackRef?this.endRegexSubstituted=t.getSubstitutedRegex(n.endRegex,r):this.endRegexSubstituted=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.getIndexInParent=function(e){return this.parent?this.parent.children.indexOf(this):-1},e.prototype.setStart=function(e){this.start=e.index,this.beginMatch=e},e.prototype.setEnd=function(e){if(e&&typeof e=="object"){var t=e;this.endMatch=t,this.end=t.index+t[0].length}else{var n=e;this.endMatch=null,this.end=n}},e.prototype.shiftStart=function(e){this.start+=e,this.beginMatch.index+=e},e.prototype.shiftEnd=function(e){this.end+=e,this.endMatch&&(this.endMatch.index+=e)},e.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+"}"},e}(),push:function(e,t){if(!t)return;for(var n=t.length;n>0;)e.push(t[--n])},exec:function(e,t,n){var r=e.exec(t);return r&&(r.index+=n),e.lastIndex=0,r},afterMatch:function(e){return e.index+e[0].length},getEndMatch:function(e,t,n){if(e instanceof this.BeginEndNode){var r=e.rule,i=e.endRegexSubstituted||r.endRegex;return i?this.exec(i,t,n):null}return null},initialParse:function(){var e=this.textView.getModel().getCharCount(),t=new this.ContainerNode(null,this.grammar._typedRule);this._tree=t,this.parse(this._tree,!1,0)},onModelChanged:function(e){var t=e.addedCharCount,n=e.addedLineCount,r=e.removedCharCount,i=e.removedLineCount,s=e.start;if(!this._tree)this.initialParse();else{var o=this.textView.getModel(),u=o.getCharCount(),a=o.getLineEnd(o.getLineAtOffset(s)-1),f=this.getFirstDamaged(a,a);a=a===-1?0:a;var l;f?l=this.parse(f,!0,a,s,t,r):l=u,this.textView.redrawRange(a,l)}},getFirstDamaged:function(e,t){if(e<0)return this._tree;var n=[this._tree],r=null;while(n.length){var i=n.pop();if(!i.parent||this.isDamaged(i,e,t)){i instanceof this.BeginEndNode&&(r=i);for(var s=0;s<i.children.length;s++)n.push(i.children[s])}}return r||this._tree},isDamaged:function(e,t,n){return e.start<=n&&e.end>t},parse:function(e,t,n,r,i,s){var o=this.textView.getModel(),u=o.getLineStart(o.getLineCount()-1),a=o.getCharCount(),f=this.getInitialExpected(e,n),l=-1;if(t){e.repaired=!0,e.endNeedsUpdate=!0;var c=e.children[e.children.length-1],h=i-s,p=c?o.getLineEnd(o.getLineAtOffset(c.end+h)):-1,d=o.getLineEnd(o.getLineAtOffset(r+s));l=Math.max(p,d)}l=l===-1?a:l;var v=f,m=e,g=!1,y=n,b=-1;while(m&&(!t||y<l)){var w=this.getNextMatch(o,m,y);w||(y=y>=u?a:o.getLineStart(o.getLineAtOffset(y)+1));var E=w&&w.match,S=w&&w.rule,x=w&&w.isSub,T=w&&w.isEnd;if(x){y=this.afterMatch(E);if(S instanceof this.BeginEndRule){g=!0;if(t&&S===v.rule&&m===v.parent){var N=v;N.setStart(E),N.repaired=!0,N.endNeedsUpdate=!0,m=N,v=this.getNextExpected(v,"begin")}else{t&&(this.prune(m,v),t=!1);var C=new this.BeginEndNode(m,S,E);m.addChild(C),m=C}}}else if(T||y===a)m instanceof this.BeginEndNode&&(E?(g=!0,b=Math.max(b,m.end),m.setEnd(E),y=this.afterMatch(E),t&&m===v&&m.parent===v.parent?(m.repaired=!0,delete m.endNeedsUpdate,v=this.getNextExpected(v,"end")):t&&(this.prune(m,v),t=!1)):(m.setEnd(a),delete m.endNeedsUpdate)),m=m.parent;t&&y>=l&&!g&&(this.prune(e,f),t=!1)}return this.removeUnrepairedChildren(e,t,n),this.cleanup(t,e,n,l,a,i,s),t?Math.max(b,y):y},removeUnrepairedChildren:function(e,t,n){if(t){var r=e.children,i=-1;for(var s=0;s<r.length;s++){var o=r[s];if(!o.repaired&&this.isDamaged(o,n,Number.MAX_VALUE)){i=s;break}}i!==-1&&(e.children.length=i)}},cleanup:function(e,t,n,r,i,s,o){var u,a,f;if(e){var l=s-o,c=this.getIntersecting(r-l+1,i);f=this.getIntersecting(n,r);for(u=0;u<c.length;u++)a=c[u],!a.repaired&&a instanceof this.BeginEndNode&&(a.shiftEnd(l),a.shiftStart(l));for(u=0;u<f.length;u++)a=f[u],a.repaired&&a.endNeedsUpdate&&a.shiftEnd(l),delete a.endNeedsUpdate,delete a.repaired}else{f=this.getIntersecting(n,r);for(u=0;u<f.length;u++)delete f[u].repaired}},getNextMatch:function(e,t,n,r){var i=e.getLineAtOffset(n),s=e.getLineEnd(i),o=e.getText(n,s),u=[],a=[],f=[],l=[];this.push(u,t.rule.subrules);while(u.length){var c=u.length?u.pop():null,h=c&&c._resolvedRule._typedRule;if(h instanceof this.ContainerRule&&a.indexOf(h)===-1){a.push(h),this.push(u,h.subrules);continue}if(h&&r&&!h.matchRegex)continue;var p=h&&this.exec(h.matchRegex||h.beginRegex,o,n);p&&(f.push(p),l.push(h))}var d=Number.MAX_VALUE,v=-1;for(var m=0;m<f.length;m++){var g=f[m];g.index<d&&(d=g.index,v=m)}if(!r){var y=t,b=this.getEndMatch(t,o,n);if(b){var w=y.rule.applyEndPatternLast,E=v===-1||b.index<d||!w&&b.index===d;if(E)return{isEnd:!0,rule:y.rule,match:b}}}return v===-1?null:{isSub:!0,rule:l[v],match:f[v]}},getInitialExpected:function(e,t){var n,r;if(e===this._tree)for(n=0;n<e.children.length;n++){r=e.children[n];if(r.start>=t)return r}else if(e instanceof this.BeginEndNode&&e.endMatch){var i=e.endMatch.index;for(n=0;n<e.children.length;n++){r=e.children[n];if(r.start>=t)break}if(r&&r.start<i)return r}return e},getNextExpected:function(e,t){var n=e;if(t==="begin"){var r=n.children[0];return r?r:n}if(t==="end"){var i=n.parent;if(i){var s=i.children[i.children.indexOf(n)+1];return s?s:i}}return null},prune:function(e,t){var n=t.parent===e;n?e.children.length=t.getIndexInParent():e instanceof this.BeginEndNode&&(e.endMatch=null,e.end=null),e.parent&&(e.parent.children.length=e.getIndexInParent()+1)},onLineStyle:function(e){function t(e,t){return e.start-t.start}this._tree||this.initialParse();var n=e.lineStart,r=this.textView.getModel(),i=r.getLineEnd(e.lineIndex),s=r.getLineEnd(r.getLineAtOffset(n)-1),o=this.getFirstDamaged(s,s),u=this.getLineScope(r,o,n,i);e.ranges=this.toStyleRanges(u),e.ranges.sort(t)},getLineScope:function(e,t,n,r){var i=n,s=this.getInitialExpected(t,n),o=[],u=[];while(t&&i<r){var a=this.getNextMatch(e,t,i);if(!a)break;var f=a&&a.match,l=a&&a.rule,c=a&&a.isSub,h=a&&a.isEnd;f.index!==i&&u.push({start:i,end:f.index,node:t}),c?(i=this.afterMatch(f),l instanceof this.BeginEndRule?(this.addBeginScope(o,f,l),t=s,s=this.getNextExpected(s,"begin")):this.addMatchScope(o,f,l)):h&&(i=this.afterMatch(f),this.addEndScope(o,f,l),s=this.getNextExpected(s,"end"),t=t.parent)}i<r&&u.push({start:i,end:r,node:t});var p=this.getInheritedLineScope(u,n,r);return o.concat(p)},getInheritedLineScope:function(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i],o=s.node;while(o){var u=o.rule.rule,a=u.name,f=u.contentName,l=f||a;if(l){this.addScopeRange(r,s.start,s.end,l);break}o=o.parent}}return r},addBeginScope:function(e,t,n){var r=n.rule;this.addCapturesScope(e,t,r.beginCaptures||r.captures,n.isComplex,n.beginOld2New,n.beginConsuming)},addEndScope:function(e,t,n){var r=n.rule;this.addCapturesScope(e,t,r.endCaptures||r.captures,n.isComplex,n.endOld2New,n.endConsuming)},addMatchScope:function(e,t,n){var r=n.rule,i=r.name,s=r.captures;s?this.addCapturesScope(e,t,s,n.isComplex,n.matchOld2New,n.matchConsuming):this.addScope(e,t,i)},addScope:function(e,t,n){if(!n)return;e.push({start:t.index,end:this.afterMatch(t),scope:n})},addScopeRange:function(e,t,n,r){if(!r)return;e.push({start:t,end:n,scope:r})},addCapturesScope:function(e,t,n,r,i,s){if(!n)return;if(!r)this.addScope(e,t,n[0]&&n[0].name);else{var o={1:0},u=0;for(var a=1;t[a]!==undefined;a++)s[a]!==undefined&&(u+=t[a].length),t[a+1]!==undefined&&(o[a+1]=u);var f=t.index;for(var l=1;n[l];l++){var c=n[l].name,h=i[l],p=f+o[h];if(typeof t[h]!="undefined"){var d=p+t[h].length;this.addScopeRange(e,p,d,c)}}}},getIntersecting:function(e,t){var n=[],r=this._tree?[this._tree]:[];while(r.length){var i=r.pop(),s=!1;i instanceof this.ContainerNode?s=!0:this.isDamaged(i,e,t)&&(s=!0,n.push(i));if(s){var o=i.children.length;for(var u=0;u<o;u++)r.push(i.children[u])}}return n.reverse()},toStyleRanges:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=this._styles[r.scope];if(!i)throw new Error("styles not found for "+r.scope);var s=i.join(" ");t.push({start:r.start,end:r.end,style:{styleClass:s}})}return t}},{RegexUtil:t,TextMateStyler:r}}),define("orion/editor/htmlGrammar",[],function(){function e(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<!--",end:"-->",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}return{HtmlGrammar:e}}),define("orion/editor/keywords",[],function(){var e=["break","case","class","catch","continue","const","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","true","try","typeof","undefined","var","void","while","with","yield"],t=["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","mark","mark-after","mark-before","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","white-space-collapse","widows","width","word-break","word-spacing","word-wrap","z-index"],n=["abstract","boolean","break","byte","case","catch","char","class","continue","default","do","double","else","extends","false","final","finally","float","for","if","implements","import","instanceof","int","interface","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","void","volatile","while"];return{JSKeywords:e,CSSKeywords:t,JAVAKeywords:n}}),define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/keywords"],function(e,t){function _(e,t){this.keywords=e,this.whitespacesVisible=t,this.setText("")}function D(){_.call(this,null,!0)}function P(e){_.call(this,null,e)}function H(){_.call(this,null,!1)}function B(e,t,s){this.commentStart="/*",this.commentEnd="*/";var o=[];switch(t){case"java":o=r;break;case"js":o=n;break;case"css":o=i}this.whitespacesVisible=!1,this.detectHyperlinks=!0,this.highlightCaretLine=!1,this.foldingEnabled=!0,this.detectTasks=!0,this._scanner=new _(o,this.whitespacesVisible),this._firstScanner=new H,this._commentScanner=new P(this.whitespacesVisible),this._whitespaceScanner=new D,t==="css"&&(this._scanner.isCSS=!0,this._firstScanner.isCSS=!0),this.view=e,this.annotationModel=s,this._bracketAnnotations=undefined;var u=this;this._listener={onChanged:function(e){u._onModelChanged(e)},onDestroy:function(e){u._onDestroy(e)},onLineStyle:function(e){u._onLineStyle(e)},onMouseDown:function(e){u._onMouseDown(e)},onSelection:function(e){u._onSelection(e)}};var a=e.getModel();a.getBaseModel&&(a=a.getBaseModel()),a.addEventListener("Changed",this._listener.onChanged),e.addEventListener("MouseDown",this._listener.onMouseDown),e.addEventListener("Selection",this._listener.onSelection),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),this._computeComments(),this._computeFolding(),e.redrawLines()}var n=t.JSKeywords,r=t.JAVAKeywords,i=t.CSSKeywords,s=1,o=2,u=3,a=4,f=5,l=6,c=7,h=8,p=9,d=10,v=11,m=12,g=13,y=14,b="{}()[]<>",w={styleClass:"comment"},E={styleClass:"token_multiline_comment"},S={styleClass:"token_doc_comment"},x={styleClass:"token_doc_html_markup"},T={styleClass:"token_task_tag"},N={styleClass:"token_doc_tag"},C={styleClass:"token_string"},k={styleClass:"token_number"},L={styleClass:"token_keyword"},A={styleClass:"token_space"},O={styleClass:"token_tab"},M={styleClass:"line_caret"};return _.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(e){switch(e){case 32:case 9:if(this.whitespacesVisible)return e===32?v:d;do e=this._read();while(e===32||e===9);return this._unread(e),p;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return e;default:var t=this.isCSS,n=this.offset-1;if(!t&&48<=e&&e<=57){var r=!1,i=!1,a=!1,f=e;do{e=this._read();if(e===46&&!r)r=!0;else if(e===101&&!i)r=i=!0,e=this._read(),e!==45&&this._unread(e);else if(e===120&&f===48&&this.offset-n===2)r=i=a=!0;else if(!(48<=e&&e<=57||a&&(65<=e&&e<=70||97<=e&&e<=102)))break}while(!0);return this._unread(e),u}if(97<=e&&e<=122||65<=e&&e<=90||e===95||45===e&&t){do e=this._read();while(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57||45===e&&t);this._unread(e);var l=this.keywords;if(l.length>0){var c=this.text.substring(n,this.offset);for(var h=0;h<l.length;h++)if(this.keywords[h]===c)return o}}return s}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(e){e!==-1&&this.offset--},nextToken:function(){this.startOffset=this.offset;for(;;){var e=this._read(),t;switch(e){case-1:return null;case 47:e=this._read();if(!this.isCSS&&e===47)for(;;){e=this._read();if(e===-1||e===10||e===13)return this._unread(e),l}if(e===42){e=this._read();var n=c;e===42&&(n=h);for(;;){while(e===42){e=this._read();if(e===47)return n}if(e===-1)return this._unread(e),n;e=this._read()}}return this._unread(e),s;case 39:t=a;for(;;){e=this._read();switch(e){case 39:return t;case 13:case 10:case-1:return this._unread(e),t;case 92:e=this._read();switch(e){case 10:t=f;break;case 13:t=f,e=this._read(),e!==10&&this._unread(e)}}}break;case 34:t=a;for(;;){e=this._read();switch(e){case 34:return t;case 13:case 10:case-1:return this._unread(e),t;case 92:e=this._read();switch(e){case 10:t=f;break;case 13:t=f,e=this._read(),e!==10&&this._unread(e)}}}break;default:return this._default(e)}}},setText:function(e){this.text=e,this.offset=0,this.startOffset=0}},D.prototype=new _(null),D.prototype.nextToken=function(){this.startOffset=this.offset;for(;;){var e=this._read();switch(e){case-1:return null;case 32:return v;case 9:return d;default:do e=this._read();while(e!==32&&e!==9&&e!==-1);return this._unread(e),s}}},P.prototype=new _(null),P.prototype.setType=function(e){this._type=e},P.prototype.nextToken=function(){this.startOffset=this.offset;for(;;){var e=this._read();switch(e){case-1:return null;case 32:case 9:if(this.whitespacesVisible)return e===32?v:d;do e=this._read();while(e===32||e===9);return this._unread(e),p;case 60:if(this._type===h){do e=this._read();while(e!==62&&e!==-1);if(e===62)return m}return s;case 64:if(this._type===h){do e=this._read();while(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57);return this._unread(e),g}return s;case 84:if((e=this._read())===79)if((e=this._read())===68)if((e=this._read())===79){e=this._read();if(!(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57))return this._unread(e),y;this._unread(e)}else this._unread(e);else this._unread(e);else this._unread(e);default:do e=this._read();while(e!==32&&e!==9&&e!==-1&&e!==60&&e!==64&&e!==84);return this._unread(e),s}}},H.prototype=new _(null),H.prototype._default=function(e){for(;;){e=this._read();switch(e){case 47:case 34:case 39:case-1:return this._unread(e),s}}},B.prototype={destroy:function(){var e=this.view;if(e){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),t.removeEventListener("Changed",this._listener.onChanged),e.removeEventListener("MouseDown",this._listener.onMouseDown),e.removeEventListener("Selection",this._listener.onSelection),e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null}},setHighlightCaretLine:function(e){this.highlightCaretLine=e},setWhitespacesVisible:function(e){this.whitespacesVisible=e,this._scanner.whitespacesVisible=e,this._commentScanner.whitespacesVisible=e},setDetectHyperlinks:function(e){this.detectHyperlinks=e},setFoldingEnabled:function(e){this.foldingEnabled=e},setDetectTasks:function(e){this.detectTasks=e},_binarySearch:function(e,t,n,r,i){var s;r===undefined&&(r=-1),i===undefined&&(i=e.length);while(i-r>1){s=Math.floor((i+r)/2);if(t<=e[s].start)i=s;else{if(n&&t<e[s].end){i=s;break}r=s}}return i},_computeComments:function(){var e=this.view.getModel();e.getBaseModel&&(e=e.getBaseModel()),this.comments=this._findComments(e.getText())},_computeFolding:function(){if(!this.foldingEnabled)return;var t=this.view,n=t.getModel();if(!n.getBaseModel)return;var r=this.annotationModel;if(!r)return;r.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING);var i=[],s=n.getBaseModel(),o=this.comments;for(var u=0;u<o.length;u++){var a=o[u],f=this._createFoldingAnnotation(n,s,a.start,a.end);f&&i.push(f)}r.replaceAnnotations(null,i)},_createFoldingAnnotation:function(t,n,r,i){var s=n.getLineAtOffset(r),o=n.getLineAtOffset(i);return s===o?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(r,i,t)},_computeTasks:function(t,n,r){if(!this.detectTasks)return;var i=this.annotationModel;if(!i)return;var s=this.view,o=s.getModel(),u=o;o.getBaseModel&&(u=o.getBaseModel());var a=i.getAnnotations(n,r),f=[],c=e.AnnotationType.ANNOTATION_TASK;while(a.hasNext()){var h=a.next();h.type===c&&f.push(h)}var p=[],d=this._commentScanner;d.setText(u.getText(n,r));var v;while(v=d.nextToken()){var m=d.getStartOffset()+n;if(v===y){var g=u.getLineEnd(u.getLineAtOffset(m));t!==l&&(g=Math.min(g,r-this.commentEnd.length)),p.push(e.AnnotationType.createAnnotation(c,m,g,u.getText(m,g)))}}i.replaceAnnotations(f,p)},_getLineStyle:function(e){if(this.highlightCaretLine){var t=this.view,n=t.getModel(),r=t.getSelection();if(r.start===r.end&&n.getLineAtOffset(r.start)===e)return M}return null},_getStyles:function(e,t,n){e.getBaseModel&&(n=e.mapOffset(n));var r=n+t.length,i=[],s=n,o=this.comments,u=this._binarySearch(o,n,!0);for(var a=u;a<o.length;a++){if(o[a].start>=r)break;var l=o[a].start,p=o[a].end;s<l&&this._parse(t.substring(s-n,l-n),s,i);var d=o[a].type,v;switch(d){case h:v=S;break;case c:v=E;break;case f:v=C}var m=Math.max(s,l),g=Math.min(r,p);d!==h&&d!==c||!this.whitespacesVisible&&!this.detectHyperlinks?d===f&&this.whitespacesVisible?this._parseString(t.substring(m-n,g-n),m,i,C):i.push({start:m,end:g,style:v}):this._parseComment(t.substring(m-n,g-n),m,i,v,d),s=p}s<r&&this._parse(t.substring(s-n,r-n),s,i);if(e.getBaseModel)for(var y=0;y<i.length;y++){var b=i[y].end-i[y].start;i[y].start=e.mapOffset(i[y].start,!0),i[y].end=i[y].start+b}return i},_parse:function(e,t,n){var r=this._scanner;r.setText(e);var i;while(i=r.nextToken()){var s=r.getStartOffset()+t,p=null;switch(i){case o:p=L;break;case u:p=k;break;case f:case a:if(this.whitespacesVisible){this._parseString(r.getData(),s,n,C);continue}p=C;break;case h:this._parseComment(r.getData(),s,n,S,i);continue;case l:this._parseComment(r.getData(),s,n,w,i);continue;case c:this._parseComment(r.getData(),s,n,E,i);continue;case d:this.whitespacesVisible&&(p=O);break;case v:this.whitespacesVisible&&(p=A)}n.push({start:s,end:r.getOffset()+t,style:p})}},_parseComment:function(e,t,n,r,i){var s=this._commentScanner;s.setText(e),s.setType(i);var o;while(o=s.nextToken()){var u=s.getStartOffset()+t,a=r;switch(o){case d:this.whitespacesVisible&&(a=O);break;case v:this.whitespacesVisible&&(a=A);break;case m:a=x;break;case g:a=N;break;case y:a=T;break;default:this.detectHyperlinks&&(a=this._detectHyperlinks(s.getData(),u,n,a))}a&&n.push({start:u,end:s.getOffset()+t,style:a})}},_parseString:function(e,t,n,r){var i=this._whitespaceScanner;i.setText(e);var s;while(s=i.nextToken()){var o=i.getStartOffset()+t,u=r;switch(s){case d:this.whitespacesVisible&&(u=O);break;case v:this.whitespacesVisible&&(u=A)}u&&n.push({start:o,end:i.getOffset()+t,style:u})}},_detectHyperlinks:function(e,t,n,r){var i=null,s,o;if((s=e.indexOf("://"))>0){i=e;var u=s;while(u>0){var a=i.charCodeAt(u-1);if(!(97<=a&&a<=122||65<=a&&a<=90||45===a||48<=a&&a<=57))break;u--}if(u>0){var f="\"\"''(){}[]<>";s=f.indexOf(i.substring(u-1,u));if(s!==-1&&(s&1)===0&&(s=i.lastIndexOf(f.substring(s+1,s+2)))!==-1){var l=s;return o=this._clone(r),o.tagName="A",o.attributes={href:i.substring(u,l)},n.push({start:t,end:t+u,style:r}),n.push({start:t+u,end:t+l,style:o}),n.push({start:t+l,end:t+e.length,style:r}),null}}}else e.toLowerCase().indexOf("bug#")===0&&(i="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(e.substring(4),10));return i?(o=this._clone(r),o.tagName="A",o.attributes={href:i},o):r},_clone:function(e){if(!e)return e;var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t[n]=r}return t},_findComments:function(e,t){t=t||0;var n=this._firstScanner,r;n.setText(e);var i=[];while(r=n.nextToken())(r===c||r===h||r===f)&&i.push({start:n.getStartOffset()+t,end:n.getOffset()+t,type:r}),(r===l||r===c||r===h)&&this._computeTasks(r,n.getStartOffset()+t,n.getOffset()+t);return i},_findMatchingBracket:function(e,t){var n=b,r=e.getText(t,t+1),i=n.indexOf(r,0);if(i===-1)return-1;var s;i&1?s=n.substring(i-1,i):s=n.substring(i+1,i+2);var o=e.getLineAtOffset(t),u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o);n=this._findBrackets(r,s,u,a,a,f);for(var l=0;l<n.length;l++){var c=n[l]>=0?1:-1;if(n[l]*c-1===t){var h=1;if(i&1){l--;for(;l>=0;l--){c=n[l]>=0?1:-1,h+=c;if(h===0)return n[l]*c-1}o-=1;while(o>=0){u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o),n=this._findBrackets(r,s,u,a,a,f);for(var p=n.length-1;p>=0;p--){c=n[p]>=0?1:-1,h+=c;if(h===0)return n[p]*c-1}o--}}else{l++;for(;l<n.length;l++){c=n[l]>=0?1:-1,h+=c;if(h===0)return n[l]*c-1}o+=1;var d=e.getLineCount();while(o<d){u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o),n=this._findBrackets(r,s,u,a,a,f);for(var v=0;v<n.length;v++){c=n[v]>=0?1:-1,h+=c;if(h===0)return n[v]*c-1}o++}}break}}return-1},_findBrackets:function(e,t,n,r,i,s){var o=[],u=e.charCodeAt(0),a=t.charCodeAt(0),f=i,l=this._scanner,c,h=this.comments,p=this._binarySearch(h,i,!0);for(var d=p;d<h.length;d++){if(h[d].start>=s)break;var v=h[d].start,m=h[d].end;if(f<v){l.setText(n.substring(f-i,v-i));while(c=l.nextToken())c===u?o.push(l.getStartOffset()+f-i+r+1):c===a&&o.push(-(l.getStartOffset()+f-i+r+1))}f=m}if(f<s){l.setText(n.substring(f-i,s-i));while(c=l.nextToken())c===u?o.push(l.getStartOffset()+f-i+r+1):c===a&&o.push(-(l.getStartOffset()+f-i+r+1))}return o},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){e.textView===this.view&&(e.style=this._getLineStyle(e.lineIndex)),e.ranges=this._getStyles(e.textView.getModel(),e.lineText,e.lineStart)},_onSelection:function(t){var n=t.oldValue,r=t.newValue,i=this.view,s=i.getModel(),o;if(this.highlightCaretLine){var u=s.getLineAtOffset(n.start);o=s.getLineAtOffset(r.start);var a=r.start===r.end,f=n.start===n.end;if(u!==o||!f||!a)f&&i.redrawLines(u,u+1),(u!==o||!f)&&a&&i.redrawLines(o,o+1)}if(!this.annotationModel)return;var l=this._bracketAnnotations,c,h;if(r.start===r.end&&(h=i.getCaretOffset())>0){var p=h-1;s.getBaseModel&&(p=s.mapOffset(p),s=s.getBaseModel());var d=this._findMatchingBracket(s,p);d!==-1&&(c=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,d,d+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,p,p+1)])}this._bracketAnnotations=c,this.annotationModel.replaceAnnotations(l,c)},_onMouseDown:function(e){if(e.clickCount!==2)return;var t=this.view,n=t.getModel(),r=t.getOffsetAtLocation(e.x,e.y);if(r>0){var i=r-1,s=n;n.getBaseModel&&(i=n.mapOffset(i),s=n.getBaseModel());var o=this._findMatchingBracket(s,i);if(o!==-1){e.preventDefault();var u=o;n.getBaseModel&&(u=n.mapOffset(u,!0)),r>u&&(r--,u++),t.setSelection(u,r)}}},_onModelChanged:function(t){var n=t.start,r=t.removedCharCount,i=t.addedCharCount,s=i-r,o=this.view,u=o.getModel(),a=u.getBaseModel?u.getBaseModel():u,f=n+r,l=a.getCharCount(),c=this.comments.length,h=a.getLineStart(a.getLineAtOffset(n)),p=this._binarySearch(this.comments,h,!0),d=this._binarySearch(this.comments,f,!1,p-1,c),v;p<c&&this.comments[p].start<=h&&h<this.comments[p].end?(v=this.comments[p].start,v>n&&(v+=s)):p===c&&c>0&&l-s===this.comments[c-1].end?v=this.comments[c-1].start:v=h;var m;d<c?(m=this.comments[d].end,m>n&&(m+=s),d+=1):(d=c,m=l);var g=a.getText(v,m),y,b=this._findComments(g,v),w;for(w=p;w<this.comments.length;w++)y=this.comments[w],y.start>n&&(y.start+=s),y.start>n&&(y.end+=s);var E=d-p!==b.length;if(!E)for(w=0;w<b.length;w++){y=this.comments[p+w];var S=b[w];if(y.start!==S.start||y.end!==S.end||y.type!==S.type){E=!0;break}}var x=[p,d-p].concat(b);Array.prototype.splice.apply(this.comments,x);if(E){var T=v,N=m;u!==a&&(T=u.mapOffset(T,!0),N=u.mapOffset(N,!0)),o.redrawRange(T,N)}if(this.foldingEnabled&&a!==u&&this.annotationModel){var C=this.annotationModel,k=C.getAnnotations(v,m),L=[],A=[],O;while(k.hasNext()){O=k.next();if(O.type===e.AnnotationType.ANNOTATION_FOLDING){A.push(O);for(w=0;w<b.length;w++)if(O.start===b[w].start&&O.end===b[w].end)break;if(w===b.length)L.push(O),O.expand();else{var M=O.start,_=O.end;M>n&&(M-=s),_>n&&(_-=s);if(M<=n&&n<_&&M<=f&&f<_){var D=a.getLineAtOffset(O.start),P=a.getLineAtOffset(O.end);D!==P?O.expanded||(O.expand(),C.modifyAnnotation(O)):C.removeAnnotation(O)}}}}var H=[];for(w=0;w<b.length;w++){y=b[w];for(var B=0;B<A.length;B++)if(A[B].start===y.start&&A[B].end===y.end)break;B===A.length&&(O=this._createFoldingAnnotation(u,a,y.start,y.end),O&&H.push(O))}C.replaceAnnotations(L,H)}}},{TextStyler:B}}),define("orion/compare/compareHighlighter",["orion/Deferred","orion/editor/textMateStyler","orion/editor/htmlGrammar","examples/editor/textStyler"],function(e,t,n,r){function s(e){var t=e.split("."),n="js";return t.length>1&&(n=t[t.length-1]),n}var i={};return i.DefaultHighlighter=function(){function i(){this.styler=null}return i.prototype={highlight:function(i,o,u){this.styler&&(this.styler.destroy(),this.styler=null);var a=s(i);if(a){var f=u.getTextView(),l=u.getAnnotationModel();switch(a){case"js":case"java":case"css":this.styler=new r.TextStyler(f,a,l);break;case"html":this.styler=new t.TextMateStyler(f,new n.HtmlGrammar)}return(new e).resolve(u)}return null}},i}(),i}),define("orion/compare/builder/compare",["orion/commandRegistry","orion/Deferred","orion/compare/compareView","orion/compare/compareCommands","orion/compare/compareHighlighter"],function(e,t,n,r,i){function o(e){var t=e.split("."),n="js";return t.length>1&&(n=t[t.length-1]),n}function u(e){var t=o(e),n={id:"application/javascript"};switch(t){case"java":n.id="text/x-java-source";break;case"css":n.id="text/css"}return n}function a(e){var n=new t,r=new XMLHttpRequest;return r.open("GET",e,!0),r.onreadystatechange=function(){if(r.readyState===4){var e=typeof r.response!="undefined"?r.response:r.responseText,t=typeof e=="string"?e:null,i=r.status;200<=i&&i<400?n.resolve(t):n.reject(t)}},r.send(),n}function f(e,t,o,a){var f=e;!f.highlighters&&f.oldFile&&f.oldFile.Name&&f.newFile&&f.newFile.Name&&(f.highlighters=[new i.DefaultHighlighter,new i.DefaultHighlighter]),f.oldFile&&f.oldFile.Name&&(f.oldFile.Type=u(f.oldFile.Name)),f.newFile&&f.newFile.Name&&(f.newFile.Type=u(f.newFile.Name));if(t){var l=new r.CompareCommandFactory({commandService:s,commandSpanId:t});f.commandProvider=l}var c=o==="inline"?"inline":"twoWay";a?this.compareView=new n.toggleableCompareView(c,f):c==="inline"?this.compareView=new n.inlineCompareView(f):this.compareView=new n.TwoWayCompareView(f),this.compareView.startup()}var s=new e.CommandRegistry({});return f.prototype={getCompareView:function(){return this.compareView},refresh:function(){var e=this.getCompareView().getWidget().options;if(e.oldFile.URL&&e.newFile.URL){var n=[];n.push(a(e.oldFile.URL)),n.push(a(e.newFile.URL)),t.all(n,function(e){return{_error:e}}).then(function(e){this.getCompareView().getWidget().options.oldFile.Content=e[0],this.getCompareView().getWidget().options.newFile.Content=e[1],this.getCompareView().getWidget().refresh(!0)}.bind(this))}else this.getCompareView().getWidget().refresh(!0)}},f}),define(["orion/compare/builder/compare"],function(e){return e});